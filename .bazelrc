###############################################################################
## Bazel Configuration Flags
##
## `.bazelrc` is a Bazel configuration file.
## https://bazel.build/docs/best-practices#bazelrc-file
###############################################################################

# Skip building runfiles links for faster builds.
build --nobuild_runfile_links

# https://bazel.build/reference/command-line-reference#flag--enable_platform_specific_config
common --enable_platform_specific_config

# Enable the only currently supported report type
# https://bazel.build/reference/command-line-reference#flag--combined_report
coverage --combined_report=lcov

# Avoid fully cached builds reporting no coverage and failing CI
# https://bazel.build/reference/command-line-reference#flag--experimental_fetch_all_coverage_outputs
coverage --experimental_fetch_all_coverage_outputs

# Required for some of the tests
# https://bazel.build/reference/command-line-reference#flag--experimental_cc_shared_library
common --experimental_cc_shared_library

# Disable network access in sandboxes by default.
build --sandbox_default_allow_network=false

# Always include autoconf outputs in normal builds.
build --output_groups=+autoconf_results
build --output_groups=+autoconf_checks

###############################################################################
## Incompatibility flags
###############################################################################

# https://github.com/bazelbuild/bazel/issues/8195
build --incompatible_disallow_empty_glob=true

# https://github.com/bazelbuild/bazel/issues/12821
build --nolegacy_external_runfiles

# https://github.com/bazelbuild/bazel/issues/23043.
build --incompatible_autoload_externally=

###############################################################################
## Compiler warnings
###############################################################################

# Enable all warnings and treat them as errors
# For Clang/GCC (Linux and macOS)
build:linux --copt=-Wall
build:linux --copt=-Wextra
build:linux --copt=-Werror
build:linux --per_file_copt=external/.*@-w
build:macos --copt=-Wall
build:macos --copt=-Wextra
build:macos --copt=-Werror
build:macos --per_file_copt=external/.*@-w

# For MSVC (Windows)
build:windows --copt=/Wall
build:windows --copt=/W3
build:windows --per_file_copt=external/.*@/W0

###############################################################################
## Custom user flags
##
## This should always be the last thing in the `.bazelrc` file to ensure
## consistent behavior when setting flags in that file as `.bazelrc` files are
## evaluated top to bottom.
###############################################################################

try-import %workspace%/user.bazelrc
