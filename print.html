<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>rules_cc_autoconf</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">rules_cc_autoconf</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/periareon/rules_cc_autoconf" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="rules_cc_autoconf"><a class="header" href="#rules_cc_autoconf">rules_cc_autoconf</a></h1>
<p>This module provides a rule to mimic <a href="https://www.gnu.org/software/autoconf/">GNU Autoconf</a>
functionality, allowing you to generate <code>config.h</code> files by running compilation checks against
a cc_toolchain.</p>
<h2 id="setup"><a class="header" href="#setup">Setup</a></h2>
<pre><code class="language-python">bazel_dep(name = "rules_cc_autoconf", version = "{version}")
</code></pre>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>At a high level, Autoconf is a system for asking the C/C++ toolchain questions
like <em>“does this header exist?”</em>, <em>“is this function available?”</em> or <em>“what is
the size of this type?”</em> and then encoding the answers into a generated
<code>config.h</code>. Projects can then use preprocessor conditionals around those
defines instead of hard‑coding assumptions about the platform.</p>
<p><code>rules_cc_autoconf</code> brings this style of configuration into <strong>Bazel</strong>. Rather
than running <code>./configure</code> as an opaque shell script, you describe checks in
Starlark (via the <code>macros</code> module) and run them with the <code>autoconf</code> rule. The
rule talks directly to the Bazel C/C++ toolchain, so it respects things like
platforms, features, remote execution and sandboxing.</p>
<p>Running traditional Autoconf inside Bazel (for example with a <code>genrule</code> that
invokes <code>./configure</code>) tends to be brittle: it often assumes a POSIX shell,
mutates the source tree, and performs many unrelated checks in one big step.
That makes caching and debugging harder, and is awkward on non‑Unix platforms
or in remote execution environments.</p>
<p>In contrast, this rule generates a small JSON config for each <code>autoconf</code>
target and runs a dedicated C++ tool that executes <em>only</em> the checks you
requested. That gives you:</p>
<ul>
<li>granular actions that cache well and are easy to reason about</li>
<li>hermetic behaviour (no in‑tree <code>config.status</code>, <code>config.log</code>, etc.)</li>
<li>configuration that is driven by Bazel’s toolchain and platform selection</li>
</ul>
<p>The result is the same style of <code>config.h</code> you would expect from GNU Autoconf,
but integrated cleanly into Bazel builds.</p>
<h2 id="why-not-just-run-autoconf"><a class="header" href="#why-not-just-run-autoconf">Why not just run Autoconf?</a></h2>
<p>GNU <a href="https://www.gnu.org/software/autoconf/">Autoconf</a> is excellent at probing
platform capabilities and generating Make-based build trees. However, dropping
<code>./configure</code> into a Bazel build has a few downsides:</p>
<ul>
<li><strong>Non-hermetic</strong>: traditional Autoconf expects to mutate the source tree
(creating <code>config.status</code>, <code>config.log</code>, generated headers, etc.), which
conflicts with Bazel’s sandboxing and caching model.</li>
<li><strong>Opaque, coarse-grained actions</strong>: a single <code>configure</code> step can do dozens of
unrelated checks at once, making cache behaviour and debugging harder.</li>
<li><strong>Environment-sensitive</strong>: running shell scripts and toolchain discovery
inside a Bazel action is fragile across platforms, remote execution, and
containerized builds.</li>
</ul>
<p>Projects in the
<a href="https://github.com/bazelbuild/bazel-central-registry">Bazel Central Registry</a>
often reimplement the <em>build</em> logic in Bazel, but they still miss Autoconf’s
convenient <code>config.h</code> generation. <code>rules_cc_autoconf</code> focuses on that gap: it
provides autoconf-like checks in a hermetic, deterministic way, driven entirely
by Bazel’s C/C++ toolchain configuration.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rules"><a class="header" href="#rules">Rules</a></h1>
<ul>
<li><a href="./autoconf.html#autoconf">autoconf</a></li>
<li><a href="./autoconf_hdr.html#autoconf_hdr">autoconf_hdr</a></li>
<li><a href="./package_info.html#package_info">package_info</a></li>
<li><a href="./checks.html#checks">checks</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><!-- Generated with Stardoc: http://skydoc.bazel.build -->
<h1 id="autoconf"><a class="header" href="#autoconf">autoconf</a></h1>
<h2 id="rules-1"><a class="header" href="#rules-1">Rules</a></h2>
<ul>
<li><a href="autoconf.html#autoconf">autoconf</a></li>
</ul>
<p><a id="autoconf"></a></p>
<h2 id="autoconf-1"><a class="header" href="#autoconf-1">autoconf</a></h2>
<pre>
load("@rules_cc_autoconf//autoconf:autoconf.bzl", "autoconf")

autoconf(<a href="autoconf.html#autoconf-name">name</a>, <a href="autoconf.html#autoconf-deps">deps</a>, <a href="autoconf.html#autoconf-checks">checks</a>)
</pre>
<p>Run autoconf-like checks and produce results.</p>
<p>This rule runs compilation checks against the configured cc_toolchain and produces
a JSON results file containing the check outcomes. Unlike <code>autoconf_hdr</code>, this rule
does not generate any header files - it only performs checks.</p>
<p>Example:</p>
<pre><code class="language-python">load("@rules_cc_autoconf//autoconf:checks.bzl", "checks")

autoconf(
    name = "config",
    checks = [
        checks.AC_CHECK_HEADER("stdio.h"),
        checks.AC_CHECK_HEADER("stdlib.h"),
        checks.AC_CHECK_FUNC("printf"),
    ],
)
</code></pre>
<p>The results can then be used by <code>autoconf_hdr</code> or <code>autoconf_srcs</code> to generate headers
or wrapped source files.</p>
<p><strong>ATTRIBUTES</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">Description</th><th style="text-align: left">Type</th><th style="text-align: left">Mandatory</th><th style="text-align: left">Default</th></tr></thead><tbody>
<tr><td style="text-align: left"><a id="autoconf-name"></a>name</td><td style="text-align: left">A unique name for this target.</td><td style="text-align: left"><a href="https://bazel.build/concepts/labels#target-names">Name</a></td><td style="text-align: left">required</td><td style="text-align: left"></td></tr>
<tr><td style="text-align: left"><a id="autoconf-deps"></a>deps</td><td style="text-align: left">Additional <code>autoconf</code> or <code>package_info</code> dependencies.</td><td style="text-align: left"><a href="https://bazel.build/concepts/labels">List of labels</a></td><td style="text-align: left">optional</td><td style="text-align: left"><code>[]</code></td></tr>
<tr><td style="text-align: left"><a id="autoconf-checks"></a>checks</td><td style="text-align: left">List of JSON-encoded checks from checks (e.g., <code>checks.AC_CHECK_HEADER('stdio.h')</code>).</td><td style="text-align: left">List of strings</td><td style="text-align: left">optional</td><td style="text-align: left"><code>[]</code></td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><!-- Generated with Stardoc: http://skydoc.bazel.build -->
<h1 id="autoconf_hdr"><a class="header" href="#autoconf_hdr">autoconf_hdr</a></h1>
<h2 id="rules-2"><a class="header" href="#rules-2">Rules</a></h2>
<ul>
<li><a href="autoconf_hdr.html#autoconf_hdr">autoconf_hdr</a></li>
</ul>
<p><a id="autoconf_hdr"></a></p>
<h2 id="autoconf_hdr-1"><a class="header" href="#autoconf_hdr-1">autoconf_hdr</a></h2>
<pre>
load("@rules_cc_autoconf//autoconf:autoconf_hdr.bzl", "autoconf_hdr")

autoconf_hdr(<a href="autoconf_hdr.html#autoconf_hdr-name">name</a>, <a href="autoconf_hdr.html#autoconf_hdr-deps">deps</a>, <a href="autoconf_hdr.html#autoconf_hdr-out">out</a>, <a href="autoconf_hdr.html#autoconf_hdr-defaults">defaults</a>, <a href="autoconf_hdr.html#autoconf_hdr-defaults_exclude">defaults_exclude</a>, <a href="autoconf_hdr.html#autoconf_hdr-defaults_include">defaults_include</a>, <a href="autoconf_hdr.html#autoconf_hdr-inlines">inlines</a>, <a href="autoconf_hdr.html#autoconf_hdr-mode">mode</a>,
             <a href="autoconf_hdr.html#autoconf_hdr-substitutions">substitutions</a>, <a href="autoconf_hdr.html#autoconf_hdr-template">template</a>)
</pre>
<p>Generate configuration headers from results provided by <code>autoconf</code> targets.</p>
<p>This rule takes check results from <code>autoconf</code> targets (via <code>deps</code>) and generates a header file.
The template file (if provided) is used to format the output header.</p>
<p>Example:</p>
<pre><code class="language-python">load("@rules_cc_autoconf//autoconf:autoconf.bzl", "autoconf")
load("@rules_cc_autoconf//autoconf:autoconf_hdr.bzl", "autoconf_hdr")
load("@rules_cc_autoconf//autoconf:checks.bzl", "checks")

autoconf(
    name = "config_checks",
    checks = [
        checks.AC_CHECK_HEADER("stdio.h"),
        checks.AC_CHECK_HEADER("stdlib.h"),
        checks.AC_CHECK_FUNC("printf"),
    ],
)

autoconf_hdr(
    name = "config",
    out = "config.h",
    deps = [":config_checks"],
    template = "config.h.in",
)
</code></pre>
<p>Valid <code>mode</code> values:</p>
<ul>
<li><code>"defines"</code> (default): Only process defines (AC_DEFINE, AC_CHECK_*, etc.), not substitution variables (AC_SUBST). This is for config.h files.</li>
<li><code>"subst"</code>: Only process substitution variables (AC_SUBST), not defines. This is for subst.h files.</li>
<li><code>"all"</code>: Process both defines and substitution variables.</li>
</ul>
<pre><code>
This allows you to run checks once and generate multiple header files from the same results.

**ATTRIBUTES**


| Name  | Description | Type | Mandatory | Default |
| :------------- | :------------- | :------------- | :------------- | :------------- |
| &lt;a id="autoconf_hdr-name"&gt;&lt;/a&gt;name |  A unique name for this target.   | &lt;a href="https://bazel.build/concepts/labels#target-names"&gt;Name&lt;/a&gt; | required |  |
| &lt;a id="autoconf_hdr-deps"&gt;&lt;/a&gt;deps |  List of `autoconf` targets which provide check results. Results from all deps will be merged together, and duplicate define names will produce an error. If not provided, an empty results file will be created.   | &lt;a href="https://bazel.build/concepts/labels"&gt;List of labels&lt;/a&gt; | optional |  `[]`  |
| &lt;a id="autoconf_hdr-out"&gt;&lt;/a&gt;out |  The output config file (typically `config.h`).   | &lt;a href="https://bazel.build/concepts/labels"&gt;Label&lt;/a&gt;; &lt;a href="https://bazel.build/reference/be/common-definitions#configurable-attributes"&gt;nonconfigurable&lt;/a&gt; | required |  |
| &lt;a id="autoconf_hdr-defaults"&gt;&lt;/a&gt;defaults |  Whether to include toolchain defaults.&lt;br&gt;&lt;br&gt;When False (the default), no toolchain defaults are included and only the explicit deps provide check results. When True, defaults from the autoconf toolchain are included, subject to filtering by defaults_include or defaults_exclude.   | Boolean | optional |  `False`  |
| &lt;a id="autoconf_hdr-defaults_exclude"&gt;&lt;/a&gt;defaults_exclude |  Labels to exclude from toolchain defaults.&lt;br&gt;&lt;br&gt;Only effective when defaults=True. If specified, defaults from these labels are excluded. Labels not found in the toolchain are silently ignored. Mutually exclusive with defaults_include.   | &lt;a href="https://bazel.build/concepts/labels"&gt;List of labels&lt;/a&gt; | optional |  `[]`  |
| &lt;a id="autoconf_hdr-defaults_include"&gt;&lt;/a&gt;defaults_include |  Labels to include from toolchain defaults.&lt;br&gt;&lt;br&gt;Only effective when defaults=True. If specified, only defaults from these labels are included. An error is raised if a specified label is not found in the toolchain. Mutually exclusive with defaults_exclude.   | &lt;a href="https://bazel.build/concepts/labels"&gt;List of labels&lt;/a&gt; | optional |  `[]`  |
| &lt;a id="autoconf_hdr-inlines"&gt;&lt;/a&gt;inlines |  A mapping of strings to files for replace within the content of the given `template` attribute.&lt;br&gt;&lt;br&gt;The exact string in the template is replaced with the content of the associated file. Any `@VAR@` style placeholders in the inline file content will be replaced with their corresponding define values (package info, check results, etc.) after insertion.   | Dictionary: String -&gt; Label | optional |  `{}`  |
| &lt;a id="autoconf_hdr-mode"&gt;&lt;/a&gt;mode |  Processing mode that determines what should be replaced within the file.   | String | optional |  `"defines"`  |
| &lt;a id="autoconf_hdr-substitutions"&gt;&lt;/a&gt;substitutions |  A mapping of exact strings to replacement values.&lt;br&gt;&lt;br&gt;Each entry performs an exact text replacement in the template - the key string is replaced with the value string. No special patterns or wrappers are added.&lt;br&gt;&lt;br&gt;Example: &lt;pre&gt;&lt;code class="language-python"&gt;autoconf_hdr(&amp;#10;    name = "config",&amp;#10;    out = "config.h",&amp;#10;    template = "config.h.in",&amp;#10;    substitutions = {&amp;#10;        "@MY_VERSION@": "1.2.3",&amp;#10;        "@BUILD_TYPE@": "release",&amp;#10;        "PLACEHOLDER_TEXT": "actual_value",&amp;#10;    },&amp;#10;    deps = [":checks"],&amp;#10;)&lt;/code&gt;&lt;/pre&gt;&lt;br&gt;&lt;br&gt;This would replace the exact string `@MY_VERSION@` with `1.2.3`, `@BUILD_TYPE@` with `release`, and `PLACEHOLDER_TEXT` with `actual_value`.   | &lt;a href="https://bazel.build/rules/lib/dict"&gt;Dictionary: String -&gt; String&lt;/a&gt; | optional |  `{}`  |
| &lt;a id="autoconf_hdr-template"&gt;&lt;/a&gt;template |  Template file (`config.h.in`) to use as base for generating the header file. The template is used to format the output header, but does not generate any checks.   | &lt;a href="https://bazel.build/concepts/labels"&gt;Label&lt;/a&gt; | required |  |


</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- Generated with Stardoc: http://skydoc.bazel.build -->
<h1 id="autoconf_srcs"><a class="header" href="#autoconf_srcs">autoconf_srcs</a></h1>
<h2 id="rules-3"><a class="header" href="#rules-3">Rules</a></h2>
<ul>
<li><a href="autoconf_srcs.html#autoconf_srcs">autoconf_srcs</a></li>
</ul>
<p><a id="autoconf_srcs"></a></p>
<h2 id="autoconf_srcs-1"><a class="header" href="#autoconf_srcs-1">autoconf_srcs</a></h2>
<pre>
load("@rules_cc_autoconf//autoconf:autoconf_srcs.bzl", "autoconf_srcs")

autoconf_srcs(<a href="autoconf_srcs.html#autoconf_srcs-name">name</a>, <a href="autoconf_srcs.html#autoconf_srcs-deps">deps</a>, <a href="autoconf_srcs.html#autoconf_srcs-srcs">srcs</a>, <a href="autoconf_srcs.html#autoconf_srcs-defaults">defaults</a>, <a href="autoconf_srcs.html#autoconf_srcs-defaults_exclude">defaults_exclude</a>, <a href="autoconf_srcs.html#autoconf_srcs-defaults_include">defaults_include</a>, <a href="autoconf_srcs.html#autoconf_srcs-naming">naming</a>)
</pre>
<p>Generate wrapper sources that are conditionally enabled by autoconf results.</p>
<p>Typical use case:</p>
<pre><code class="language-python">load("@rules_cc_autoconf//autoconf:autoconf_srcs.bzl", "autoconf_srcs")
load("@rules_cc_autoconf//autoconf:autoconf.bzl", "autoconf")
load("@rules_cc_autoconf//autoconf:checks.bzl", "checks")
load("@rules_cc//cc:cc_library.bzl", "cc_library")

autoconf(
    name = "config",
    out = "config.h",
    checks = [
        # Feature is present on this platform/toolchain.
        checks.AC_CHECK_HEADER("foo.h", define = "HAVE_FOO"),
    ],
)

autoconf_srcs(
    name = "foo_srcs",
    deps = [":config"],
    srcs = {
        "uses_foo.c": "HAVE_FOO",
    },
)

cc_library(
    name = "foo",
    srcs = [":foo_srcs"],
    hdrs = [":config.h"],
)
</code></pre>
<p>In this setup <code>autoconf_srcs</code> reads the results from <code>:config</code> (or multiple targets via <code>deps</code>) and generates a
wrapped copy of <code>uses_foo.c</code> whose contents are effectively:</p>
<pre><code class="language-cc">#define HAVE_FOO 1      // when the check for HAVE_FOO succeeds
/* or: #undef HAVE_FOO  // when the check fails */
#ifdef HAVE_FOO
/* original uses_foo.c contents ... */
#endif
</code></pre>
<p>This is useful when you have platform-specific or optional sources that should
only be compiled when a particular autoconf check passes, without having to
manually maintain <code>#ifdef</code> guards in every source file.</p>
<p><strong>ATTRIBUTES</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">Description</th><th style="text-align: left">Type</th><th style="text-align: left">Mandatory</th><th style="text-align: left">Default</th></tr></thead><tbody>
<tr><td style="text-align: left"><a id="autoconf_srcs-name"></a>name</td><td style="text-align: left">A unique name for this target.</td><td style="text-align: left"><a href="https://bazel.build/concepts/labels#target-names">Name</a></td><td style="text-align: left">required</td><td style="text-align: left"></td></tr>
<tr><td style="text-align: left"><a id="autoconf_srcs-deps"></a>deps</td><td style="text-align: left">List of <code>autoconf</code> targets which provide defines. Results from all deps will be merged together, and duplicate define names will produce an error.</td><td style="text-align: left"><a href="https://bazel.build/concepts/labels">List of labels</a></td><td style="text-align: left">required</td><td style="text-align: left"></td></tr>
<tr><td style="text-align: left"><a id="autoconf_srcs-srcs"></a>srcs</td><td style="text-align: left">A mapping of source file to define required to compile the file.</td><td style="text-align: left"><a href="https://bazel.build/rules/lib/dict">Dictionary: Label -&gt; String</a></td><td style="text-align: left">required</td><td style="text-align: left"></td></tr>
<tr><td style="text-align: left"><a id="autoconf_srcs-defaults"></a>defaults</td><td style="text-align: left">Whether to include toolchain defaults.<br><br>When False (the default), no toolchain defaults are included and only the explicit deps provide check results. When True, defaults from the autoconf toolchain are included, subject to filtering by defaults_include or defaults_exclude.</td><td style="text-align: left">Boolean</td><td style="text-align: left">optional</td><td style="text-align: left"><code>False</code></td></tr>
<tr><td style="text-align: left"><a id="autoconf_srcs-defaults_exclude"></a>defaults_exclude</td><td style="text-align: left">Labels to exclude from toolchain defaults.<br><br>Only effective when defaults=True. If specified, defaults from these labels are excluded. Labels not found in the toolchain are silently ignored. Mutually exclusive with defaults_include.</td><td style="text-align: left"><a href="https://bazel.build/concepts/labels">List of labels</a></td><td style="text-align: left">optional</td><td style="text-align: left"><code>[]</code></td></tr>
<tr><td style="text-align: left"><a id="autoconf_srcs-defaults_include"></a>defaults_include</td><td style="text-align: left">Labels to include from toolchain defaults.<br><br>Only effective when defaults=True. If specified, only defaults from these labels are included. An error is raised if a specified label is not found in the toolchain. Mutually exclusive with defaults_exclude.</td><td style="text-align: left"><a href="https://bazel.build/concepts/labels">List of labels</a></td><td style="text-align: left">optional</td><td style="text-align: left"><code>[]</code></td></tr>
<tr><td style="text-align: left"><a id="autoconf_srcs-naming"></a>naming</td><td style="text-align: left">How to name generated sources: <code>package_relative</code> keeps the original package-relative path, <code>ac_suffix</code> inserts <code>.ac.</code> before the final suffix (e.g. <code>foo.cc -&gt; foo.ac.cc</code>), and <code>per_target</code> prefixes outputs with <code>{ctx.label.name}</code> to namespace them per rule.</td><td style="text-align: left">String</td><td style="text-align: left">optional</td><td style="text-align: left"><code>"package_relative"</code></td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><!-- Generated with Stardoc: http://skydoc.bazel.build -->
<h1 id="checks"><a class="header" href="#checks">checks</a></h1>
<p>This module provides Bazel macros that mirror GNU Autoconf's behavior.</p>
<h2 id="cache-variables-defines-and-subst-values"><a class="header" href="#cache-variables-defines-and-subst-values">Cache Variables, Defines, and Subst Values</a></h2>
<p>Checks (AC_CHECK_FUNC, AC_CHECK_HEADER, etc.) create cache variables by default, following
autoconf's naming convention:</p>
<ul>
<li>AC_CHECK_HEADER("foo.h") → cache variable "ac_cv_header_foo_h"</li>
<li>AC_CHECK_FUNC("foo") → cache variable "ac_cv_func_foo"</li>
<li>AC_CHECK_DECL("foo") → cache variable "ac_cv_have_decl_foo"</li>
</ul>
<p>Defines and subst values are created explicitly using AC_DEFINE and AC_SUBST.</p>
<h2 id="condition-resolution"><a class="header" href="#condition-resolution">Condition Resolution</a></h2>
<p>When AC_DEFINE or AC_SUBST use a <code>condition</code> parameter that references a cache variable
(e.g., <code>condition="ac_cv_header_foo_h"</code>), the condition is evaluated as a <strong>truthy check</strong>:</p>
<ul>
<li>
<p>Condition is <code>true</code> if:</p>
<ul>
<li>The cache variable exists (check was run)</li>
<li>The check succeeded (success = true)</li>
<li>The value is truthy (non-empty string, not "0")</li>
</ul>
</li>
<li>
<p>Condition is <code>false</code> if:</p>
<ul>
<li>The cache variable doesn't exist (check wasn't run)</li>
<li>The check failed (success = false)</li>
<li>The value is falsy (empty string or "0")</li>
</ul>
</li>
</ul>
<p>If the condition includes a comparison operator (e.g., <code>condition="ac_cv_header_foo_h==1"</code>),
it performs value comparison instead of truthy check.</p>
<p>Example:</p>
<pre><code class="language-python"># Check creates cache variable
macros.AC_CHECK_HEADER("alloca.h")
# → Creates cache variable: "ac_cv_header_alloca_h" with value "1" (if header exists)

# Define with truthy condition
macros.AC_DEFINE(
    "HAVE_ALLOCA_H",
    condition="ac_cv_header_alloca_h",  # Truthy: true if check succeeded and value is truthy
    if_true="1",
    if_false=None,  # Don't define if condition is false
)

# Subst with truthy condition
macros.AC_SUBST(
    "HAVE_ALLOCA_H",
    condition="ac_cv_header_alloca_h",  # Truthy check
    if_true="1",
    if_false="0",  # Always set subst value
)
</code></pre>
<h2 id="default-includes"><a class="header" href="#default-includes">Default Includes</a></h2>
<p>Default includes used by AC_CHECK_DECL, AC_CHECK_TYPE, etc. when no includes are specified.</p>
<p>GNU Autoconf's AC_INCLUDES_DEFAULT uses #ifdef HAVE_* guards, but that relies on
AC_CHECK_HEADERS_ONCE being called earlier to define those macros. In Bazel, each
compile test runs independently without access to results from other checks, so we
use unconditional includes instead. This matches what would happen on a modern
POSIX system where all the standard headers exist.</p>
<p>See: https://www.gnu.org/savannah-checkouts/gnu/autoconf/manual/autoconf-2.72/autoconf.html#Default-Includes</p>
<h2 id="header--includes-parameter"><a class="header" href="#header--includes-parameter">Header / includes parameter</a></h2>
<p>Checks that need to include headers (AC_CHECK_DECL, AC_CHECK_TYPE, AC_CHECK_SIZEOF,
AC_CHECK_MEMBER, etc.) take an <strong><code>includes</code></strong> parameter. <strong>AC_CHECK_FUNC</strong> does not
take includes (standard Autoconf link test only); use <strong>GL_CHECK_FUNCS_ANDROID</strong> (or
other GL_CHECK_FUNCS* in gnulib/macros.bzl) when includes are needed. Both of these forms are
supported:</p>
<p>Use <strong>include directives</strong> as strings, e.g. <code>"#include &lt;stdlib.h&gt;"</code> or
<code>"#include &lt;sys/stat.h&gt;"</code>, matching Autoconf/gnulib (e.g.
<code>gl_CHECK_FUNCS_ANDROID([faccessat], [[#include &lt;unistd.h&gt;]])</code>). The list is
joined with newlines to form the prologue of the test program.</p>
<p>The parameter <code>headers</code> is a deprecated alias for <code>includes</code>; prefer <code>includes</code>.</p>
<h2 id="functions"><a class="header" href="#functions">Functions</a></h2>
<ul>
<li><a href="checks.html#checks.AC_CHECK_ALIGNOF">checks.AC_CHECK_ALIGNOF</a></li>
<li><a href="checks.html#checks.AC_CHECK_CXX_COMPILER_FLAG">checks.AC_CHECK_CXX_COMPILER_FLAG</a></li>
<li><a href="checks.html#checks.AC_CHECK_C_COMPILER_FLAG">checks.AC_CHECK_C_COMPILER_FLAG</a></li>
<li><a href="checks.html#checks.AC_CHECK_DECL">checks.AC_CHECK_DECL</a></li>
<li><a href="checks.html#checks.AC_CHECK_FUNC">checks.AC_CHECK_FUNC</a></li>
<li><a href="checks.html#checks.AC_CHECK_HEADER">checks.AC_CHECK_HEADER</a></li>
<li><a href="checks.html#checks.AC_CHECK_LIB">checks.AC_CHECK_LIB</a></li>
<li><a href="checks.html#checks.AC_CHECK_MEMBER">checks.AC_CHECK_MEMBER</a></li>
<li><a href="checks.html#checks.AC_CHECK_SIZEOF">checks.AC_CHECK_SIZEOF</a></li>
<li><a href="checks.html#checks.AC_CHECK_TYPE">checks.AC_CHECK_TYPE</a></li>
<li><a href="checks.html#checks.AC_COMPUTE_INT">checks.AC_COMPUTE_INT</a></li>
<li><a href="checks.html#checks.AC_C_BIGENDIAN">checks.AC_C_BIGENDIAN</a></li>
<li><a href="checks.html#checks.AC_C_INLINE">checks.AC_C_INLINE</a></li>
<li><a href="checks.html#checks.AC_C_RESTRICT">checks.AC_C_RESTRICT</a></li>
<li><a href="checks.html#checks.AC_DEFINE">checks.AC_DEFINE</a></li>
<li><a href="checks.html#checks.AC_DEFINE_UNQUOTED">checks.AC_DEFINE_UNQUOTED</a></li>
<li><a href="checks.html#checks.AC_PROG_CC">checks.AC_PROG_CC</a></li>
<li><a href="checks.html#checks.AC_PROG_CC_C_O">checks.AC_PROG_CC_C_O</a></li>
<li><a href="checks.html#checks.AC_PROG_CXX">checks.AC_PROG_CXX</a></li>
<li><a href="checks.html#checks.AC_SUBST">checks.AC_SUBST</a></li>
<li><a href="checks.html#checks.AC_TRY_COMPILE">checks.AC_TRY_COMPILE</a></li>
<li><a href="checks.html#checks.AC_TRY_LINK">checks.AC_TRY_LINK</a></li>
<li><a href="checks.html#checks.M4_VARIABLE">checks.M4_VARIABLE</a></li>
<li><a href="checks.html#macros.AC_CHECK_DECLS">macros.AC_CHECK_DECLS</a></li>
<li><a href="checks.html#macros.AC_CHECK_FUNCS">macros.AC_CHECK_FUNCS</a></li>
<li><a href="checks.html#macros.AC_CHECK_HEADERS">macros.AC_CHECK_HEADERS</a></li>
<li><a href="checks.html#macros.AC_CHECK_MEMBERS">macros.AC_CHECK_MEMBERS</a></li>
<li><a href="checks.html#macros.AC_CHECK_TYPES">macros.AC_CHECK_TYPES</a></li>
<li><a href="checks.html#utils.AC_LANG_PROGRAM">utils.AC_LANG_PROGRAM</a></li>
</ul>
<p><a id="checks.AC_CHECK_ALIGNOF"></a></p>
<h2 id="checksac_check_alignof"><a class="header" href="#checksac_check_alignof">checks.AC_CHECK_ALIGNOF</a></h2>
<pre>
load("@rules_cc_autoconf//autoconf:checks.bzl", "checks")

checks.AC_CHECK_ALIGNOF(<a href="checks.html#checks.AC_CHECK_ALIGNOF-type_name">type_name</a>, *, <a href="checks.html#checks.AC_CHECK_ALIGNOF-define">define</a>, <a href="checks.html#checks.AC_CHECK_ALIGNOF-includes">includes</a>, <a href="checks.html#checks.AC_CHECK_ALIGNOF-language">language</a>, <a href="checks.html#checks.AC_CHECK_ALIGNOF-requires">requires</a>, <a href="checks.html#checks.AC_CHECK_ALIGNOF-subst">subst</a>)
</pre>
<p>Check the alignment of a type.</p>
<p>Original m4 example:</p>
<pre><code class="language-m4">AC_CHECK_ALIGNOF([int])
AC_CHECK_ALIGNOF([double], [[#include &lt;stddef.h&gt;]])
</code></pre>
<p>Example:</p>
<pre><code class="language-python">macros.AC_CHECK_ALIGNOF("int")
macros.AC_CHECK_ALIGNOF("double", includes = ["stddef.h"])
</code></pre>
<p>Cross-Compile Warning:
This macro is NOT cross-compile friendly. It requires compiling and
running code to determine the alignment, which doesn't work when cross-compiling.</p>
<p><strong>PARAMETERS</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">Description</th><th style="text-align: left">Default Value</th></tr></thead><tbody>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_ALIGNOF-type_name"></a>type_name</td><td style="text-align: left">Name of the type</td><td style="text-align: left">none</td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_ALIGNOF-define"></a>define</td><td style="text-align: left">Custom define name (defaults to <code>ALIGNOF_&lt;TYPE&gt;</code>)</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_ALIGNOF-includes"></a>includes</td><td style="text-align: left">Optional list of header names to include (e.g. <code>["stddef.h"]</code>)</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_ALIGNOF-language"></a>language</td><td style="text-align: left">Language to use for check (<code>"c"</code> or <code>"cpp"</code>)</td><td style="text-align: left"><code>"c"</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_ALIGNOF-requires"></a>requires</td><td style="text-align: left">List of requirements that must be met before this check runs. Can be simple define names (e.g., <code>"HAVE_FOO"</code>) or value-based requirements (e.g., <code>"REPLACE_FSTAT=1"</code> to require specific value)</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_ALIGNOF-subst"></a>subst</td><td style="text-align: left">If True, mark as a substitution variable (for @VAR@ replacement in subst.h).</td><td style="text-align: left"><code>None</code></td></tr>
</tbody></table>
</div>
<p><strong>RETURNS</strong></p>
<p>A JSON-encoded check string for use with the autoconf rule.</p>
<p><a id="checks.AC_CHECK_CXX_COMPILER_FLAG"></a></p>
<h2 id="checksac_check_cxx_compiler_flag"><a class="header" href="#checksac_check_cxx_compiler_flag">checks.AC_CHECK_CXX_COMPILER_FLAG</a></h2>
<pre>
load("@rules_cc_autoconf//autoconf:checks.bzl", "checks")

checks.AC_CHECK_CXX_COMPILER_FLAG(<a href="checks.html#checks.AC_CHECK_CXX_COMPILER_FLAG-flag">flag</a>, <a href="checks.html#checks.AC_CHECK_CXX_COMPILER_FLAG-define">define</a>, <a href="checks.html#checks.AC_CHECK_CXX_COMPILER_FLAG-language">language</a>, <a href="checks.html#checks.AC_CHECK_CXX_COMPILER_FLAG-requires">requires</a>, <a href="checks.html#checks.AC_CHECK_CXX_COMPILER_FLAG-subst">subst</a>)
</pre>
<p>Check if the C++ compiler supports a specific flag.</p>
<p>Original m4 example:</p>
<pre><code class="language-m4">AC_CHECK_CXX_COMPILER_FLAG([-std=c++17], [CXXFLAGS="$CXXFLAGS -std=c++17"])
</code></pre>
<p>Example:</p>
<pre><code class="language-python">macros.AC_CHECK_CXX_COMPILER_FLAG("-std=c++17")
macros.AC_CHECK_CXX_COMPILER_FLAG("-Wall")
</code></pre>
<p><strong>PARAMETERS</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">Description</th><th style="text-align: left">Default Value</th></tr></thead><tbody>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_CXX_COMPILER_FLAG-flag"></a>flag</td><td style="text-align: left">Compiler flag to test (e.g., <code>"-Wall"</code>, <code>"-std=c++17"</code>)</td><td style="text-align: left">none</td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_CXX_COMPILER_FLAG-define"></a>define</td><td style="text-align: left">Custom define name (defaults to <code>HAVE_FLAG_&lt;FLAG&gt;</code>)</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_CXX_COMPILER_FLAG-language"></a>language</td><td style="text-align: left">Language to use for check (<code>"c"</code> or <code>"cpp"</code>)</td><td style="text-align: left"><code>"cpp"</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_CXX_COMPILER_FLAG-requires"></a>requires</td><td style="text-align: left">List of requirements that must be met before this check runs. Can be simple define names (e.g., <code>"HAVE_FOO"</code>) or value-based requirements (e.g., <code>"REPLACE_FSTAT=1"</code> to require specific value)</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_CXX_COMPILER_FLAG-subst"></a>subst</td><td style="text-align: left">If True, mark as a substitution variable (for @VAR@ replacement in subst.h).</td><td style="text-align: left"><code>None</code></td></tr>
</tbody></table>
</div>
<p><strong>RETURNS</strong></p>
<p>A JSON-encoded check string for use with the autoconf rule.</p>
<p><a id="checks.AC_CHECK_C_COMPILER_FLAG"></a></p>
<h2 id="checksac_check_c_compiler_flag"><a class="header" href="#checksac_check_c_compiler_flag">checks.AC_CHECK_C_COMPILER_FLAG</a></h2>
<pre>
load("@rules_cc_autoconf//autoconf:checks.bzl", "checks")

checks.AC_CHECK_C_COMPILER_FLAG(<a href="checks.html#checks.AC_CHECK_C_COMPILER_FLAG-flag">flag</a>, <a href="checks.html#checks.AC_CHECK_C_COMPILER_FLAG-define">define</a>, <a href="checks.html#checks.AC_CHECK_C_COMPILER_FLAG-language">language</a>, <a href="checks.html#checks.AC_CHECK_C_COMPILER_FLAG-requires">requires</a>, <a href="checks.html#checks.AC_CHECK_C_COMPILER_FLAG-subst">subst</a>)
</pre>
<p>Check if the C compiler supports a specific flag.</p>
<p>Original m4 example:</p>
<pre><code class="language-m4">AC_CHECK_C_COMPILER_FLAG([-Wall], [CFLAGS="$CFLAGS -Wall"])
</code></pre>
<p>Example:</p>
<pre><code class="language-python">macros.AC_CHECK_C_COMPILER_FLAG("-Wall")
macros.AC_CHECK_C_COMPILER_FLAG("-std=c99")
</code></pre>
<p><strong>PARAMETERS</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">Description</th><th style="text-align: left">Default Value</th></tr></thead><tbody>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_C_COMPILER_FLAG-flag"></a>flag</td><td style="text-align: left">Compiler flag to test (e.g., <code>"-Wall"</code>, <code>"-std=c99"</code>)</td><td style="text-align: left">none</td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_C_COMPILER_FLAG-define"></a>define</td><td style="text-align: left">Custom define name (defaults to <code>HAVE_FLAG_&lt;FLAG&gt;</code>)</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_C_COMPILER_FLAG-language"></a>language</td><td style="text-align: left">Language to use for check (<code>"c"</code> or <code>"cpp"</code>)</td><td style="text-align: left"><code>"c"</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_C_COMPILER_FLAG-requires"></a>requires</td><td style="text-align: left">List of requirements that must be met before this check runs. Can be simple define names (e.g., <code>"HAVE_FOO"</code>) or value-based requirements (e.g., <code>"REPLACE_FSTAT=1"</code> to require specific value)</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_C_COMPILER_FLAG-subst"></a>subst</td><td style="text-align: left">If True, mark as a substitution variable (for @VAR@ replacement in subst.h).</td><td style="text-align: left"><code>None</code></td></tr>
</tbody></table>
</div>
<p><strong>RETURNS</strong></p>
<p>A JSON-encoded check string for use with the autoconf rule.</p>
<p><a id="checks.AC_CHECK_DECL"></a></p>
<h2 id="checksac_check_decl"><a class="header" href="#checksac_check_decl">checks.AC_CHECK_DECL</a></h2>
<pre>
load("@rules_cc_autoconf//autoconf:checks.bzl", "checks")

checks.AC_CHECK_DECL(<a href="checks.html#checks.AC_CHECK_DECL-symbol">symbol</a>, *, <a href="checks.html#checks.AC_CHECK_DECL-name">name</a>, <a href="checks.html#checks.AC_CHECK_DECL-define">define</a>, <a href="checks.html#checks.AC_CHECK_DECL-includes">includes</a>, <a href="checks.html#checks.AC_CHECK_DECL-compile_defines">compile_defines</a>, <a href="checks.html#checks.AC_CHECK_DECL-language">language</a>, <a href="checks.html#checks.AC_CHECK_DECL-requires">requires</a>,
                     <a href="checks.html#checks.AC_CHECK_DECL-if_true">if_true</a>, <a href="checks.html#checks.AC_CHECK_DECL-if_false">if_false</a>, <a href="checks.html#checks.AC_CHECK_DECL-subst">subst</a>)
</pre>
<p>Check if a symbol is declared.</p>
<p>Original m4 example:</p>
<pre><code class="language-m4">AC_CHECK_DECL([NULL], [AC_DEFINE([HAVE_DECL_NULL], [1])], [], [[#include &lt;stddef.h&gt;]])
AC_CHECK_DECL([stdout], [AC_DEFINE([HAVE_DECL_STDOUT], [1])], [], [[#include &lt;stdio.h&gt;]])
</code></pre>
<p>Example:</p>
<pre><code class="language-python"># Cache variable only (no define, no subst)
macros.AC_CHECK_DECL("NULL", includes = ["stddef.h"])
# → Creates cache variable: "ac_cv_have_decl_NULL"

# Cache variable + define (explicit name)
macros.AC_CHECK_DECL("stdout", includes = ["stdio.h"], define = "HAVE_DECL_STDOUT")
# → Creates cache variable: "ac_cv_have_decl_stdout"
# → Creates define: "HAVE_DECL_STDOUT" in config.h
</code></pre>
<p>Note:
This is different from <code>AC_CHECK_SYMBOL</code> - it checks if something is
declared (not just <code>#defined</code>).</p>
<pre><code>When no includes are specified, the standard default includes
are used (AC_INCLUDES_DEFAULT from GNU Autoconf).

Use header names like `"stdlib.h"` (not `"#include &lt;stdlib.h&gt;"`).
</code></pre>
<p><strong>PARAMETERS</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">Description</th><th style="text-align: left">Default Value</th></tr></thead><tbody>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_DECL-symbol"></a>symbol</td><td style="text-align: left">Name of the symbol to check</td><td style="text-align: left">none</td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_DECL-name"></a>name</td><td style="text-align: left">Cache variable name (defaults to <code>ac_cv_have_decl_&lt;SYMBOL&gt;</code> following autoconf convention)</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_DECL-define"></a>define</td><td style="text-align: left">Define behavior: - <code>None</code> (default): No define is created, only cache variable - <code>True</code>: Create define using the cache variable name (<code>name</code>) - <code>"HAVE_FOO"</code>: Create define with explicit name <code>HAVE_FOO</code> (implies <code>define=True</code>)</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_DECL-includes"></a>includes</td><td style="text-align: left">Optional list of header names to include (e.g. <code>["stdlib.h"]</code>). If not specified and <code>headers</code> is not specified, uses AC_INCLUDES_DEFAULT.</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_DECL-compile_defines"></a>compile_defines</td><td style="text-align: left">Optional list of preprocessor define names from previous checks to add before includes (e.g., <code>["_GNU_SOURCE", "_DARWIN_C_SOURCE"]</code>). Each string must match the define name of a previous check. The values from those checks will be used automatically.</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_DECL-language"></a>language</td><td style="text-align: left">Language to use for check (<code>"c"</code> or <code>"cpp"</code>)</td><td style="text-align: left"><code>"c"</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_DECL-requires"></a>requires</td><td style="text-align: left">Requirements that must be met for this check to run. Can be define names (e.g., <code>"HAVE_FOO"</code>), negated (e.g., <code>"!HAVE_FOO"</code>), or value-based (e.g., <code>"REPLACE_FSTAT==1"</code>, <code>"REPLACE_FSTAT!=0"</code>).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_DECL-if_true"></a>if_true</td><td style="text-align: left">Value to use when check succeeds (currently not used for this check type).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_DECL-if_false"></a>if_false</td><td style="text-align: left">Value to use when check fails (currently not used for this check type).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_DECL-subst"></a>subst</td><td style="text-align: left">Subst behavior: - <code>None</code> (default): No subst is created, only cache variable - <code>True</code>: Create subst using the cache variable name (<code>name</code>) - <code>"HAVE_FOO"</code>: Create subst with explicit name <code>HAVE_FOO</code> (implies <code>subst=True</code>)</td><td style="text-align: left"><code>None</code></td></tr>
</tbody></table>
</div>
<p><strong>RETURNS</strong></p>
<p>A JSON-encoded check string for use with the autoconf rule.</p>
<p><a id="checks.AC_CHECK_FUNC"></a></p>
<h2 id="checksac_check_func"><a class="header" href="#checksac_check_func">checks.AC_CHECK_FUNC</a></h2>
<pre>
load("@rules_cc_autoconf//autoconf:checks.bzl", "checks")

checks.AC_CHECK_FUNC(<a href="checks.html#checks.AC_CHECK_FUNC-function">function</a>, <a href="checks.html#checks.AC_CHECK_FUNC-name">name</a>, *, <a href="checks.html#checks.AC_CHECK_FUNC-define">define</a>, <a href="checks.html#checks.AC_CHECK_FUNC-code">code</a>, <a href="checks.html#checks.AC_CHECK_FUNC-language">language</a>, <a href="checks.html#checks.AC_CHECK_FUNC-compile_defines">compile_defines</a>, <a href="checks.html#checks.AC_CHECK_FUNC-requires">requires</a>, <a href="checks.html#checks.AC_CHECK_FUNC-subst">subst</a>)
</pre>
<p>Check for a function.</p>
<p>Original m4 example:</p>
<pre><code class="language-m4">AC_CHECK_FUNC([malloc])
AC_CHECK_FUNC([mmap], [AC_DEFINE([HAVE_MMAP_FEATURE], [1])])
</code></pre>
<p>Example:</p>
<pre><code class="language-python"># Cache variable only (no define, no subst)
macros.AC_CHECK_FUNC("malloc")
# → Creates cache variable: "ac_cv_func_malloc"

# Cache variable + define (explicit name)
macros.AC_CHECK_FUNC("mmap", define = "HAVE_MMAP")
# → Creates cache variable: "ac_cv_func_mmap"
# → Creates define: "HAVE_MMAP" in config.h

# Cache variable + define (using cache var name)
macros.AC_CHECK_FUNC("mmap", define = True)
# → Creates cache variable: "ac_cv_func_mmap"
# → Creates define: "ac_cv_func_mmap" in config.h

# Cache variable + subst
macros.AC_CHECK_FUNC("_Exit", subst = True)
# → Creates cache variable: "ac_cv_func__Exit"
# → Creates subst: "ac_cv_func__Exit" in subst.h
</code></pre>
<p><strong>PARAMETERS</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">Description</th><th style="text-align: left">Default Value</th></tr></thead><tbody>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_FUNC-function"></a>function</td><td style="text-align: left">Name of the function (e.g., <code>"printf"</code>)</td><td style="text-align: left">none</td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_FUNC-name"></a>name</td><td style="text-align: left">Cache variable name (defaults to <code>ac_cv_func_&lt;FUNCTION&gt;</code> following autoconf convention)</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_FUNC-define"></a>define</td><td style="text-align: left">Define behavior: - <code>None</code> (default): No define is created, only cache variable - <code>True</code>: Create define using the cache variable name (<code>name</code>) - <code>"HAVE_FOO"</code>: Create define with explicit name <code>HAVE_FOO</code> (implies <code>define=True</code>)</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_FUNC-code"></a>code</td><td style="text-align: left">Custom code to compile (optional).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_FUNC-language"></a>language</td><td style="text-align: left">Language to use for check (<code>"c"</code> or <code>"cpp"</code>)</td><td style="text-align: left"><code>"c"</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_FUNC-compile_defines"></a>compile_defines</td><td style="text-align: left">Optional list of preprocessor define names from previous checks to add before includes (e.g., <code>["_GNU_SOURCE", "_DARWIN_C_SOURCE"]</code>). Each string must match the define name of a previous check. The values from those checks will be used automatically.</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_FUNC-requires"></a>requires</td><td style="text-align: left">Requirements that must be met for this check to run. Can be define names (e.g., <code>"HAVE_FOO"</code>), negated (e.g., <code>"!HAVE_FOO"</code>), or value-based (e.g., <code>"REPLACE_FSTAT==1"</code>, <code>"REPLACE_FSTAT!=0"</code>).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_FUNC-subst"></a>subst</td><td style="text-align: left">Subst behavior: - <code>None</code> (default): No subst is created, only cache variable - <code>True</code>: Create subst using the cache variable name (<code>name</code>) - <code>"HAVE_FOO"</code>: Create subst with explicit name <code>HAVE_FOO</code> (implies <code>subst=True</code>)</td><td style="text-align: left"><code>None</code></td></tr>
</tbody></table>
</div>
<p><strong>RETURNS</strong></p>
<p>A JSON-encoded check string for use with the autoconf rule.</p>
<p><a id="checks.AC_CHECK_HEADER"></a></p>
<h2 id="checksac_check_header"><a class="header" href="#checksac_check_header">checks.AC_CHECK_HEADER</a></h2>
<pre>
load("@rules_cc_autoconf//autoconf:checks.bzl", "checks")

checks.AC_CHECK_HEADER(<a href="checks.html#checks.AC_CHECK_HEADER-header">header</a>, <a href="checks.html#checks.AC_CHECK_HEADER-name">name</a>, <a href="checks.html#checks.AC_CHECK_HEADER-define">define</a>, <a href="checks.html#checks.AC_CHECK_HEADER-includes">includes</a>, <a href="checks.html#checks.AC_CHECK_HEADER-language">language</a>, <a href="checks.html#checks.AC_CHECK_HEADER-compile_defines">compile_defines</a>, <a href="checks.html#checks.AC_CHECK_HEADER-requires">requires</a>, <a href="checks.html#checks.AC_CHECK_HEADER-subst">subst</a>)
</pre>
<p>Check for a header file.</p>
<p>Original m4 example:</p>
<pre><code class="language-m4">AC_CHECK_HEADER([stdio.h])
AC_CHECK_HEADER([pthread.h], [AC_CHECK_FUNC([pthread_create])])
</code></pre>
<p>Example:</p>
<pre><code class="language-python"># Cache variable only (no define, no subst)
macros.AC_CHECK_HEADER("stdio.h")
# → Creates cache variable: "ac_cv_header_stdio_h"

# Cache variable + define (explicit name)
macros.AC_CHECK_HEADER("pthread.h", define = "HAVE_PTHREAD_H")
# → Creates cache variable: "ac_cv_header_pthread_h"
# → Creates define: "HAVE_PTHREAD_H" in config.h

# Cache variable + define (using cache var name)
macros.AC_CHECK_HEADER("pthread.h", define = True)
# → Creates cache variable: "ac_cv_header_pthread_h"
# → Creates define: "ac_cv_header_pthread_h" in config.h
</code></pre>
<p><strong>PARAMETERS</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">Description</th><th style="text-align: left">Default Value</th></tr></thead><tbody>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_HEADER-header"></a>header</td><td style="text-align: left">Name of the header file (e.g., <code>"stdio.h"</code>)</td><td style="text-align: left">none</td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_HEADER-name"></a>name</td><td style="text-align: left">Cache variable name (defaults to <code>ac_cv_header_&lt;HEADER&gt;</code> following autoconf convention)</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_HEADER-define"></a>define</td><td style="text-align: left">Define behavior: - <code>None</code> (default): No define is created, only cache variable - <code>True</code>: Create define using the cache variable name (<code>name</code>) - <code>"HAVE_FOO"</code>: Create define with explicit name <code>HAVE_FOO</code> (implies <code>define=True</code>)</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_HEADER-includes"></a>includes</td><td style="text-align: left">Optional list of headers to include.</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_HEADER-language"></a>language</td><td style="text-align: left">Language to use for check (<code>"c"</code> or <code>"cpp"</code>)</td><td style="text-align: left"><code>"c"</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_HEADER-compile_defines"></a>compile_defines</td><td style="text-align: left">Optional list of preprocessor define names from previous checks to add before includes (e.g., <code>["_GNU_SOURCE", "_DARWIN_C_SOURCE"]</code>). Each string must match the define name of a previous check. The values from those checks will be used automatically.</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_HEADER-requires"></a>requires</td><td style="text-align: left">Requirements that must be met for this check to run. Can be define names (e.g., <code>"HAVE_FOO"</code>), negated (e.g., <code>"!HAVE_FOO"</code>), or value-based (e.g., <code>"REPLACE_FSTAT==1"</code>, <code>"REPLACE_FSTAT!=0"</code>).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_HEADER-subst"></a>subst</td><td style="text-align: left">Subst behavior: - <code>None</code> (default): No subst is created, only cache variable - <code>True</code>: Create subst using the cache variable name (<code>name</code>) - <code>"HAVE_FOO"</code>: Create subst with explicit name <code>HAVE_FOO</code> (implies <code>subst=True</code>)</td><td style="text-align: left"><code>None</code></td></tr>
</tbody></table>
</div>
<p><strong>RETURNS</strong></p>
<p>A JSON-encoded check string for use with the autoconf rule.</p>
<p><a id="checks.AC_CHECK_LIB"></a></p>
<h2 id="checksac_check_lib"><a class="header" href="#checksac_check_lib">checks.AC_CHECK_LIB</a></h2>
<pre>
load("@rules_cc_autoconf//autoconf:checks.bzl", "checks")

checks.AC_CHECK_LIB(<a href="checks.html#checks.AC_CHECK_LIB-library">library</a>, <a href="checks.html#checks.AC_CHECK_LIB-function">function</a>, *, <a href="checks.html#checks.AC_CHECK_LIB-name">name</a>, <a href="checks.html#checks.AC_CHECK_LIB-define">define</a>, <a href="checks.html#checks.AC_CHECK_LIB-code">code</a>, <a href="checks.html#checks.AC_CHECK_LIB-language">language</a>, <a href="checks.html#checks.AC_CHECK_LIB-requires">requires</a>, <a href="checks.html#checks.AC_CHECK_LIB-if_true">if_true</a>, <a href="checks.html#checks.AC_CHECK_LIB-if_false">if_false</a>,
                    <a href="checks.html#checks.AC_CHECK_LIB-subst">subst</a>)
</pre>
<p>Check for a function in a library.</p>
<p>Original m4 example:</p>
<pre><code class="language-m4">AC_CHECK_LIB([m], [cos])
AC_CHECK_LIB([pthread], [pthread_create])
</code></pre>
<p>Example:</p>
<pre><code class="language-python">macros.AC_CHECK_LIB("m", "cos")
macros.AC_CHECK_LIB("pthread", "pthread_create")
</code></pre>
<p>Note:
This checks if the specified function is available in the given library.
It attempts to link against <code>-l&lt;library&gt;</code> to verify the library provides
the function.</p>
<p><strong>PARAMETERS</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">Description</th><th style="text-align: left">Default Value</th></tr></thead><tbody>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_LIB-library"></a>library</td><td style="text-align: left">Library name without the <code>-l</code> prefix (e.g., <code>"m"</code>, <code>"pthread"</code>)</td><td style="text-align: left">none</td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_LIB-function"></a>function</td><td style="text-align: left">Function name to check for in the library (e.g., <code>"cos"</code>, <code>"pthread_create"</code>)</td><td style="text-align: left">none</td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_LIB-name"></a>name</td><td style="text-align: left">The name of the cache variable. Defaults to <code>ac_cv_lib_library_function</code></td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_LIB-define"></a>define</td><td style="text-align: left">Custom define name (defaults to <code>HAVE_LIB&lt;LIBRARY&gt;</code>)</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_LIB-code"></a>code</td><td style="text-align: left">Custom code to compile and link (optional)</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_LIB-language"></a>language</td><td style="text-align: left">Language to use for check (<code>"c"</code> or <code>"cpp"</code>)</td><td style="text-align: left"><code>"c"</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_LIB-requires"></a>requires</td><td style="text-align: left">Requirements that must be met for this check to run. Can be define names (e.g., <code>"HAVE_FOO"</code>), negated (e.g., <code>"!HAVE_FOO"</code>), or value-based (e.g., <code>"REPLACE_FSTAT==1"</code>, <code>"REPLACE_FSTAT!=0"</code>).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_LIB-if_true"></a>if_true</td><td style="text-align: left">Value to use when check succeeds (currently not used for this check type).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_LIB-if_false"></a>if_false</td><td style="text-align: left">Value to use when check fails (currently not used for this check type).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_LIB-subst"></a>subst</td><td style="text-align: left">If True, mark as a substitution variable (for @VAR@ replacement in subst.h).</td><td style="text-align: left"><code>None</code></td></tr>
</tbody></table>
</div>
<p><strong>RETURNS</strong></p>
<p>A JSON-encoded check string for use with the autoconf rule.</p>
<p><a id="checks.AC_CHECK_MEMBER"></a></p>
<h2 id="checksac_check_member"><a class="header" href="#checksac_check_member">checks.AC_CHECK_MEMBER</a></h2>
<pre>
load("@rules_cc_autoconf//autoconf:checks.bzl", "checks")

checks.AC_CHECK_MEMBER(<a href="checks.html#checks.AC_CHECK_MEMBER-aggregate_member">aggregate_member</a>, *, <a href="checks.html#checks.AC_CHECK_MEMBER-name">name</a>, <a href="checks.html#checks.AC_CHECK_MEMBER-define">define</a>, <a href="checks.html#checks.AC_CHECK_MEMBER-includes">includes</a>, <a href="checks.html#checks.AC_CHECK_MEMBER-language">language</a>, <a href="checks.html#checks.AC_CHECK_MEMBER-compile_defines">compile_defines</a>,
                       <a href="checks.html#checks.AC_CHECK_MEMBER-requires">requires</a>, <a href="checks.html#checks.AC_CHECK_MEMBER-if_true">if_true</a>, <a href="checks.html#checks.AC_CHECK_MEMBER-if_false">if_false</a>, <a href="checks.html#checks.AC_CHECK_MEMBER-subst">subst</a>)
</pre>
<p>Check if a struct or union has a member.</p>
<p>Original m4 example:</p>
<pre><code class="language-m4">AC_CHECK_MEMBER([struct stat.st_rdev], [AC_DEFINE([HAVE_STRUCT_STAT_ST_RDEV], [1])], [], [[#include &lt;sys/stat.h&gt;]])
AC_CHECK_MEMBER([struct tm.tm_zone], [AC_DEFINE([HAVE_STRUCT_TM_TM_ZONE], [1])], [], [[#include &lt;time.h&gt;]])
</code></pre>
<p>Example:</p>
<pre><code class="language-python">macros.AC_CHECK_MEMBER("struct stat.st_rdev", includes = ["sys/stat.h"])
macros.AC_CHECK_MEMBER("struct tm.tm_zone", includes = ["time.h"])
</code></pre>
<p><strong>PARAMETERS</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">Description</th><th style="text-align: left">Default Value</th></tr></thead><tbody>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_MEMBER-aggregate_member"></a>aggregate_member</td><td style="text-align: left">Struct or union name with (e.g., <code>struct stat.st_rdev</code>)</td><td style="text-align: left">none</td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_MEMBER-name"></a>name</td><td style="text-align: left">Cache variable name (defaults to <code>ac_cv_member_aggregate_member</code> following autoconf convention)</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_MEMBER-define"></a>define</td><td style="text-align: left">Custom define name (defaults to <code>HAVE_&lt;AGGREGATE&gt;_&lt;MEMBER&gt;</code>)</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_MEMBER-includes"></a>includes</td><td style="text-align: left">Optional list of header names to include (e.g. <code>["sys/stat.h"]</code>)</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_MEMBER-language"></a>language</td><td style="text-align: left">Language to use for check (<code>"c"</code> or <code>"cpp"</code>)</td><td style="text-align: left"><code>"c"</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_MEMBER-compile_defines"></a>compile_defines</td><td style="text-align: left">Optional list of preprocessor define names from previous checks to add before includes (e.g., <code>["_GNU_SOURCE", "_DARWIN_C_SOURCE"]</code>). Each string must match the define name of a previous check. The values from those checks will be used automatically.</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_MEMBER-requires"></a>requires</td><td style="text-align: left">Requirements that must be met for this check to run. Can be define names (e.g., <code>"HAVE_FOO"</code>), negated (e.g., <code>"!HAVE_FOO"</code>), or value-based (e.g., <code>"REPLACE_FSTAT==1"</code>, <code>"REPLACE_FSTAT!=0"</code>).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_MEMBER-if_true"></a>if_true</td><td style="text-align: left">Value to use when check succeeds (currently not used for this check type).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_MEMBER-if_false"></a>if_false</td><td style="text-align: left">Value to use when check fails (currently not used for this check type).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_MEMBER-subst"></a>subst</td><td style="text-align: left">If True, automatically create a substitution variable with the same name that will be set to "1" if the check succeeds, "0" if it fails.</td><td style="text-align: left"><code>None</code></td></tr>
</tbody></table>
</div>
<p><strong>RETURNS</strong></p>
<p>A JSON-encoded check string for use with the autoconf rule.</p>
<p><a id="checks.AC_CHECK_SIZEOF"></a></p>
<h2 id="checksac_check_sizeof"><a class="header" href="#checksac_check_sizeof">checks.AC_CHECK_SIZEOF</a></h2>
<pre>
load("@rules_cc_autoconf//autoconf:checks.bzl", "checks")

checks.AC_CHECK_SIZEOF(<a href="checks.html#checks.AC_CHECK_SIZEOF-type_name">type_name</a>, *, <a href="checks.html#checks.AC_CHECK_SIZEOF-name">name</a>, <a href="checks.html#checks.AC_CHECK_SIZEOF-define">define</a>, <a href="checks.html#checks.AC_CHECK_SIZEOF-includes">includes</a>, <a href="checks.html#checks.AC_CHECK_SIZEOF-language">language</a>, <a href="checks.html#checks.AC_CHECK_SIZEOF-requires">requires</a>, <a href="checks.html#checks.AC_CHECK_SIZEOF-if_true">if_true</a>, <a href="checks.html#checks.AC_CHECK_SIZEOF-if_false">if_false</a>,
                       <a href="checks.html#checks.AC_CHECK_SIZEOF-subst">subst</a>)
</pre>
<p>Check the size of a type.</p>
<p>Original m4 example:</p>
<pre><code class="language-m4">AC_CHECK_SIZEOF([int])
AC_CHECK_SIZEOF([size_t], [], [[#include &lt;stddef.h&gt;]])
</code></pre>
<p>Example:</p>
<pre><code class="language-python"># Cache variable only (no define, no subst)
macros.AC_CHECK_SIZEOF("int")
# → Creates cache variable: "ac_cv_sizeof_int"

# Cache variable + define (explicit name)
macros.AC_CHECK_SIZEOF("size_t", includes = ["stddef.h"], define = "SIZEOF_SIZE_T")
# → Creates cache variable: "ac_cv_sizeof_size_t"
# → Creates define: "SIZEOF_SIZE_T" in config.h
</code></pre>
<p>Cross-Compile Warning:
This macro is NOT cross-compile friendly. It requires compiling and
running code to determine the size, which doesn't work when cross-compiling.</p>
<p><strong>PARAMETERS</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">Description</th><th style="text-align: left">Default Value</th></tr></thead><tbody>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_SIZEOF-type_name"></a>type_name</td><td style="text-align: left">Name of the type (e.g., <code>int</code>, <code>size_t</code>, <code>void*</code>)</td><td style="text-align: left">none</td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_SIZEOF-name"></a>name</td><td style="text-align: left">Cache variable name (defaults to <code>ac_cv_sizeof_&lt;TYPE&gt;</code> following autoconf convention)</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_SIZEOF-define"></a>define</td><td style="text-align: left">Define behavior: - <code>None</code> (default): No define is created, only cache variable - <code>True</code>: Create define using the cache variable name (<code>name</code>) - <code>"SIZEOF_FOO"</code>: Create define with explicit name <code>SIZEOF_FOO</code> (implies <code>define=True</code>)</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_SIZEOF-includes"></a>includes</td><td style="text-align: left">Optional list of header names to include (e.g. <code>["stddef.h"]</code>)</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_SIZEOF-language"></a>language</td><td style="text-align: left">Language to use for check (<code>"c"</code> or <code>"cpp"</code>)</td><td style="text-align: left"><code>"c"</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_SIZEOF-requires"></a>requires</td><td style="text-align: left">Requirements that must be met for this check to run. Can be define names (e.g., <code>"HAVE_FOO"</code>), negated (e.g., <code>"!HAVE_FOO"</code>), or value-based (e.g., <code>"REPLACE_FSTAT==1"</code>, <code>"REPLACE_FSTAT!=0"</code>).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_SIZEOF-if_true"></a>if_true</td><td style="text-align: left">Value to use when check succeeds (currently not used for this check type).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_SIZEOF-if_false"></a>if_false</td><td style="text-align: left">Value to use when check fails (currently not used for this check type).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_SIZEOF-subst"></a>subst</td><td style="text-align: left">Subst behavior: - <code>None</code> (default): No subst is created, only cache variable - <code>True</code>: Create subst using the cache variable name (<code>name</code>) - <code>"SIZEOF_FOO"</code>: Create subst with explicit name <code>SIZEOF_FOO</code> (implies <code>subst=True</code>)</td><td style="text-align: left"><code>None</code></td></tr>
</tbody></table>
</div>
<p><strong>RETURNS</strong></p>
<p>A JSON-encoded check string for use with the autoconf rule.</p>
<p><a id="checks.AC_CHECK_TYPE"></a></p>
<h2 id="checksac_check_type"><a class="header" href="#checksac_check_type">checks.AC_CHECK_TYPE</a></h2>
<pre>
load("@rules_cc_autoconf//autoconf:checks.bzl", "checks")

checks.AC_CHECK_TYPE(<a href="checks.html#checks.AC_CHECK_TYPE-type_name">type_name</a>, *, <a href="checks.html#checks.AC_CHECK_TYPE-name">name</a>, <a href="checks.html#checks.AC_CHECK_TYPE-define">define</a>, <a href="checks.html#checks.AC_CHECK_TYPE-code">code</a>, <a href="checks.html#checks.AC_CHECK_TYPE-includes">includes</a>, <a href="checks.html#checks.AC_CHECK_TYPE-language">language</a>, <a href="checks.html#checks.AC_CHECK_TYPE-compile_defines">compile_defines</a>,
                     <a href="checks.html#checks.AC_CHECK_TYPE-requires">requires</a>, <a href="checks.html#checks.AC_CHECK_TYPE-if_true">if_true</a>, <a href="checks.html#checks.AC_CHECK_TYPE-if_false">if_false</a>, <a href="checks.html#checks.AC_CHECK_TYPE-subst">subst</a>)
</pre>
<p>Check for a type.</p>
<p>Original m4 example:</p>
<pre><code class="language-m4">AC_CHECK_TYPE([size_t])
AC_CHECK_TYPE([pthread_t], [], [], [[#include &lt;pthread.h&gt;]])
</code></pre>
<p>Example:</p>
<pre><code class="language-python"># Cache variable only (no define, no subst)
macros.AC_CHECK_TYPE("size_t")
# → Creates cache variable: "ac_cv_type_size_t"

# Cache variable + define (explicit name)
macros.AC_CHECK_TYPE("pthread_t", includes = ["pthread.h"], define = "HAVE_PTHREAD_T")
# → Creates cache variable: "ac_cv_type_pthread_t"
# → Creates define: "HAVE_PTHREAD_T" in config.h
</code></pre>
<p><strong>PARAMETERS</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">Description</th><th style="text-align: left">Default Value</th></tr></thead><tbody>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_TYPE-type_name"></a>type_name</td><td style="text-align: left">Name of the type (e.g., <code>size_t</code>)</td><td style="text-align: left">none</td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_TYPE-name"></a>name</td><td style="text-align: left">Cache variable name (defaults to <code>ac_cv_type_&lt;TYPE&gt;</code> following autoconf convention)</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_TYPE-define"></a>define</td><td style="text-align: left">Define behavior: - <code>None</code> (default): No define is created, only cache variable - <code>True</code>: Create define using the cache variable name (<code>name</code>) - <code>"HAVE_FOO"</code>: Create define with explicit name <code>HAVE_FOO</code> (implies <code>define=True</code>)</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_TYPE-code"></a>code</td><td style="text-align: left">Custom code that includes necessary headers (optional, defaults to standard headers)</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_TYPE-includes"></a>includes</td><td style="text-align: left">Optional list of headers to include. If not specified and <code>code</code> is not specified, uses AC_INCLUDES_DEFAULT.</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_TYPE-language"></a>language</td><td style="text-align: left">Language to use for check (<code>"c"</code> or <code>"cpp"</code>)</td><td style="text-align: left"><code>"c"</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_TYPE-compile_defines"></a>compile_defines</td><td style="text-align: left">Optional list of preprocessor define names from previous checks to add before includes (e.g., <code>["_GNU_SOURCE", "_DARWIN_C_SOURCE"]</code>). Each string must match the define name of a previous check. The values from those checks will be used automatically.</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_TYPE-requires"></a>requires</td><td style="text-align: left">Requirements that must be met for this check to run. Can be define names (e.g., <code>"HAVE_FOO"</code>), negated (e.g., <code>"!HAVE_FOO"</code>), or value-based (e.g., <code>"REPLACE_FSTAT==1"</code>, <code>"REPLACE_FSTAT!=0"</code>).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_TYPE-if_true"></a>if_true</td><td style="text-align: left">Value to use when check succeeds (currently not used for this check type).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_TYPE-if_false"></a>if_false</td><td style="text-align: left">Value to use when check fails (currently not used for this check type).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_CHECK_TYPE-subst"></a>subst</td><td style="text-align: left">Subst behavior: - <code>None</code> (default): No subst is created, only cache variable - <code>True</code>: Create subst using the cache variable name (<code>name</code>) - <code>"HAVE_FOO"</code>: Create subst with explicit name <code>HAVE_FOO</code> (implies <code>subst=True</code>)</td><td style="text-align: left"><code>None</code></td></tr>
</tbody></table>
</div>
<p><strong>RETURNS</strong></p>
<p>A JSON-encoded check string for use with the autoconf rule.</p>
<p><a id="checks.AC_COMPUTE_INT"></a></p>
<h2 id="checksac_compute_int"><a class="header" href="#checksac_compute_int">checks.AC_COMPUTE_INT</a></h2>
<pre>
load("@rules_cc_autoconf//autoconf:checks.bzl", "checks")

checks.AC_COMPUTE_INT(<a href="checks.html#checks.AC_COMPUTE_INT-define">define</a>, <a href="checks.html#checks.AC_COMPUTE_INT-expression">expression</a>, *, <a href="checks.html#checks.AC_COMPUTE_INT-includes">includes</a>, <a href="checks.html#checks.AC_COMPUTE_INT-language">language</a>, <a href="checks.html#checks.AC_COMPUTE_INT-requires">requires</a>, <a href="checks.html#checks.AC_COMPUTE_INT-subst">subst</a>)
</pre>
<p>Compute an integer value at compile time.</p>
<p>Original m4 example:</p>
<pre><code class="language-m4">AC_COMPUTE_INT([SIZEOF_INT], [sizeof(int)])
AC_COMPUTE_INT([MAX_VALUE], [1 &lt;&lt; 16])
</code></pre>
<p>Example:</p>
<pre><code class="language-python">macros.AC_COMPUTE_INT("SIZEOF_INT", "sizeof(int)")
macros.AC_COMPUTE_INT("MAX_VALUE", "1 &lt;&lt; 16")
</code></pre>
<p>Cross-Compile Warning:
This macro is NOT cross-compile friendly. It requires compiling and
running code to compute the value, which doesn't work when cross-compiling.</p>
<p><strong>PARAMETERS</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">Description</th><th style="text-align: left">Default Value</th></tr></thead><tbody>
<tr><td style="text-align: left"><a id="checks.AC_COMPUTE_INT-define"></a>define</td><td style="text-align: left">Define name for the result (first arg to match autoconf)</td><td style="text-align: left">none</td></tr>
<tr><td style="text-align: left"><a id="checks.AC_COMPUTE_INT-expression"></a>expression</td><td style="text-align: left">C expression that evaluates to an integer (second arg)</td><td style="text-align: left">none</td></tr>
<tr><td style="text-align: left"><a id="checks.AC_COMPUTE_INT-includes"></a>includes</td><td style="text-align: left">Optional list of header names to include (e.g. <code>["stdlib.h"]</code>)</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_COMPUTE_INT-language"></a>language</td><td style="text-align: left">Language to use for check (<code>"c"</code> or <code>"cpp"</code>)</td><td style="text-align: left"><code>"c"</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_COMPUTE_INT-requires"></a>requires</td><td style="text-align: left">List of requirements that must be met before this check runs. Can be simple define names (e.g., <code>"HAVE_FOO"</code>) or value-based requirements (e.g., <code>"REPLACE_FSTAT=1"</code> to require specific value)</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_COMPUTE_INT-subst"></a>subst</td><td style="text-align: left">If True, mark as a substitution variable (for @VAR@ replacement in subst.h).</td><td style="text-align: left"><code>None</code></td></tr>
</tbody></table>
</div>
<p><strong>RETURNS</strong></p>
<p>A JSON-encoded check string for use with the autoconf rule.</p>
<p><a id="checks.AC_C_BIGENDIAN"></a></p>
<h2 id="checksac_c_bigendian"><a class="header" href="#checksac_c_bigendian">checks.AC_C_BIGENDIAN</a></h2>
<pre>
load("@rules_cc_autoconf//autoconf:checks.bzl", "checks")

checks.AC_C_BIGENDIAN(<a href="checks.html#checks.AC_C_BIGENDIAN-define">define</a>, <a href="checks.html#checks.AC_C_BIGENDIAN-language">language</a>, <a href="checks.html#checks.AC_C_BIGENDIAN-requires">requires</a>, <a href="checks.html#checks.AC_C_BIGENDIAN-subst">subst</a>)
</pre>
<p>Check byte order (endianness) of the system.</p>
<p>Original m4 example:</p>
<pre><code class="language-m4">AC_C_BIGENDIAN([AC_DEFINE([WORDS_BIGENDIAN], [1])])
</code></pre>
<p>Example:</p>
<pre><code class="language-python">macros.AC_C_BIGENDIAN()
</code></pre>
<p>Note:
The define is set to 1 for big-endian, 0 for little-endian.</p>
<p>Cross-Compile Warning:
This macro is NOT cross-compile friendly. It requires compiling and
running code to determine endianness, which doesn't work when cross-compiling.</p>
<p><strong>PARAMETERS</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">Description</th><th style="text-align: left">Default Value</th></tr></thead><tbody>
<tr><td style="text-align: left"><a id="checks.AC_C_BIGENDIAN-define"></a>define</td><td style="text-align: left">Define name (defaults to <code>WORDS_BIGENDIAN</code>)</td><td style="text-align: left"><code>"WORDS_BIGENDIAN"</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_C_BIGENDIAN-language"></a>language</td><td style="text-align: left">Language to use for check (<code>"c"</code> or <code>"cpp"</code>)</td><td style="text-align: left"><code>"c"</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_C_BIGENDIAN-requires"></a>requires</td><td style="text-align: left">List of requirements that must be met before this check runs. Can be simple define names (e.g., <code>"HAVE_FOO"</code>) or value-based requirements (e.g., <code>"REPLACE_FSTAT=1"</code> to require specific value)</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_C_BIGENDIAN-subst"></a>subst</td><td style="text-align: left">If True, mark as a substitution variable (for @VAR@ replacement in subst.h).</td><td style="text-align: left"><code>None</code></td></tr>
</tbody></table>
</div>
<p><strong>RETURNS</strong></p>
<p>A JSON-encoded check string for use with the autoconf rule.</p>
<p><a id="checks.AC_C_INLINE"></a></p>
<h2 id="checksac_c_inline"><a class="header" href="#checksac_c_inline">checks.AC_C_INLINE</a></h2>
<pre>
load("@rules_cc_autoconf//autoconf:checks.bzl", "checks")

checks.AC_C_INLINE(<a href="checks.html#checks.AC_C_INLINE-define">define</a>, <a href="checks.html#checks.AC_C_INLINE-language">language</a>, <a href="checks.html#checks.AC_C_INLINE-requires">requires</a>, <a href="checks.html#checks.AC_C_INLINE-subst">subst</a>)
</pre>
<p>Check what inline keyword the compiler supports.</p>
<p>Original m4 example:</p>
<pre><code class="language-m4">AC_C_INLINE
</code></pre>
<p>Example:</p>
<pre><code class="language-python">macros.AC_C_INLINE()
</code></pre>
<p>Tests inline keyword and defines it to the appropriate value.</p>
<p><strong>PARAMETERS</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">Description</th><th style="text-align: left">Default Value</th></tr></thead><tbody>
<tr><td style="text-align: left"><a id="checks.AC_C_INLINE-define"></a>define</td><td style="text-align: left">Define name (defaults to <code>inline</code>)</td><td style="text-align: left"><code>"inline"</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_C_INLINE-language"></a>language</td><td style="text-align: left">Language to use for check (<code>"c"</code> or <code>"cpp"</code>)</td><td style="text-align: left"><code>"c"</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_C_INLINE-requires"></a>requires</td><td style="text-align: left">List of requirements that must be met before this check runs. Can be simple define names (e.g., <code>"HAVE_FOO"</code>) or value-based requirements (e.g., <code>"REPLACE_FSTAT=1"</code> to require specific value)</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_C_INLINE-subst"></a>subst</td><td style="text-align: left">If True, mark as a substitution variable (for @VAR@ replacement in subst.h).</td><td style="text-align: left"><code>None</code></td></tr>
</tbody></table>
</div>
<p><strong>RETURNS</strong></p>
<p>A JSON-encoded check string for use with the autoconf rule.</p>
<p><a id="checks.AC_C_RESTRICT"></a></p>
<h2 id="checksac_c_restrict"><a class="header" href="#checksac_c_restrict">checks.AC_C_RESTRICT</a></h2>
<pre>
load("@rules_cc_autoconf//autoconf:checks.bzl", "checks")

checks.AC_C_RESTRICT(<a href="checks.html#checks.AC_C_RESTRICT-define">define</a>, <a href="checks.html#checks.AC_C_RESTRICT-language">language</a>, <a href="checks.html#checks.AC_C_RESTRICT-requires">requires</a>, <a href="checks.html#checks.AC_C_RESTRICT-subst">subst</a>)
</pre>
<p>Check if the compiler supports restrict keyword.</p>
<p>Original m4 example:</p>
<pre><code class="language-m4">AC_C_RESTRICT
</code></pre>
<p>Example:</p>
<pre><code class="language-python">checks.AC_C_RESTRICT()
</code></pre>
<p>Note:
If restrict is not supported, the define is set to empty string.</p>
<p><strong>PARAMETERS</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">Description</th><th style="text-align: left">Default Value</th></tr></thead><tbody>
<tr><td style="text-align: left"><a id="checks.AC_C_RESTRICT-define"></a>define</td><td style="text-align: left">Define name (defaults to <code>restrict</code>)</td><td style="text-align: left"><code>"restrict"</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_C_RESTRICT-language"></a>language</td><td style="text-align: left">Language to use for check (<code>"c"</code> or <code>"cpp"</code>)</td><td style="text-align: left"><code>"c"</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_C_RESTRICT-requires"></a>requires</td><td style="text-align: left">List of requirements that must be met before this check runs. Can be simple define names (e.g., <code>"HAVE_FOO"</code>) or value-based requirements (e.g., <code>"REPLACE_FSTAT=1"</code> to require specific value)</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_C_RESTRICT-subst"></a>subst</td><td style="text-align: left">If True, mark as a substitution variable (for @VAR@ replacement in subst.h).</td><td style="text-align: left"><code>None</code></td></tr>
</tbody></table>
</div>
<p><strong>RETURNS</strong></p>
<p>A JSON-encoded check string for use with the autoconf rule.</p>
<p><a id="checks.AC_DEFINE"></a></p>
<h2 id="checksac_define"><a class="header" href="#checksac_define">checks.AC_DEFINE</a></h2>
<pre>
load("@rules_cc_autoconf//autoconf:checks.bzl", "checks")

checks.AC_DEFINE(<a href="checks.html#checks.AC_DEFINE-define">define</a>, <a href="checks.html#checks.AC_DEFINE-value">value</a>, <a href="checks.html#checks.AC_DEFINE-requires">requires</a>, <a href="checks.html#checks.AC_DEFINE-condition">condition</a>, <a href="checks.html#checks.AC_DEFINE-if_true">if_true</a>, <a href="checks.html#checks.AC_DEFINE-if_false">if_false</a>, <a href="checks.html#checks.AC_DEFINE-subst">subst</a>)
</pre>
<p>Define a configuration macro.</p>
<p>Original m4 example:</p>
<pre><code class="language-m4">AC_DEFINE([CUSTOM_VALUE], [42])
AC_DEFINE([ENABLE_FEATURE], [1])
AC_DEFINE([PROJECT_NAME], ["MyProject"])
AC_DEFINE([EMPTY_VALUE], [])
</code></pre>
<p>Conditional example (m4):</p>
<pre><code class="language-m4">if test $gl_cv_foo = yes; then
  AC_DEFINE([FOO_WORKS], [1])
fi
</code></pre>
<p>Example:</p>
<pre><code class="language-python"># Simple (always define)
macros.AC_DEFINE("CUSTOM_VALUE", "42")

# Conditional (define based on another check's result)
macros.AC_DEFINE(
    "FOO_WORKS",
    condition = "HAVE_FOO",
    if_true = "1",      # Value when HAVE_FOO is true
    if_false = None,    # Don't define when HAVE_FOO is false
)
</code></pre>
<p>Note:
This is equivalent to GNU Autoconf's AC_DEFINE macro. When used without
<code>condition</code>, it creates a define that will always be set. When used with
<code>condition</code>, the define is set based on the condition's result.</p>
<pre><code>**Condition Resolution**: If `condition` references a cache variable (e.g.,
`condition="ac_cv_header_foo_h"`), it's evaluated as a truthy check:
- Condition is `true` if the check succeeded AND the value is truthy (non-empty, non-zero)
- Condition is `false` if the check failed OR the value is falsy (empty, "0")
- If condition includes a comparison (e.g., `condition="ac_cv_header_foo_h==1"`),
  it performs value comparison instead.
</code></pre>
<p><strong>PARAMETERS</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">Description</th><th style="text-align: left">Default Value</th></tr></thead><tbody>
<tr><td style="text-align: left"><a id="checks.AC_DEFINE-define"></a>define</td><td style="text-align: left">Define name (e.g., <code>"CUSTOM_VALUE"</code>)</td><td style="text-align: left">none</td></tr>
<tr><td style="text-align: left"><a id="checks.AC_DEFINE-value"></a>value</td><td style="text-align: left">Value to assign when no condition is specified (defaults to <code>"1"</code>)</td><td style="text-align: left"><code>1</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_DEFINE-requires"></a>requires</td><td style="text-align: left">Requirements that must be met for this check to run. Can be define names (e.g., <code>"HAVE_FOO"</code>), negated (e.g., <code>"!HAVE_FOO"</code>), or value-based (e.g., <code>"REPLACE_FSTAT==1"</code>, <code>"REPLACE_FSTAT!=0"</code>).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_DEFINE-condition"></a>condition</td><td style="text-align: left">Selects which value to use: <code>if_true</code> when condition is true, <code>if_false</code> when false. Does not affect whether the check runs.</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_DEFINE-if_true"></a>if_true</td><td style="text-align: left">Value when condition is true (requires <code>condition</code>).</td><td style="text-align: left"><code>1</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_DEFINE-if_false"></a>if_false</td><td style="text-align: left">Value when condition is false (requires <code>condition</code>). Use <code>None</code> to not define the macro when condition is false.</td><td style="text-align: left"><code>0</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_DEFINE-subst"></a>subst</td><td style="text-align: left">If True, mark as a substitution variable (for @VAR@ replacement in subst.h).</td><td style="text-align: left"><code>None</code></td></tr>
</tbody></table>
</div>
<p><strong>RETURNS</strong></p>
<p>A JSON-encoded check string for use with the autoconf rule.</p>
<p><a id="checks.AC_DEFINE_UNQUOTED"></a></p>
<h2 id="checksac_define_unquoted"><a class="header" href="#checksac_define_unquoted">checks.AC_DEFINE_UNQUOTED</a></h2>
<pre>
load("@rules_cc_autoconf//autoconf:checks.bzl", "checks")

checks.AC_DEFINE_UNQUOTED(<a href="checks.html#checks.AC_DEFINE_UNQUOTED-define">define</a>, <a href="checks.html#checks.AC_DEFINE_UNQUOTED-value">value</a>, <a href="checks.html#checks.AC_DEFINE_UNQUOTED-requires">requires</a>, <a href="checks.html#checks.AC_DEFINE_UNQUOTED-condition">condition</a>, <a href="checks.html#checks.AC_DEFINE_UNQUOTED-if_true">if_true</a>, <a href="checks.html#checks.AC_DEFINE_UNQUOTED-if_false">if_false</a>, <a href="checks.html#checks.AC_DEFINE_UNQUOTED-subst">subst</a>)
</pre>
<p>Define a configuration macro without quoting (AC_DEFINE_UNQUOTED).</p>
<p>Original m4 example:</p>
<pre><code class="language-m4">AC_DEFINE_UNQUOTED([ICONV_CONST], [$iconv_arg1])
AC_DEFINE_UNQUOTED([VERSION], ["$PACKAGE_VERSION"])
</code></pre>
<p>This is similar to AC_DEFINE, but with one key difference:</p>
<ul>
<li>AC_DEFINE with empty value generates: <code>#define NAME /**/</code></li>
<li>AC_DEFINE_UNQUOTED with empty value generates: <code>#define NAME </code> (trailing space)</li>
</ul>
<p>Example:</p>
<pre><code class="language-python"># Simple (always define)
macros.AC_DEFINE_UNQUOTED("ICONV_CONST", "")

# Conditional (define based on another check's result)
macros.AC_DEFINE_UNQUOTED(
    "ICONV_CONST",
    condition = "_gl_cv_iconv_nonconst",
    if_true = "",      # Empty value - will generate "#define ICONV_CONST " (trailing space)
    if_false = "const",  # Non-empty value
)
</code></pre>
<p>Note:
This is equivalent to GNU Autoconf's AC_DEFINE_UNQUOTED macro. The main
difference from AC_DEFINE is how empty values are rendered in config.h:
AC_DEFINE uses <code>/**/</code> while AC_DEFINE_UNQUOTED uses a trailing space.</p>
<p><strong>PARAMETERS</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">Description</th><th style="text-align: left">Default Value</th></tr></thead><tbody>
<tr><td style="text-align: left"><a id="checks.AC_DEFINE_UNQUOTED-define"></a>define</td><td style="text-align: left">Define name (e.g., <code>"ICONV_CONST"</code>)</td><td style="text-align: left">none</td></tr>
<tr><td style="text-align: left"><a id="checks.AC_DEFINE_UNQUOTED-value"></a>value</td><td style="text-align: left">Value to assign when no condition is specified (defaults to <code>"1"</code>)</td><td style="text-align: left"><code>1</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_DEFINE_UNQUOTED-requires"></a>requires</td><td style="text-align: left">Requirements that must be met for this check to run. Can be define names (e.g., <code>"HAVE_FOO"</code>), negated (e.g., <code>"!HAVE_FOO"</code>), or value-based (e.g., <code>"REPLACE_FSTAT==1"</code>, <code>"REPLACE_FSTAT!=0"</code>).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_DEFINE_UNQUOTED-condition"></a>condition</td><td style="text-align: left">Selects which value to use: <code>if_true</code> when condition is true, <code>if_false</code> when false. Does not affect whether the check runs.</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_DEFINE_UNQUOTED-if_true"></a>if_true</td><td style="text-align: left">Value when condition is true (requires <code>condition</code>).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_DEFINE_UNQUOTED-if_false"></a>if_false</td><td style="text-align: left">Value when condition is false (requires <code>condition</code>). Use <code>None</code> to not define the macro when condition is false.</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_DEFINE_UNQUOTED-subst"></a>subst</td><td style="text-align: left">If True, mark as a substitution variable (for @VAR@ replacement in subst.h).</td><td style="text-align: left"><code>None</code></td></tr>
</tbody></table>
</div>
<p><strong>RETURNS</strong></p>
<p>A JSON-encoded check string for use with the autoconf rule.</p>
<p><a id="checks.AC_PROG_CC"></a></p>
<h2 id="checksac_prog_cc"><a class="header" href="#checksac_prog_cc">checks.AC_PROG_CC</a></h2>
<pre>
load("@rules_cc_autoconf//autoconf:checks.bzl", "checks")

checks.AC_PROG_CC(<a href="checks.html#checks.AC_PROG_CC-requires">requires</a>)
</pre>
<p>Check that a C compiler is available.</p>
<p>Original m4 example:</p>
<pre><code class="language-m4">AC_PROG_CC
AC_PROG_CC([gcc clang])
</code></pre>
<p>Example:</p>
<pre><code class="language-python">macros.AC_PROG_CC()
</code></pre>
<p>Note:
This is mostly a no-op in Bazel since the toolchain must be configured,
but returns a check that will verify the compiler works.</p>
<p><strong>PARAMETERS</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">Description</th><th style="text-align: left">Default Value</th></tr></thead><tbody>
<tr><td style="text-align: left"><a id="checks.AC_PROG_CC-requires"></a>requires</td><td style="text-align: left">List of requirements that must be met before this check runs. Can be simple define names (e.g., <code>"HAVE_FOO"</code>) or value-based requirements (e.g., <code>"REPLACE_FSTAT=1"</code> to require specific value)</td><td style="text-align: left"><code>None</code></td></tr>
</tbody></table>
</div>
<p><strong>RETURNS</strong></p>
<p>A JSON-encoded check string for use with the autoconf rule.</p>
<p><a id="checks.AC_PROG_CC_C_O"></a></p>
<h2 id="checksac_prog_cc_c_o"><a class="header" href="#checksac_prog_cc_c_o">checks.AC_PROG_CC_C_O</a></h2>
<pre>
load("@rules_cc_autoconf//autoconf:checks.bzl", "checks")

checks.AC_PROG_CC_C_O(<a href="checks.html#checks.AC_PROG_CC_C_O-define">define</a>, <a href="checks.html#checks.AC_PROG_CC_C_O-language">language</a>, <a href="checks.html#checks.AC_PROG_CC_C_O-requires">requires</a>, <a href="checks.html#checks.AC_PROG_CC_C_O-subst">subst</a>)
</pre>
<p>Check if the compiler supports -c and -o flags simultaneously.</p>
<p>Original m4 example:</p>
<pre><code class="language-m4">AC_PROG_CC_C_O
</code></pre>
<p>Example:</p>
<pre><code class="language-python">macros.AC_PROG_CC_C_O()
</code></pre>
<p>Note:
If the compiler does NOT support both flags together, the define is set.</p>
<p><strong>PARAMETERS</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">Description</th><th style="text-align: left">Default Value</th></tr></thead><tbody>
<tr><td style="text-align: left"><a id="checks.AC_PROG_CC_C_O-define"></a>define</td><td style="text-align: left">Define name (defaults to <code>"NO_MINUS_C_MINUS_O"</code>)</td><td style="text-align: left"><code>"NO_MINUS_C_MINUS_O"</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_PROG_CC_C_O-language"></a>language</td><td style="text-align: left">Language to use for check (<code>"c"</code> or <code>"cpp"</code>)</td><td style="text-align: left"><code>"c"</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_PROG_CC_C_O-requires"></a>requires</td><td style="text-align: left">List of requirements that must be met before this check runs. Can be simple define names (e.g., <code>"HAVE_FOO"</code>) or value-based requirements (e.g., <code>"REPLACE_FSTAT=1"</code> to require specific value)</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_PROG_CC_C_O-subst"></a>subst</td><td style="text-align: left">If True, mark as a substitution variable (for @VAR@ replacement in subst.h).</td><td style="text-align: left"><code>None</code></td></tr>
</tbody></table>
</div>
<p><strong>RETURNS</strong></p>
<p>A JSON-encoded check string for use with the autoconf rule.</p>
<p><a id="checks.AC_PROG_CXX"></a></p>
<h2 id="checksac_prog_cxx"><a class="header" href="#checksac_prog_cxx">checks.AC_PROG_CXX</a></h2>
<pre>
load("@rules_cc_autoconf//autoconf:checks.bzl", "checks")

checks.AC_PROG_CXX(<a href="checks.html#checks.AC_PROG_CXX-requires">requires</a>)
</pre>
<p>Check that a C++ compiler is available.</p>
<p>Original m4 example:</p>
<pre><code class="language-m4">AC_PROG_CXX
AC_PROG_CXX([g++ clang++])
</code></pre>
<p>Example:</p>
<pre><code class="language-python">macros.AC_PROG_CXX()
</code></pre>
<p>Note:
This is mostly a no-op in Bazel since the toolchain must be configured,
but returns a check that will verify the compiler works.</p>
<p><strong>PARAMETERS</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">Description</th><th style="text-align: left">Default Value</th></tr></thead><tbody>
<tr><td style="text-align: left"><a id="checks.AC_PROG_CXX-requires"></a>requires</td><td style="text-align: left">List of requirements that must be met before this check runs. Can be simple define names (e.g., <code>"HAVE_FOO"</code>) or value-based requirements (e.g., <code>"REPLACE_FSTAT=1"</code> to require specific value)</td><td style="text-align: left"><code>None</code></td></tr>
</tbody></table>
</div>
<p><strong>RETURNS</strong></p>
<p>A JSON-encoded check string for use with the autoconf rule.</p>
<p><a id="checks.AC_SUBST"></a></p>
<h2 id="checksac_subst"><a class="header" href="#checksac_subst">checks.AC_SUBST</a></h2>
<pre>
load("@rules_cc_autoconf//autoconf:checks.bzl", "checks")

checks.AC_SUBST(<a href="checks.html#checks.AC_SUBST-variable">variable</a>, <a href="checks.html#checks.AC_SUBST-value">value</a>, <a href="checks.html#checks.AC_SUBST-requires">requires</a>, <a href="checks.html#checks.AC_SUBST-condition">condition</a>, <a href="checks.html#checks.AC_SUBST-if_true">if_true</a>, <a href="checks.html#checks.AC_SUBST-if_false">if_false</a>)
</pre>
<p>Substitute a variable value (equivalent to AC_SUBST in GNU Autoconf).</p>
<p>Original m4 example:</p>
<pre><code class="language-m4">HAVE_DECL_WCSDUP=1;   AC_SUBST([HAVE_DECL_WCSDUP])
HAVE_DECL_WCWIDTH=1;  AC_SUBST([HAVE_DECL_WCWIDTH])
</code></pre>
<p>Conditional example (m4):</p>
<pre><code class="language-m4">if test $gl_cv_sys_struct_lconv_ok = no; then
  REPLACE_STRUCT_LCONV=1
else
  REPLACE_STRUCT_LCONV=0
fi
AC_SUBST([REPLACE_STRUCT_LCONV])
</code></pre>
<p>Example:</p>
<pre><code class="language-python"># Simple (always set)
macros.AC_SUBST("HAVE_DECL_WCSDUP", "1")

# Conditional (set based on another check's result)
macros.AC_SUBST(
    "REPLACE_STRUCT_LCONV",
    condition = "HAVE_STRUCT_LCONV_OK",
    if_true = "0",    # Value when condition is true
    if_false = "1",   # Value when condition is false
)
</code></pre>
<p>Note:
<strong>Condition Resolution</strong>: If <code>condition</code> references a cache variable (e.g.,
<code>condition="ac_cv_header_foo_h"</code>), it's evaluated as a truthy check:
- Condition is <code>true</code> if the check succeeded AND the value is truthy (non-empty, non-zero)
- Condition is <code>false</code> if the check failed OR the value is falsy (empty, "0")
- If condition includes a comparison (e.g., <code>condition="ac_cv_header_foo_h==1"</code>),
it performs value comparison instead.</p>
<pre><code>In GNU Autoconf, `AC_SUBST` is used to substitute shell variables into
Makefiles and template files (replacing `@VAR@` patterns). When used
without `condition`, it always sets the variable. When used with
`condition`, the value depends on the condition's result.
</code></pre>
<p><strong>PARAMETERS</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">Description</th><th style="text-align: left">Default Value</th></tr></thead><tbody>
<tr><td style="text-align: left"><a id="checks.AC_SUBST-variable"></a>variable</td><td style="text-align: left">Variable name (e.g., <code>"LIBRARY_PATH"</code>)</td><td style="text-align: left">none</td></tr>
<tr><td style="text-align: left"><a id="checks.AC_SUBST-value"></a>value</td><td style="text-align: left">Value to assign when no condition is specified (defaults to <code>"1"</code>)</td><td style="text-align: left"><code>1</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_SUBST-requires"></a>requires</td><td style="text-align: left">Requirements that must be met for this check to run. Can be define names (e.g., <code>"HAVE_FOO"</code>), negated (e.g., <code>"!HAVE_FOO"</code>), or value-based (e.g., <code>"REPLACE_FSTAT==1"</code>, <code>"REPLACE_FSTAT!=0"</code>).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_SUBST-condition"></a>condition</td><td style="text-align: left">Selects which value to use: <code>if_true</code> when condition is true, <code>if_false</code> when false. Does not affect whether the check runs.</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_SUBST-if_true"></a>if_true</td><td style="text-align: left">Value when condition is true (requires <code>condition</code>).</td><td style="text-align: left"><code>1</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_SUBST-if_false"></a>if_false</td><td style="text-align: left">Value when condition is false (requires <code>condition</code>).</td><td style="text-align: left"><code>0</code></td></tr>
</tbody></table>
</div>
<p><strong>RETURNS</strong></p>
<p>A JSON-encoded check string for use with the autoconf rule.</p>
<p><a id="checks.AC_TRY_COMPILE"></a></p>
<h2 id="checksac_try_compile"><a class="header" href="#checksac_try_compile">checks.AC_TRY_COMPILE</a></h2>
<pre>
load("@rules_cc_autoconf//autoconf:checks.bzl", "checks")

checks.AC_TRY_COMPILE(*, <a href="checks.html#checks.AC_TRY_COMPILE-code">code</a>, <a href="checks.html#checks.AC_TRY_COMPILE-name">name</a>, <a href="checks.html#checks.AC_TRY_COMPILE-define">define</a>, <a href="checks.html#checks.AC_TRY_COMPILE-includes">includes</a>, <a href="checks.html#checks.AC_TRY_COMPILE-language">language</a>, <a href="checks.html#checks.AC_TRY_COMPILE-compile_defines">compile_defines</a>, <a href="checks.html#checks.AC_TRY_COMPILE-requires">requires</a>, <a href="checks.html#checks.AC_TRY_COMPILE-if_true">if_true</a>,
                      <a href="checks.html#checks.AC_TRY_COMPILE-if_false">if_false</a>, <a href="checks.html#checks.AC_TRY_COMPILE-subst">subst</a>)
</pre>
<p>Try to compile custom code.</p>
<p>Original m4 example:</p>
<pre><code class="language-m4">AC_TRY_COMPILE([#include &lt;stdio.h&gt;], [printf("test");], [AC_DEFINE([HAVE_PRINTF], [1])])
</code></pre>
<p>Example:</p>
<pre><code class="language-python">load("//autoconf:checks.bzl", "utils")
macros.AC_TRY_COMPILE(
    code = "#include &lt;stdio.h&gt;\nint main() { printf(\"test\"); return 0; }",
    define = "HAVE_PRINTF",
)
macros.AC_TRY_COMPILE(file = ":test.c", define = "CUSTOM_CHECK")
macros.AC_TRY_COMPILE(
    includes = ["pthread.h"],
    code = "int x = PTHREAD_CREATE_DETACHED; (void)x;",
    define = "HAVE_PTHREAD_CREATE_DETACHED",
)
macros.AC_TRY_COMPILE(
    code = utils.AC_LANG_PROGRAM(["#include &lt;stdio.h&gt;"], "printf("test");"),
    define = "HAVE_PRINTF",
)
</code></pre>
<p>Note:
This is a rules_cc_autoconf extension. While GNU Autoconf has an
obsolete AC_TRY_COMPILE macro (replaced by AC_COMPILE_IFELSE), this
version adds support for file-based checks which is useful in Bazel.</p>
<pre><code>When `includes` is provided along with `code`, the code is treated as
the body of main() and the includes are prepended. For the AC_LANG_PROGRAM
pattern (prologue + body), use `utils.AC_LANG_PROGRAM(prologue, body)` and
pass the result as `code`.
</code></pre>
<p><strong>PARAMETERS</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">Description</th><th style="text-align: left">Default Value</th></tr></thead><tbody>
<tr><td style="text-align: left"><a id="checks.AC_TRY_COMPILE-code"></a>code</td><td style="text-align: left">Code to compile. If <code>includes</code> is also provided, this is treated as the body of main(). Otherwise, it should be complete C code. For AC_LANG_PROGRAM-style tests, use code = utils.AC_LANG_PROGRAM(prologue, body).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_TRY_COMPILE-name"></a>name</td><td style="text-align: left">Cache variable name.</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_TRY_COMPILE-define"></a>define</td><td style="text-align: left">Define name to set if compilation succeeds</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_TRY_COMPILE-includes"></a>includes</td><td style="text-align: left">Optional list of headers to include. When provided, <code>code</code> is treated as the body of main() function.</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_TRY_COMPILE-language"></a>language</td><td style="text-align: left">Language to use for check (<code>"c"</code> or <code>"cpp"</code>)</td><td style="text-align: left"><code>"c"</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_TRY_COMPILE-compile_defines"></a>compile_defines</td><td style="text-align: left">Optional list of preprocessor define names from previous checks to add before includes (e.g., <code>["_GNU_SOURCE", "_DARWIN_C_SOURCE"]</code>). Each string must match the define name of a previous check. The values from those checks will be used automatically.</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_TRY_COMPILE-requires"></a>requires</td><td style="text-align: left">Requirements that must be met for this check to run. Can be define names (e.g., <code>"HAVE_FOO"</code>), negated (e.g., <code>"!HAVE_FOO"</code>), or value-based (e.g., <code>"REPLACE_FSTAT==1"</code>, <code>"REPLACE_FSTAT!=0"</code>).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_TRY_COMPILE-if_true"></a>if_true</td><td style="text-align: left">Value to use when check succeeds (currently not used for this check type).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_TRY_COMPILE-if_false"></a>if_false</td><td style="text-align: left">Value to use when check fails (currently not used for this check type).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_TRY_COMPILE-subst"></a>subst</td><td style="text-align: left">If True, automatically create a substitution variable with the same name that will be set to "1" if the check succeeds, "0" if it fails.</td><td style="text-align: left"><code>None</code></td></tr>
</tbody></table>
</div>
<p><strong>RETURNS</strong></p>
<p>A JSON-encoded check string for use with the autoconf rule.</p>
<p><a id="checks.AC_TRY_LINK"></a></p>
<h2 id="checksac_try_link"><a class="header" href="#checksac_try_link">checks.AC_TRY_LINK</a></h2>
<pre>
load("@rules_cc_autoconf//autoconf:checks.bzl", "checks")

checks.AC_TRY_LINK(*, <a href="checks.html#checks.AC_TRY_LINK-code">code</a>, <a href="checks.html#checks.AC_TRY_LINK-name">name</a>, <a href="checks.html#checks.AC_TRY_LINK-define">define</a>, <a href="checks.html#checks.AC_TRY_LINK-includes">includes</a>, <a href="checks.html#checks.AC_TRY_LINK-language">language</a>, <a href="checks.html#checks.AC_TRY_LINK-compile_defines">compile_defines</a>, <a href="checks.html#checks.AC_TRY_LINK-requires">requires</a>, <a href="checks.html#checks.AC_TRY_LINK-if_true">if_true</a>,
                   <a href="checks.html#checks.AC_TRY_LINK-if_false">if_false</a>, <a href="checks.html#checks.AC_TRY_LINK-subst">subst</a>)
</pre>
<p>Try to compile and link custom code.</p>
<p>This function mirrors GNU Autoconf's <code>AC_LINK_IFELSE</code> macro, which uses
<code>AC_LANG_PROGRAM</code> to construct test programs. In Bazel, use <code>code</code> (optionally
with <code>includes</code>). For the AC_LANG_PROGRAM pattern, pass
code = utils.AC_LANG_PROGRAM(prologue, body).</p>
<p>Comparison with GNU Autoconf:</p>
<p><strong>GNU Autoconf:</strong></p>
<pre><code class="language-m4">AC_LINK_IFELSE(
    [AC_LANG_PROGRAM(
        [[#include &lt;stdio.h&gt;]],     # Prologue (includes/declarations)
        [[printf("test");]]         # Body (code inside main())
    )],
    [AC_DEFINE([HAVE_PRINTF], [1])],
    []
)
</code></pre>
<p><strong>Bazel (AC_LANG_PROGRAM pattern):</strong></p>
<pre><code class="language-python">load("//autoconf:checks.bzl", "utils")
checks.AC_TRY_LINK(
    code = utils.AC_LANG_PROGRAM(["#include &lt;stdio.h&gt;"], "printf("test");"),
    define = "HAVE_PRINTF",
)
</code></pre>
<p><strong>Bazel (includes pattern - backward compat):</strong></p>
<pre><code class="language-python">checks.AC_TRY_LINK(
    includes = ["stdio.h"],
    code = "printf("test");",     # Treated as body of main()
    define = "HAVE_PRINTF",
)
</code></pre>
<p><strong>Bazel (raw code pattern):</strong></p>
<pre><code class="language-python">checks.AC_TRY_LINK(
    code = "#include &lt;stdio.h&gt;\nint main() { printf(\"test\"); return 0; }",
    define = "HAVE_PRINTF",
)
</code></pre>
<p>Note:
This is similar to AC_TRY_COMPILE but also links the code, which is necessary
to verify that functions are available at link time (not just declared).</p>
<p><strong>PARAMETERS</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">Description</th><th style="text-align: left">Default Value</th></tr></thead><tbody>
<tr><td style="text-align: left"><a id="checks.AC_TRY_LINK-code"></a>code</td><td style="text-align: left">Code to compile and link. If <code>includes</code> is also provided, this is treated as the body of main(). Otherwise, it should be complete C code. For AC_LANG_PROGRAM-style tests use code = utils.AC_LANG_PROGRAM(prologue, body).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_TRY_LINK-name"></a>name</td><td style="text-align: left">Cache variable name.</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_TRY_LINK-define"></a>define</td><td style="text-align: left">Define name to set if compilation and linking succeeds</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_TRY_LINK-includes"></a>includes</td><td style="text-align: left">Optional list of headers to include (backward compatibility). When provided, <code>code</code> is treated as the body of main() function.</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_TRY_LINK-language"></a>language</td><td style="text-align: left">Language to use for check (<code>"c"</code> or <code>"cpp"</code>)</td><td style="text-align: left"><code>"c"</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_TRY_LINK-compile_defines"></a>compile_defines</td><td style="text-align: left">Optional list of preprocessor define names from previous checks to add before includes (e.g., <code>["_GNU_SOURCE", "_DARWIN_C_SOURCE"]</code>). Each string must match the define name of a previous check. The values from those checks will be used automatically.</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_TRY_LINK-requires"></a>requires</td><td style="text-align: left">Requirements that must be met for this check to run. Can be define names (e.g., <code>"HAVE_FOO"</code>), negated (e.g., <code>"!HAVE_FOO"</code>), or value-based (e.g., <code>"REPLACE_FSTAT==1"</code>, <code>"REPLACE_FSTAT!=0"</code>).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_TRY_LINK-if_true"></a>if_true</td><td style="text-align: left">Value to use when check succeeds (currently not used for this check type).</td><td style="text-align: left"><code>1</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_TRY_LINK-if_false"></a>if_false</td><td style="text-align: left">Value to use when check fails (currently not used for this check type).</td><td style="text-align: left"><code>0</code></td></tr>
<tr><td style="text-align: left"><a id="checks.AC_TRY_LINK-subst"></a>subst</td><td style="text-align: left">If True, mark as a substitution variable (for @VAR@ replacement in subst.h).</td><td style="text-align: left"><code>None</code></td></tr>
</tbody></table>
</div>
<p><strong>RETURNS</strong></p>
<p>A JSON-encoded check string for use with the autoconf rule.</p>
<p><a id="checks.M4_VARIABLE"></a></p>
<h2 id="checksm4_variable"><a class="header" href="#checksm4_variable">checks.M4_VARIABLE</a></h2>
<pre>
load("@rules_cc_autoconf//autoconf:checks.bzl", "checks")

checks.M4_VARIABLE(<a href="checks.html#checks.M4_VARIABLE-define">define</a>, <a href="checks.html#checks.M4_VARIABLE-value">value</a>, <a href="checks.html#checks.M4_VARIABLE-requires">requires</a>, <a href="checks.html#checks.M4_VARIABLE-condition">condition</a>, <a href="checks.html#checks.M4_VARIABLE-if_true">if_true</a>, <a href="checks.html#checks.M4_VARIABLE-if_false">if_false</a>)
</pre>
<p>Define a configuration M4 variable.</p>
<p>Original m4 example:</p>
<pre><code class="language-m4">REPLACE_FOO=1
</code></pre>
<p>Conditional example (m4):</p>
<pre><code class="language-m4">if test $HAVE_FOO = yes; then
  REPLACE_FOO=0
else
  REPLACE_FOO=1
fi
</code></pre>
<p>Example:</p>
<pre><code class="language-python"># Simple (always set)
macros.M4_VARIABLE("REPLACE_FOO", "1")

# Conditional (set based on another check's result)
macros.M4_VARIABLE(
    "REPLACE_FOO",
    condition = "HAVE_FOO",
    if_true = "0",    # Value when HAVE_FOO is true
    if_false = "1",   # Value when HAVE_FOO is false
)
</code></pre>
<p>Note:
This is similar to <code>AC_SUBST</code> but is useful for tracking the difference
between actual <code>AC_DEFINE</code> values and M4 shell variables used in macros.
Unlike <code>AC_SUBST</code>, this does not set <code>subst=true</code> by default.</p>
<p><strong>PARAMETERS</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">Description</th><th style="text-align: left">Default Value</th></tr></thead><tbody>
<tr><td style="text-align: left"><a id="checks.M4_VARIABLE-define"></a>define</td><td style="text-align: left">Define name (e.g., <code>"REPLACE_FOO"</code>)</td><td style="text-align: left">none</td></tr>
<tr><td style="text-align: left"><a id="checks.M4_VARIABLE-value"></a>value</td><td style="text-align: left">Value to assign when no condition is specified (defaults to <code>"1"</code>)</td><td style="text-align: left"><code>1</code></td></tr>
<tr><td style="text-align: left"><a id="checks.M4_VARIABLE-requires"></a>requires</td><td style="text-align: left">List of requirements that must be met before this check runs. Can be simple define names (e.g., <code>"HAVE_FOO"</code>) or value-based requirements (e.g., <code>"REPLACE_FSTAT=1"</code> to require specific value)</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.M4_VARIABLE-condition"></a>condition</td><td style="text-align: left">Selects which value to use: <code>if_true</code> when condition is true, <code>if_false</code> when false. Does not affect whether the check runs.</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.M4_VARIABLE-if_true"></a>if_true</td><td style="text-align: left">Value when condition is true (requires <code>condition</code>).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="checks.M4_VARIABLE-if_false"></a>if_false</td><td style="text-align: left">Value when condition is false (requires <code>condition</code>).</td><td style="text-align: left"><code>None</code></td></tr>
</tbody></table>
</div>
<p><strong>RETURNS</strong></p>
<p>A JSON-encoded check string for use with the m4 rule.</p>
<p><a id="macros.AC_CHECK_DECLS"></a></p>
<h2 id="macrosac_check_decls"><a class="header" href="#macrosac_check_decls">macros.AC_CHECK_DECLS</a></h2>
<pre>
load("@rules_cc_autoconf//autoconf:checks.bzl", "macros")

macros.AC_CHECK_DECLS(<a href="checks.html#macros.AC_CHECK_DECLS-symbols">symbols</a>, *, <a href="checks.html#macros.AC_CHECK_DECLS-includes">includes</a>, <a href="checks.html#macros.AC_CHECK_DECLS-compile_defines">compile_defines</a>, <a href="checks.html#macros.AC_CHECK_DECLS-language">language</a>, <a href="checks.html#macros.AC_CHECK_DECLS-requires">requires</a>, <a href="checks.html#macros.AC_CHECK_DECLS-if_true">if_true</a>, <a href="checks.html#macros.AC_CHECK_DECLS-if_false">if_false</a>,
                      <a href="checks.html#macros.AC_CHECK_DECLS-subst">subst</a>)
</pre>
<p>Check multiple declarations, creating HAVE_DECL_<SYMBOL> defines (AC_CHECK_DECLS).</p>
<p>GNU Autoconf's AC_CHECK_DECLS(symbol, ...) checks whether each symbol is
declared (e.g. in a header). This macro runs AC_CHECK_DECL for each symbol
and sets define names HAVE_DECL_<SYMBOL> following autoconf conventions.</p>
<p>Upstream:
https://www.gnu.org/savannah-checkouts/gnu/autoconf/manual/autoconf-2.72/autoconf.html#index-AC_005fCHECK_002dDECL</p>
<p>M4 example (configure.ac):
AC_CHECK_DECLS([NULL, stdout, stderr], [], [], [[#include &lt;stdio.h&gt;]])
AC_CHECK_DECL([NULL], [AC_DEFINE([HAVE_DECL_NULL], [1])], [], [[#include &lt;stddef.h&gt;]])</p>
<p>Bazel example (use <code>#include &lt;foo&gt;</code> in includes):
load("//autoconf:checks.bzl", "macros")
macros.AC_CHECK_DECLS(["NULL", "stdout", "stderr"], includes = ["#include &lt;stdio.h&gt;"])</p>
<h1 id="defines-have_decl_null-have_decl_stdout-have_decl_stderr"><a class="header" href="#defines-have_decl_null-have_decl_stdout-have_decl_stderr">Defines: HAVE_DECL_NULL, HAVE_DECL_STDOUT, HAVE_DECL_STDERR</a></h1>
<p><strong>PARAMETERS</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">Description</th><th style="text-align: left">Default Value</th></tr></thead><tbody>
<tr><td style="text-align: left"><a id="macros.AC_CHECK_DECLS-symbols"></a>symbols</td><td style="text-align: left">List of symbol names to check.</td><td style="text-align: left">none</td></tr>
<tr><td style="text-align: left"><a id="macros.AC_CHECK_DECLS-includes"></a>includes</td><td style="text-align: left">Optional list of include directives (e.g. ["#include &lt;stdio.h&gt;"]).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="macros.AC_CHECK_DECLS-compile_defines"></a>compile_defines</td><td style="text-align: left">Optional list of preprocessor define names (applies to all checks).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="macros.AC_CHECK_DECLS-language"></a>language</td><td style="text-align: left">Language to use for checks (<code>"c"</code> or <code>"cpp"</code>).</td><td style="text-align: left"><code>"c"</code></td></tr>
<tr><td style="text-align: left"><a id="macros.AC_CHECK_DECLS-requires"></a>requires</td><td style="text-align: left">Requirements that must be met (applies to all checks).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="macros.AC_CHECK_DECLS-if_true"></a>if_true</td><td style="text-align: left">Value to use when check succeeds (applies to all checks).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="macros.AC_CHECK_DECLS-if_false"></a>if_false</td><td style="text-align: left">Value to use when check fails (applies to all checks).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="macros.AC_CHECK_DECLS-subst"></a>subst</td><td style="text-align: left">Subst behavior (applies to all checks).</td><td style="text-align: left"><code>None</code></td></tr>
</tbody></table>
</div>
<p><strong>RETURNS</strong></p>
<p>List of JSON-encoded check strings.</p>
<p><a id="macros.AC_CHECK_FUNCS"></a></p>
<h2 id="macrosac_check_funcs"><a class="header" href="#macrosac_check_funcs">macros.AC_CHECK_FUNCS</a></h2>
<pre>
load("@rules_cc_autoconf//autoconf:checks.bzl", "macros")

macros.AC_CHECK_FUNCS(<a href="checks.html#macros.AC_CHECK_FUNCS-functions">functions</a>, *, <a href="checks.html#macros.AC_CHECK_FUNCS-code">code</a>, <a href="checks.html#macros.AC_CHECK_FUNCS-language">language</a>, <a href="checks.html#macros.AC_CHECK_FUNCS-compile_defines">compile_defines</a>, <a href="checks.html#macros.AC_CHECK_FUNCS-requires">requires</a>, <a href="checks.html#macros.AC_CHECK_FUNCS-subst">subst</a>)
</pre>
<p>Check multiple functions, creating HAVE_<FUNCTION> defines (AC_CHECK_FUNCS).</p>
<p>GNU Autoconf's AC_CHECK_FUNCS(function, ...) checks whether each function
is available (linkable). This macro runs AC_CHECK_FUNC for each function
and sets HAVE_<FUNCTION> following autoconf conventions.</p>
<p>Upstream:
https://www.gnu.org/savannah-checkouts/gnu/autoconf/manual/autoconf-2.72/autoconf.html#index-AC_005fCHECK_002dFUNC</p>
<p>M4 example (configure.ac):
AC_CHECK_FUNCS([malloc, free, printf])</p>
<p>Bazel example:
load("//autoconf:checks.bzl", "macros")
macros.AC_CHECK_FUNCS(["malloc", "free", "printf"])</p>
<h1 id="defines-have_malloc-have_free-have_printf"><a class="header" href="#defines-have_malloc-have_free-have_printf">Defines: HAVE_MALLOC, HAVE_FREE, HAVE_PRINTF</a></h1>
<p><strong>PARAMETERS</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">Description</th><th style="text-align: left">Default Value</th></tr></thead><tbody>
<tr><td style="text-align: left"><a id="macros.AC_CHECK_FUNCS-functions"></a>functions</td><td style="text-align: left">List of function names to check.</td><td style="text-align: left">none</td></tr>
<tr><td style="text-align: left"><a id="macros.AC_CHECK_FUNCS-code"></a>code</td><td style="text-align: left">Custom code to compile (applies to all checks).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="macros.AC_CHECK_FUNCS-language"></a>language</td><td style="text-align: left">Language to use for checks (<code>"c"</code> or <code>"cpp"</code>).</td><td style="text-align: left"><code>"c"</code></td></tr>
<tr><td style="text-align: left"><a id="macros.AC_CHECK_FUNCS-compile_defines"></a>compile_defines</td><td style="text-align: left">Optional list of preprocessor define names (applies to all checks).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="macros.AC_CHECK_FUNCS-requires"></a>requires</td><td style="text-align: left">Requirements that must be met (applies to all checks).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="macros.AC_CHECK_FUNCS-subst"></a>subst</td><td style="text-align: left">Subst behavior (applies to all checks).</td><td style="text-align: left"><code>None</code></td></tr>
</tbody></table>
</div>
<p><strong>RETURNS</strong></p>
<p>List of JSON-encoded check strings.</p>
<p><a id="macros.AC_CHECK_HEADERS"></a></p>
<h2 id="macrosac_check_headers"><a class="header" href="#macrosac_check_headers">macros.AC_CHECK_HEADERS</a></h2>
<pre>
load("@rules_cc_autoconf//autoconf:checks.bzl", "macros")

macros.AC_CHECK_HEADERS(<a href="checks.html#macros.AC_CHECK_HEADERS-headers">headers</a>, *, <a href="checks.html#macros.AC_CHECK_HEADERS-language">language</a>, <a href="checks.html#macros.AC_CHECK_HEADERS-includes">includes</a>, <a href="checks.html#macros.AC_CHECK_HEADERS-compile_defines">compile_defines</a>, <a href="checks.html#macros.AC_CHECK_HEADERS-requires">requires</a>)
</pre>
<p>Check multiple headers, creating HAVE_<HEADER> defines (AC_CHECK_HEADERS).</p>
<p>GNU Autoconf's AC_CHECK_HEADERS(header, ...) checks whether each header can
be compiled. This macro runs AC_CHECK_HEADER for each header and sets
HAVE_&lt;HEADER_UPPER&gt; (e.g. HAVE_STDIO_H) following autoconf conventions.
Header names are turned into include directives as #include <header>.</p>
<p>Upstream:
https://www.gnu.org/savannah-checkouts/gnu/autoconf/manual/autoconf-2.72/autoconf.html#index-AC_005fCHECK_002dHEADERS</p>
<p>Original m4 example:</p>
<pre><code class="language-m4">AC_CHECK_HEADERS([stdio.h, stdlib.h, string.h])
</code></pre>
<p>Example:</p>
<pre><code class="language-python">load("//autoconf:checks.bzl", "macros")
macros.AC_CHECK_HEADERS(["stdio.h", "stdlib.h", "string.h"])
# Defines: HAVE_STDIO_H, HAVE_STDLIB_H, HAVE_STRING_H
</code></pre>
<p><strong>PARAMETERS</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">Description</th><th style="text-align: left">Default Value</th></tr></thead><tbody>
<tr><td style="text-align: left"><a id="macros.AC_CHECK_HEADERS-headers"></a>headers</td><td style="text-align: left">List of header names to check (e.g. "sys/stat.h").</td><td style="text-align: left">none</td></tr>
<tr><td style="text-align: left"><a id="macros.AC_CHECK_HEADERS-language"></a>language</td><td style="text-align: left">Language to use for checks (<code>"c"</code> or <code>"cpp"</code>).</td><td style="text-align: left"><code>"c"</code></td></tr>
<tr><td style="text-align: left"><a id="macros.AC_CHECK_HEADERS-includes"></a>includes</td><td style="text-align: left">Optional list of include directives (e.g. ["#include &lt;stdio.h&gt;"]).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="macros.AC_CHECK_HEADERS-compile_defines"></a>compile_defines</td><td style="text-align: left">Optional list of preprocessor define names (applies to all checks).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="macros.AC_CHECK_HEADERS-requires"></a>requires</td><td style="text-align: left">Requirements that must be met (applies to all checks).</td><td style="text-align: left"><code>None</code></td></tr>
</tbody></table>
</div>
<p><strong>RETURNS</strong></p>
<p>List of JSON-encoded check strings.</p>
<p><a id="macros.AC_CHECK_MEMBERS"></a></p>
<h2 id="macrosac_check_members"><a class="header" href="#macrosac_check_members">macros.AC_CHECK_MEMBERS</a></h2>
<pre>
load("@rules_cc_autoconf//autoconf:checks.bzl", "macros")

macros.AC_CHECK_MEMBERS(<a href="checks.html#macros.AC_CHECK_MEMBERS-aggregate_members">aggregate_members</a>, *, <a href="checks.html#macros.AC_CHECK_MEMBERS-includes">includes</a>, <a href="checks.html#macros.AC_CHECK_MEMBERS-language">language</a>, <a href="checks.html#macros.AC_CHECK_MEMBERS-compile_defines">compile_defines</a>, <a href="checks.html#macros.AC_CHECK_MEMBERS-requires">requires</a>,
                        <a href="checks.html#macros.AC_CHECK_MEMBERS-if_true">if_true</a>, <a href="checks.html#macros.AC_CHECK_MEMBERS-if_false">if_false</a>, <a href="checks.html#macros.AC_CHECK_MEMBERS-subst">subst</a>)
</pre>
<p>Check multiple structure members, creating HAVE_<AGG>_<MEMBER> defines (AC_CHECK_MEMBERS).</p>
<p>GNU Autoconf's AC_CHECK_MEMBER(aggregate.member, ...) checks whether a
structure member exists. This macro runs AC_CHECK_MEMBER for each
"aggregate.member" and sets HAVE_<AGGREGATE>_<MEMBER> (e.g.
HAVE_STRUCT_STAT_ST_RDEV). Use includes with <code>#include &lt;foo&gt;</code> for headers
that declare the aggregate.</p>
<p>Upstream:
https://www.gnu.org/savannah-checkouts/gnu/autoconf/manual/autoconf-2.72/autoconf.html#index-AC_005fCHECK_002dMEMBER</p>
<p>M4 example (configure.ac):
AC_CHECK_MEMBERS([struct stat.st_rdev, struct tm.tm_zone], [], [], [[#include &lt;sys/stat.h&gt;]])
AC_CHECK_MEMBER([struct stat.st_rdev], [], [], [[#include &lt;sys/stat.h&gt;]])</p>
<p>Bazel example (use <code>#include &lt;foo&gt;</code> in includes):
load("//autoconf:checks.bzl", "macros")
macros.AC_CHECK_MEMBERS(
["struct stat.st_rdev", "struct tm.tm_zone"],
includes = ["#include &lt;sys/stat.h&gt;", "#include &lt;time.h&gt;"],
)</p>
<p><strong>PARAMETERS</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">Description</th><th style="text-align: left">Default Value</th></tr></thead><tbody>
<tr><td style="text-align: left"><a id="macros.AC_CHECK_MEMBERS-aggregate_members"></a>aggregate_members</td><td style="text-align: left">List of member specs (e.g. ["struct stat.st_rdev"]).</td><td style="text-align: left">none</td></tr>
<tr><td style="text-align: left"><a id="macros.AC_CHECK_MEMBERS-includes"></a>includes</td><td style="text-align: left">Optional list of include directives (e.g. ["#include &lt;sys/stat.h&gt;"]).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="macros.AC_CHECK_MEMBERS-language"></a>language</td><td style="text-align: left">Language to use for checks (<code>"c"</code> or <code>"cpp"</code>).</td><td style="text-align: left"><code>"c"</code></td></tr>
<tr><td style="text-align: left"><a id="macros.AC_CHECK_MEMBERS-compile_defines"></a>compile_defines</td><td style="text-align: left">Optional list of preprocessor define names (applies to all checks).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="macros.AC_CHECK_MEMBERS-requires"></a>requires</td><td style="text-align: left">Requirements that must be met (applies to all checks).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="macros.AC_CHECK_MEMBERS-if_true"></a>if_true</td><td style="text-align: left">Value to use when check succeeds (applies to all checks).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="macros.AC_CHECK_MEMBERS-if_false"></a>if_false</td><td style="text-align: left">Value to use when check fails (applies to all checks).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="macros.AC_CHECK_MEMBERS-subst"></a>subst</td><td style="text-align: left">Subst behavior (applies to all checks).</td><td style="text-align: left"><code>None</code></td></tr>
</tbody></table>
</div>
<p><strong>RETURNS</strong></p>
<p>List of JSON-encoded check strings.</p>
<p><a id="macros.AC_CHECK_TYPES"></a></p>
<h2 id="macrosac_check_types"><a class="header" href="#macrosac_check_types">macros.AC_CHECK_TYPES</a></h2>
<pre>
load("@rules_cc_autoconf//autoconf:checks.bzl", "macros")

macros.AC_CHECK_TYPES(<a href="checks.html#macros.AC_CHECK_TYPES-types">types</a>, *, <a href="checks.html#macros.AC_CHECK_TYPES-code">code</a>, <a href="checks.html#macros.AC_CHECK_TYPES-includes">includes</a>, <a href="checks.html#macros.AC_CHECK_TYPES-language">language</a>, <a href="checks.html#macros.AC_CHECK_TYPES-compile_defines">compile_defines</a>, <a href="checks.html#macros.AC_CHECK_TYPES-requires">requires</a>, <a href="checks.html#macros.AC_CHECK_TYPES-if_true">if_true</a>,
                      <a href="checks.html#macros.AC_CHECK_TYPES-if_false">if_false</a>, <a href="checks.html#macros.AC_CHECK_TYPES-subst">subst</a>)
</pre>
<p>Check multiple types, creating HAVE_<TYPE> defines (AC_CHECK_TYPES).</p>
<p>GNU Autoconf's AC_CHECK_TYPE(type, ...) checks whether each type is defined.
This macro runs AC_CHECK_TYPE for each type and sets HAVE_<TYPE> (e.g.
HAVE_SIZE_T) following autoconf conventions. Use includes with
<code>#include &lt;foo&gt;</code> for the headers that declare the types.</p>
<p>Upstream:
https://www.gnu.org/savannah-checkouts/gnu/autoconf/manual/autoconf-2.72/autoconf.html#index-AC_005fCHECK_002dTYPE</p>
<p>M4 example (configure.ac):
AC_CHECK_TYPES([size_t, pthread_t, pid_t], [], [], [[#include &lt;stddef.h&gt;]])
AC_CHECK_TYPE([pthread_t], [], [], [[#include &lt;pthread.h&gt;]])</p>
<p>Bazel example (use <code>#include &lt;foo&gt;</code> in includes):
load("//autoconf:checks.bzl", "macros")
macros.AC_CHECK_TYPES(["size_t", "pthread_t", "pid_t"], includes = ["#include &lt;stddef.h&gt;", "#include &lt;pthread.h&gt;"])</p>
<h1 id="defines-have_size_t-have_pthread_t-have_pid_t"><a class="header" href="#defines-have_size_t-have_pthread_t-have_pid_t">Defines: HAVE_SIZE_T, HAVE_PTHREAD_T, HAVE_PID_T</a></h1>
<p><strong>PARAMETERS</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">Description</th><th style="text-align: left">Default Value</th></tr></thead><tbody>
<tr><td style="text-align: left"><a id="macros.AC_CHECK_TYPES-types"></a>types</td><td style="text-align: left">List of type names to check.</td><td style="text-align: left">none</td></tr>
<tr><td style="text-align: left"><a id="macros.AC_CHECK_TYPES-code"></a>code</td><td style="text-align: left">Custom code that includes necessary headers (applies to all checks).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="macros.AC_CHECK_TYPES-includes"></a>includes</td><td style="text-align: left">Optional list of include directives (e.g. ["#include &lt;stddef.h&gt;"]).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="macros.AC_CHECK_TYPES-language"></a>language</td><td style="text-align: left">Language to use for checks (<code>"c"</code> or <code>"cpp"</code>).</td><td style="text-align: left"><code>"c"</code></td></tr>
<tr><td style="text-align: left"><a id="macros.AC_CHECK_TYPES-compile_defines"></a>compile_defines</td><td style="text-align: left">Optional list of preprocessor define names (applies to all checks).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="macros.AC_CHECK_TYPES-requires"></a>requires</td><td style="text-align: left">Requirements that must be met (applies to all checks).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="macros.AC_CHECK_TYPES-if_true"></a>if_true</td><td style="text-align: left">Value to use when check succeeds (applies to all checks).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="macros.AC_CHECK_TYPES-if_false"></a>if_false</td><td style="text-align: left">Value to use when check fails (applies to all checks).</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="macros.AC_CHECK_TYPES-subst"></a>subst</td><td style="text-align: left">Subst behavior (applies to all checks).</td><td style="text-align: left"><code>None</code></td></tr>
</tbody></table>
</div>
<p><strong>RETURNS</strong></p>
<p>List of JSON-encoded check strings.</p>
<p><a id="utils.AC_LANG_PROGRAM"></a></p>
<h2 id="utilsac_lang_program"><a class="header" href="#utilsac_lang_program">utils.AC_LANG_PROGRAM</a></h2>
<pre>
load("@rules_cc_autoconf//autoconf:checks.bzl", "utils")

utils.AC_LANG_PROGRAM(<a href="checks.html#utils.AC_LANG_PROGRAM-prologue">prologue</a>, <a href="checks.html#utils.AC_LANG_PROGRAM-body">body</a>)
</pre>
<p>Build program code from prologue and main body (AC_LANG_PROGRAM).</p>
<p>GNU Autoconf's AC_LANG_PROGRAM(prologue, body) expands to a complete test
program: prologue (includes/declarations) followed by main() containing body.
Use the result as the <code>code</code> argument to AC_TRY_COMPILE or AC_TRY_LINK.</p>
<p>Upstream:
https://www.gnu.org/savannah-checkouts/gnu/autoconf/manual/autoconf-2.72/autoconf.html#index-AC_005fLANG_005fPROGRAM</p>
<p>M4 example (configure.ac):
AC_TRY_COMPILE([AC_LANG_PROGRAM([[#include &lt;stdio.h&gt;]], [printf("test");])], ...)
AC_TRY_LINK([AC_LANG_PROGRAM([[#include &lt;langinfo.h&gt;]], [char* cs = nl_langinfo(CODESET); return !cs;])], ...)</p>
<p>Bazel example (use <code>#include &lt;foo&gt;</code> in the prologue list):
load("//autoconf:checks.bzl", "utils", "checks")
checks.AC_TRY_COMPILE(
code = utils.AC_LANG_PROGRAM(["#include &lt;stdio.h&gt;"], "printf("test");"),
define = "HAVE_PRINTF",
)
checks.AC_TRY_LINK(
code = utils.AC_LANG_PROGRAM(
["#include &lt;langinfo.h&gt;"],
"char* cs = nl_langinfo(CODESET); return !cs;",
),
define = "HAVE_LANGINFO_CODESET",
)</p>
<p><strong>PARAMETERS</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">Description</th><th style="text-align: left">Default Value</th></tr></thead><tbody>
<tr><td style="text-align: left"><a id="utils.AC_LANG_PROGRAM-prologue"></a>prologue</td><td style="text-align: left">List of strings (include directives or declarations), joined with newlines.</td><td style="text-align: left">none</td></tr>
<tr><td style="text-align: left"><a id="utils.AC_LANG_PROGRAM-body"></a>body</td><td style="text-align: left">Code inside main() — a string, or a list of strings joined with newlines.</td><td style="text-align: left">none</td></tr>
</tbody></table>
</div>
<p><strong>RETURNS</strong></p>
<p>A string suitable for the <code>code</code> parameter of AC_TRY_COMPILE or AC_TRY_LINK.</p>
<div style="break-before: page; page-break-before: always;"></div><!-- Generated with Stardoc: http://skydoc.bazel.build -->
<h1 id="package_info"><a class="header" href="#package_info">package_info</a></h1>
<h2 id="rules-4"><a class="header" href="#rules-4">Rules</a></h2>
<ul>
<li><a href="package_info.html#package_info">package_info</a></li>
</ul>
<p><a id="package_info"></a></p>
<h2 id="package_info-1"><a class="header" href="#package_info-1">package_info</a></h2>
<pre>
load("@rules_cc_autoconf//autoconf:package_info.bzl", "package_info")

package_info(<a href="package_info.html#package_info-name">name</a>, <a href="package_info.html#package_info-module_bazel">module_bazel</a>, <a href="package_info.html#package_info-package_bugreport">package_bugreport</a>, <a href="package_info.html#package_info-package_name">package_name</a>, <a href="package_info.html#package_info-package_tarname">package_tarname</a>, <a href="package_info.html#package_info-package_url">package_url</a>,
             <a href="package_info.html#package_info-package_version">package_version</a>)
</pre>
<p>A rule for parsing module info from <code>MODULE.bazel</code> files.</p>
<p>This rule is most useful when paired with the <code>autoconf</code> rule.</p>
<p>Example:</p>
<pre><code class="language-python">load("@rules_cc_autoconf//autoconf:autoconf.bzl", "autoconf")
load("@rules_cc_autoconf//autoconf:package_info.bzl", "package_info")

package_info(
    name = "package_info",
    module_bazel = "//:MODULE.bazel",
)

autoconf(
    name = "config_h",
    out = "config.h",
    checks = [
        # ...
    ],
    deps = [
        ":package_info",
    ],
)
</code></pre>
<p><strong>ATTRIBUTES</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Name</th><th style="text-align: left">Description</th><th style="text-align: left">Type</th><th style="text-align: left">Mandatory</th><th style="text-align: left">Default</th></tr></thead><tbody>
<tr><td style="text-align: left"><a id="package_info-name"></a>name</td><td style="text-align: left">A unique name for this target.</td><td style="text-align: left"><a href="https://bazel.build/concepts/labels#target-names">Name</a></td><td style="text-align: left">required</td><td style="text-align: left"></td></tr>
<tr><td style="text-align: left"><a id="package_info-module_bazel"></a>module_bazel</td><td style="text-align: left">A <code>MODULE.bazel</code> file to parse module information from. Mutually exclusive with <code>package_name</code> and <code>package_version</code>.</td><td style="text-align: left"><a href="https://bazel.build/concepts/labels">Label</a></td><td style="text-align: left">optional</td><td style="text-align: left"><code>None</code></td></tr>
<tr><td style="text-align: left"><a id="package_info-package_bugreport"></a>package_bugreport</td><td style="text-align: left">The package bug report email/URL. Used to populate <code>PACKAGE_BUGREPORT</code> define.</td><td style="text-align: left">String</td><td style="text-align: left">optional</td><td style="text-align: left"><code>""</code></td></tr>
<tr><td style="text-align: left"><a id="package_info-package_name"></a>package_name</td><td style="text-align: left">The package name. Must be provided together with <code>package_version</code> if <code>module_bazel</code> is not provided.</td><td style="text-align: left">String</td><td style="text-align: left">optional</td><td style="text-align: left"><code>""</code></td></tr>
<tr><td style="text-align: left"><a id="package_info-package_tarname"></a>package_tarname</td><td style="text-align: left">Exactly tarname, possibly generated from package.</td><td style="text-align: left">String</td><td style="text-align: left">optional</td><td style="text-align: left"><code>""</code></td></tr>
<tr><td style="text-align: left"><a id="package_info-package_url"></a>package_url</td><td style="text-align: left">The package home page URL. Used to populate <code>PACKAGE_URL</code> define.</td><td style="text-align: left">String</td><td style="text-align: left">optional</td><td style="text-align: left"><code>""</code></td></tr>
<tr><td style="text-align: left"><a id="package_info-package_version"></a>package_version</td><td style="text-align: left">The package version. Must be provided together with <code>package_name</code> if <code>module_bazel</code> is not provided.</td><td style="text-align: left">String</td><td style="text-align: left">optional</td><td style="text-align: left"><code>""</code></td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="gnulib"><a class="header" href="#gnulib">Gnulib</a></h1>
<p>The <code>@rules_cc_autoconf//gnulib</code> module provides a collection of pre-built autoconf checks
based on <a href="https://www.gnu.org/software/gnulib/">GNU Gnulib</a>, a portability library for
Unix-like systems. Instead of manually writing checks for common functions, headers, and
types, you can reuse these well-tested, platform-aware implementations.</p>
<h2 id="what-is-it"><a class="header" href="#what-is-it">What is it?</a></h2>
<p>Gnulib is a collection of M4 macros and C code that provides portability checks and
replacements for common POSIX functions. The <code>@rules_cc_autoconf//gnulib</code> module translates
many of these M4 macros into Bazel <code>autoconf</code> targets that you can use as dependencies.</p>
<p>Each target in <code>@rules_cc_autoconf//gnulib/m4/</code> corresponds to a gnulib M4 macro and
provides the same checks and defines that you would get from using that macro in a
traditional <code>configure.ac</code> file.</p>
<h2 id="using-gnulib-targets"><a class="header" href="#using-gnulib-targets">Using Gnulib Targets</a></h2>
<p>Instead of manually writing checks, you can add gnulib reusable targets as dependencies to your
<code>autoconf</code> rule:</p>
<pre><code class="language-python">load("@rules_cc_autoconf//autoconf:autoconf.bzl", "autoconf")
load("@rules_cc_autoconf//autoconf:autoconf_hdr.bzl", "autoconf_hdr")
load("@rules_cc_autoconf//autoconf:checks.bzl", "checks")
load("@rules_cc_autoconf//autoconf:package_info.bzl", "package_info")

package_info(
    name = "package",
    package_name = "my_package",
    package_version = "1.0.0",
)

autoconf(
    name = "autoconf",
    checks = [
        # Only add custom checks that aren't available in gnulib
        checks.AC_DEFINE("CUSTOM_FEATURE", "1"),
    ],
    deps = [
        ":package",
        "@rules_cc_autoconf//gnulib/m4/lstat",      # Provides AC_CHECK_FUNC("lstat")
        "@rules_cc_autoconf//gnulib/m4/access",     # Provides AC_CHECK_FUNC("access")
        "@rules_cc_autoconf//gnulib/m4/unistd_h",   # Provides AC_CHECK_HEADER("unistd.h")
        "@rules_cc_autoconf//gnulib/m4/sys_stat_h", # Provides AC_CHECK_HEADER("sys/stat.h")
    ],
)

autoconf_hdr(
    name = "config",
    out = "config.h",
    template = "config.h.in",
    deps = [":autoconf"],
)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="m4-to-bazel-migration-guide"><a class="header" href="#m4-to-bazel-migration-guide">M4 to Bazel Migration Guide</a></h1>
<p>This guide teaches how to convert GNU Autoconf M4 macros (from <code>configure.ac</code> files) to the equivalent Bazel rules in this repository.</p>
<p><strong>Important Constraint:</strong> When porting gnulib modules or fixing failing tests, you may <strong>only</strong> modify <code>BUILD.bazel</code> files. The following are <strong>not</strong> allowed:</p>
<ul>
<li>Golden files (e.g. <code>golden_config*.h.in</code>, <code>golden_subst*.h.in</code>)</li>
<li><code>configure.ac</code> files</li>
<li><code>.bzl</code> files (autoconf rules, checks, macros, etc.)</li>
<li>Duplicates targets (e.g. <code>//gnulib/tests/duplicates:gnulib</code> and its dependency list)</li>
</ul>
<p><strong>Resolving duplicate check conflicts:</strong> If two modules define the same check and cause a conflict when aggregated (e.g. in the duplicates test), do <em>not</em> remove either module from the duplicates list. Instead, create an isolated <code>autoconf</code> target that contains <em>only</em> the conflicting check, then add that target as a dependency to both consumers.</p>
<hr />
<h2 id="table-of-contents"><a class="header" href="#table-of-contents">Table of Contents</a></h2>
<ol>
<li><a href="migration.html#quick-start">Quick Start</a></li>
<li><a href="migration.html#architecture-overview">Architecture Overview</a></li>
<li><a href="migration.html#core-concepts">Core Concepts</a></li>
<li><a href="migration.html#migration-patterns">Migration Patterns</a></li>
<li><a href="migration.html#api-reference">API Reference</a></li>
<li><a href="migration.html#platform-conditionals">Platform Conditionals</a></li>
<li><a href="migration.html#dependencies-and-reusable-modules">Dependencies and Reusable Modules</a></li>
<li><a href="migration.html#porting-strategy">Porting Strategy</a></li>
<li><a href="migration.html#best-practices">Best Practices</a></li>
<li><a href="migration.html#cross-compilation-considerations">Cross-Compilation Considerations</a></li>
<li><a href="migration.html#complete-examples">Complete Examples</a></li>
</ol>
<hr />
<h2 id="quick-start"><a class="header" href="#quick-start">Quick Start</a></h2>
<h3 id="minimal-example"><a class="header" href="#minimal-example">Minimal Example</a></h3>
<p><strong>M4 (configure.ac):</strong></p>
<pre><code class="language-m4">AC_INIT([myproject], [1.0.0])
AC_CONFIG_HEADERS([config.h])
AC_CHECK_HEADERS([stdio.h stdlib.h])
AC_CHECK_FUNCS([malloc printf])
AC_OUTPUT
</code></pre>
<p><strong>Bazel (BUILD.bazel):</strong></p>
<pre><code class="language-python">load("@rules_cc_autoconf//autoconf:autoconf.bzl", "autoconf")
load("@rules_cc_autoconf//autoconf:autoconf_hdr.bzl", "autoconf_hdr")
load("@rules_cc_autoconf//autoconf:checks.bzl", "checks")
load("@rules_cc_autoconf//autoconf:package_info.bzl", "package_info")

package_info(
    name = "package",
    package_name = "myproject",
    package_version = "1.0.0",
)

autoconf(
    name = "autoconf",
    checks = [
        checks.AC_CHECK_HEADER("stdio.h", define = "HAVE_STDIO_H"),
        checks.AC_CHECK_HEADER("stdlib.h", define = "HAVE_STDLIB_H"),
        checks.AC_CHECK_FUNC("malloc", define = "HAVE_MALLOC"),
        checks.AC_CHECK_FUNC("printf", define = "HAVE_PRINTF"),
    ],
    deps = [":package"],
)

autoconf_hdr(
    name = "config",
    out = "config.h",
    template = "config.h.in",
    deps = [":autoconf"],
)
</code></pre>
<hr />
<h2 id="architecture-overview"><a class="header" href="#architecture-overview">Architecture Overview</a></h2>
<p>The migration system consists of three main components:</p>
<h3 id="1-autoconf-rule"><a class="header" href="#1-autoconf-rule">1. <code>autoconf</code> Rule</a></h3>
<p>Runs compilation checks against the configured <code>cc_toolchain</code> and produces check results. Each check creates a <strong>cache variable</strong> (e.g., <code>ac_cv_header_stdio_h</code>) and optionally a <strong>define</strong> (e.g., <code>HAVE_STDIO_H</code>) or <strong>subst</strong> value.</p>
<h3 id="2-autoconf_hdr-rule"><a class="header" href="#2-autoconf_hdr-rule">2. <code>autoconf_hdr</code> Rule</a></h3>
<p>Takes check results from <code>autoconf</code> targets and generates header files by processing templates. Supports two modes:</p>
<ul>
<li><code>mode = "defines"</code> — For <code>config.h</code> files (processes <code>#undef</code> directives)</li>
<li><code>mode = "subst"</code> — For substitution files (processes <code>@VAR@</code> placeholders)</li>
</ul>
<h3 id="3-package_info-rule"><a class="header" href="#3-package_info-rule">3. <code>package_info</code> Rule</a></h3>
<p>Provides package metadata (<code>PACKAGE_NAME</code>, <code>PACKAGE_VERSION</code>, etc.) equivalent to <code>AC_INIT</code>.</p>
<h3 id="data-flow"><a class="header" href="#data-flow">Data Flow</a></h3>
<pre><code>configure.ac         →    BUILD.bazel
     ↓                         ↓
AC_INIT           →    package_info
AC_CHECK_*        →    autoconf (checks = [...])
AC_CONFIG_HEADERS →    autoconf_hdr
</code></pre>
<hr />
<h2 id="core-concepts"><a class="header" href="#core-concepts">Core Concepts</a></h2>
<h3 id="cache-variables-vs-defines-vs-subst"><a class="header" href="#cache-variables-vs-defines-vs-subst">Cache Variables vs Defines vs Subst</a></h3>
<p>Understanding the three types of outputs is crucial:</p>
<div class="table-wrapper"><table><thead><tr><th>Type</th><th>Purpose</th><th>Naming Convention</th><th>Output</th></tr></thead><tbody>
<tr><td><strong>Cache Variable</strong></td><td>Internal check result</td><td><code>ac_cv_*</code> (e.g., <code>ac_cv_header_stdio_h</code>)</td><td>JSON result file</td></tr>
<tr><td><strong>Define</strong></td><td>C preprocessor define</td><td><code>HAVE_*</code>, <code>SIZEOF_*</code>, etc.</td><td><code>config.h</code> via <code>#define</code></td></tr>
<tr><td><strong>Subst</strong></td><td>Template substitution</td><td><code>@VAR@</code> patterns</td><td><code>subst.h</code> via placeholder replacement</td></tr>
</tbody></table>
</div>
<p><strong>Example:</strong></p>
<pre><code class="language-python"># Creates ONLY a cache variable (no define, no subst)
checks.AC_CHECK_HEADER("stdio.h")
# → Cache: ac_cv_header_stdio_h

# Creates cache variable AND define
checks.AC_CHECK_HEADER("stdio.h", define = "HAVE_STDIO_H")
# → Cache: ac_cv_header_stdio_h
# → Define: HAVE_STDIO_H (in config.h)

# Creates cache variable, define, AND subst
checks.AC_CHECK_HEADER("stdio.h", define = "HAVE_STDIO_H", subst = True)
# → Cache: ac_cv_header_stdio_h
# → Define: HAVE_STDIO_H (in config.h)
# → Subst: HAVE_STDIO_H (replaces @HAVE_STDIO_H@ in subst.h)
</code></pre>
<h3 id="the-name-parameter"><a class="header" href="#the-name-parameter">The <code>name</code> Parameter</a></h3>
<p>Every check has a <code>name</code> parameter (auto-generated if not specified) that becomes the cache variable name:</p>
<pre><code class="language-python"># Auto-generated name: "ac_cv_header_stdio_h"
checks.AC_CHECK_HEADER("stdio.h")

# Custom name
checks.AC_CHECK_HEADER("stdio.h", name = "my_custom_cache_var")
</code></pre>
<h3 id="the-define-parameter"><a class="header" href="#the-define-parameter">The <code>define</code> Parameter</a></h3>
<p>Controls whether and how a define is created:</p>
<pre><code class="language-python"># No define (default) — only creates cache variable
checks.AC_CHECK_HEADER("stdio.h")

# Use cache variable name as define name
checks.AC_CHECK_HEADER("stdio.h", define = True)
# → Define name: ac_cv_header_stdio_h

# Explicit define name
checks.AC_CHECK_HEADER("stdio.h", define = "HAVE_STDIO_H")
# → Define name: HAVE_STDIO_H
</code></pre>
<h3 id="efficiency-define-vs-name--separate-ac_define"><a class="header" href="#efficiency-define-vs-name--separate-ac_define">Efficiency: <code>define</code> vs. <code>name</code> + separate <code>AC_DEFINE</code></a></h3>
<p>There are two ways to conditionally define a value based on a check result. <strong>Prefer <code>define</code> when possible</strong> — it's more efficient because it generates fewer internal operations.</p>
<h4 id="use-define-directly-preferred"><a class="header" href="#use-define-directly-preferred">Use <code>define</code> directly (preferred)</a></h4>
<p>When you just need to set <code>HAVE_X</code> based on whether a check succeeds:</p>
<pre><code class="language-python"># EFFICIENT: One check, one define
checks.AC_CHECK_HEADER("argz.h", define = "HAVE_ARGZ_H")
</code></pre>
<p>This is equivalent to M4's <code>AC_CHECK_HEADER([argz.h])</code> which automatically defines <code>HAVE_ARGZ_H</code> if the header is found.</p>
<h4 id="use-name--ac_definerequires-only-when-necessary"><a class="header" href="#use-name--ac_definerequires-only-when-necessary">Use <code>name</code> + <code>AC_DEFINE(requires=...)</code> only when necessary</a></h4>
<p>Split the check and define <strong>only</strong> when one of these conditions applies:</p>
<ol>
<li><strong>Other checks reference the cache variable</strong> via <code>requires</code>:</li>
</ol>
<pre><code class="language-python"># REQUIRED: The cache variable is used by another check's `requires`
checks.AC_CHECK_HEADER("argz.h", name = "ac_cv_header_argz_h")
checks.AC_DEFINE("HAVE_ARGZ_H", requires = ["ac_cv_header_argz_h==1"])

# This check depends on the header being found
checks.AC_CHECK_TYPE(
    "error_t",
    code = "#include &lt;argz.h&gt;\nint main(void) { if (sizeof(error_t)) return 0; return 1; }",
    name = "ac_cv_type_error_t",
    requires = ["ac_cv_header_argz_h==1"],  # &lt;-- Only run if header check passed
)
</code></pre>
<ol start="2">
<li><strong>Non-standard values</strong> (use <code>condition</code> for value selection):</li>
</ol>
<pre><code class="language-python"># Use condition when you need different values based on a check
checks.AC_CHECK_FUNC("foo", name = "ac_cv_func_foo")
checks.AC_DEFINE("HAVE_FOO", condition = "ac_cv_func_foo", if_true = "yes", if_false = "no")
</code></pre>
<ol start="3">
<li><strong>Multiple outputs from one check</strong> (both <code>AC_DEFINE</code> and <code>AC_SUBST</code>):</li>
</ol>
<pre><code class="language-python"># One check drives multiple outputs
checks.AC_CHECK_FUNC("lstat", name = "ac_cv_func_lstat")
checks.AC_DEFINE("HAVE_LSTAT", requires = ["ac_cv_func_lstat==1"])
checks.AC_SUBST("HAVE_LSTAT", condition = "ac_cv_func_lstat", if_true = "1", if_false = "0")
</code></pre>
<h4 id="requires-vs-condition"><a class="header" href="#requires-vs-condition"><code>requires</code> vs. <code>condition</code></a></h4>
<p>Use the correct parameter for the right purpose:</p>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Purpose</th><th>Example</th></tr></thead><tbody>
<tr><td><code>requires</code></td><td><strong>Gate whether the check runs</strong> — if requirements aren't met, the define is not created</td><td><code>requires = ["ac_cv_func_foo==1"]</code></td></tr>
<tr><td><code>condition</code></td><td><strong>Select between two values</strong> — the check always runs, but produces different values</td><td><code>condition = "ac_cv_func_foo", if_true = "1", if_false = "0"</code></td></tr>
</tbody></table>
</div>
<p><strong>Anti-pattern:</strong> Don't use <code>condition</code> with <code>if_false = None</code> to gate a define:</p>
<pre><code class="language-python"># BAD: Using condition to gate (if_false = None behavior may change)
checks.AC_DEFINE("HAVE_FOO", condition = "ac_cv_func_foo", if_true = 1, if_false = None)

# GOOD: Use requires to gate
checks.AC_DEFINE("HAVE_FOO", requires = ["ac_cv_func_foo==1"])
</code></pre>
<h4 id="anti-pattern-unnecessary-splitting"><a class="header" href="#anti-pattern-unnecessary-splitting">Anti-pattern: Unnecessary splitting</a></h4>
<p><strong>Don't do this</strong> — it's wasteful and harder to read:</p>
<pre><code class="language-python"># BAD: Unnecessary split when `define` would suffice
checks.AC_CHECK_HEADER("stdio.h", name = "ac_cv_header_stdio_h")
checks.AC_DEFINE("HAVE_STDIO_H", requires = ["ac_cv_header_stdio_h==1"])

# GOOD: Use `define` directly
checks.AC_CHECK_HEADER("stdio.h", define = "HAVE_STDIO_H")
</code></pre>
<hr />
<h2 id="migration-patterns"><a class="header" href="#migration-patterns">Migration Patterns</a></h2>
<h3 id="pattern-1-simple-header-checks"><a class="header" href="#pattern-1-simple-header-checks">Pattern 1: Simple Header Checks</a></h3>
<p><strong>M4:</strong></p>
<pre><code class="language-m4">AC_CHECK_HEADER([stdio.h])
AC_CHECK_HEADERS([stdlib.h string.h unistd.h])
</code></pre>
<p><strong>Bazel:</strong></p>
<pre><code class="language-python">checks.AC_CHECK_HEADER("stdio.h", define = "HAVE_STDIO_H")
checks.AC_CHECK_HEADER("stdlib.h", define = "HAVE_STDLIB_H")
checks.AC_CHECK_HEADER("string.h", define = "HAVE_STRING_H")
checks.AC_CHECK_HEADER("unistd.h", define = "HAVE_UNISTD_H")
</code></pre>
<p><strong>Rules:</strong></p>
<ul>
<li>Remove square brackets, add quotes</li>
<li>Split <code>AC_CHECK_HEADERS</code> (plural) into individual <code>AC_CHECK_HEADER</code> calls</li>
<li>Add <code>define = "HAVE_&lt;HEADER&gt;"</code> to create defines in <code>config.h</code></li>
</ul>
<hr />
<h3 id="pattern-2-function-checks"><a class="header" href="#pattern-2-function-checks">Pattern 2: Function Checks</a></h3>
<p><strong>M4:</strong></p>
<pre><code class="language-m4">AC_CHECK_FUNC([malloc])
AC_CHECK_FUNCS([printf scanf fopen])
</code></pre>
<p><strong>Bazel:</strong></p>
<pre><code class="language-python">checks.AC_CHECK_FUNC("malloc", define = "HAVE_MALLOC")
checks.AC_CHECK_FUNC("printf", define = "HAVE_PRINTF")
checks.AC_CHECK_FUNC("scanf", define = "HAVE_SCANF")
checks.AC_CHECK_FUNC("fopen", define = "HAVE_FOPEN")
</code></pre>
<p><strong>Rules:</strong></p>
<ul>
<li>Use the GNU Autoconf extern declaration pattern automatically</li>
<li>Add <code>define = "HAVE_&lt;FUNCTION&gt;"</code> for config.h defines</li>
</ul>
<hr />
<h3 id="pattern-3-type-checks"><a class="header" href="#pattern-3-type-checks">Pattern 3: Type Checks</a></h3>
<p><strong>M4:</strong></p>
<pre><code class="language-m4">AC_CHECK_TYPE([size_t])
AC_CHECK_TYPES([int8_t, int64_t], [], [], [[#include &lt;stdint.h&gt;]])
</code></pre>
<p><strong>Bazel:</strong></p>
<pre><code class="language-python"># Without explicit includes (uses AC_INCLUDES_DEFAULT)
checks.AC_CHECK_TYPE("size_t", define = "HAVE_SIZE_T")

# With explicit includes
checks.AC_CHECK_TYPE("int8_t", define = "HAVE_INT8_T", includes = ["#include &lt;stdint.h&gt;"])
checks.AC_CHECK_TYPE("int64_t", define = "HAVE_INT64_T", includes = ["#include &lt;stdint.h&gt;"])
</code></pre>
<hr />
<h3 id="pattern-4-declaration-checks"><a class="header" href="#pattern-4-declaration-checks">Pattern 4: Declaration Checks</a></h3>
<p><strong>M4:</strong></p>
<pre><code class="language-m4">AC_CHECK_DECL([NULL], [], [], [[#include &lt;stddef.h&gt;]])
AC_CHECK_DECLS([execvpe], [], [], [[#include &lt;unistd.h&gt;]])
</code></pre>
<p><strong>Bazel:</strong></p>
<pre><code class="language-python">checks.AC_CHECK_DECL("NULL", define = "HAVE_DECL_NULL", includes = ["#include &lt;stddef.h&gt;"])
checks.AC_CHECK_DECL("execvpe", define = "HAVE_DECL_EXECVPE", includes = ["#include &lt;unistd.h&gt;"])
</code></pre>
<p><strong>Note:</strong> <code>AC_CHECK_DECL</code> differs from <code>AC_CHECK_FUNC</code> — it checks if something is <em>declared</em> (not just defined as a macro).</p>
<hr />
<h3 id="pattern-5-member-checks"><a class="header" href="#pattern-5-member-checks">Pattern 5: Member Checks</a></h3>
<p><strong>M4:</strong></p>
<pre><code class="language-m4">AC_CHECK_MEMBER([struct stat.st_rdev], [], [], [[#include &lt;sys/stat.h&gt;]])
AC_CHECK_MEMBERS([struct tm.tm_zone, struct stat.st_blocks])
</code></pre>
<p><strong>Bazel:</strong></p>
<pre><code class="language-python">checks.AC_CHECK_MEMBER(
    "struct stat.st_rdev",
    define = "HAVE_STRUCT_STAT_ST_RDEV",
    includes = ["#include &lt;sys/stat.h&gt;"],
)
checks.AC_CHECK_MEMBER(
    "struct tm.tm_zone",
    define = "HAVE_STRUCT_TM_TM_ZONE",
    includes = ["#include &lt;time.h&gt;"],
)
</code></pre>
<hr />
<h3 id="pattern-6-size-and-alignment-checks"><a class="header" href="#pattern-6-size-and-alignment-checks">Pattern 6: Size and Alignment Checks</a></h3>
<p><strong>M4:</strong></p>
<pre><code class="language-m4">AC_CHECK_SIZEOF([int])
AC_CHECK_SIZEOF([size_t], [], [[#include &lt;stddef.h&gt;]])
AC_CHECK_ALIGNOF([double])
</code></pre>
<p><strong>Bazel:</strong></p>
<pre><code class="language-python">checks.AC_CHECK_SIZEOF("int", define = "SIZEOF_INT")
checks.AC_CHECK_SIZEOF("size_t", define = "SIZEOF_SIZE_T", includes = ["#include &lt;stddef.h&gt;"])
checks.AC_CHECK_ALIGNOF("double", define = "ALIGNOF_DOUBLE")
</code></pre>
<p><strong>Warning:</strong> These macros are NOT cross-compile friendly (see <a href="migration.html#cross-compilation-considerations">Cross-Compilation</a>).</p>
<hr />
<h3 id="pattern-7-library-checks"><a class="header" href="#pattern-7-library-checks">Pattern 7: Library Checks</a></h3>
<p><strong>M4:</strong></p>
<pre><code class="language-m4">AC_CHECK_LIB([m], [cos])
AC_CHECK_LIB([pthread], [pthread_create])
</code></pre>
<p><strong>Bazel:</strong></p>
<pre><code class="language-python">checks.AC_CHECK_LIB("m", "cos", define = "HAVE_LIBM")
checks.AC_CHECK_LIB("pthread", "pthread_create", define = "HAVE_LIBPTHREAD")
</code></pre>
<hr />
<h3 id="pattern-8-compiler-flag-checks"><a class="header" href="#pattern-8-compiler-flag-checks">Pattern 8: Compiler Flag Checks</a></h3>
<p><strong>M4:</strong></p>
<pre><code class="language-m4">AC_MSG_CHECKING([whether $CC accepts -Wall])
save_CFLAGS="$CFLAGS"
CFLAGS="$CFLAGS -Wall"
AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[]], [[]])],
  [AC_MSG_RESULT([yes]); AC_DEFINE([HAVE_FLAG_WALL], [1])],
  [AC_MSG_RESULT([no])])
CFLAGS="$save_CFLAGS"
</code></pre>
<p><strong>Bazel:</strong></p>
<pre><code class="language-python">checks.AC_CHECK_C_COMPILER_FLAG("-Wall", define = "HAVE_FLAG_WALL")
checks.AC_CHECK_CXX_COMPILER_FLAG("-std=c++17", define = "HAVE_FLAG_STD_C__17")
</code></pre>
<hr />
<h3 id="pattern-9-custom-compile-tests"><a class="header" href="#pattern-9-custom-compile-tests">Pattern 9: Custom Compile Tests</a></h3>
<p><strong>M4:</strong></p>
<pre><code class="language-m4">AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[
#include &lt;stdatomic.h&gt;
]], [[
atomic_int x = 0;
(void)x;
]])], [AC_DEFINE([HAVE_STDATOMIC], [1])], [])
</code></pre>
<p><strong>Bazel:</strong></p>
<pre><code class="language-python">checks.AC_TRY_COMPILE(
    code = """
#include &lt;stdatomic.h&gt;
int main(void) {
    atomic_int x = 0;
    (void)x;
    return 0;
}
""",
    define = "HAVE_STDATOMIC",
)
</code></pre>
<p><strong>Alternative using <code>utils.AC_LANG_PROGRAM</code>:</strong></p>
<pre><code class="language-python">load("//autoconf:checks.bzl", "checks", "utils")

checks.AC_TRY_COMPILE(
    code = utils.AC_LANG_PROGRAM(
        ["#include &lt;stdatomic.h&gt;"],  # prologue
        "atomic_int x = 0; (void)x;",  # body of main()
    ),
    define = "HAVE_STDATOMIC",
)
</code></pre>
<hr />
<h3 id="pattern-10-link-tests"><a class="header" href="#pattern-10-link-tests">Pattern 10: Link Tests</a></h3>
<p><strong>M4:</strong></p>
<pre><code class="language-m4">AC_LINK_IFELSE([AC_LANG_PROGRAM([[
#include &lt;langinfo.h&gt;
]], [[
char* cs = nl_langinfo(CODESET);
return !cs;
]])], [AC_DEFINE([HAVE_LANGINFO_CODESET], [1])], [])
</code></pre>
<p><strong>Bazel:</strong></p>
<pre><code class="language-python">checks.AC_TRY_LINK(
    code = utils.AC_LANG_PROGRAM(
        ["#include &lt;langinfo.h&gt;"],
        "char* cs = nl_langinfo(CODESET); return !cs;",
    ),
    define = "HAVE_LANGINFO_CODESET",
)
</code></pre>
<hr />
<h3 id="pattern-11-unconditional-defines"><a class="header" href="#pattern-11-unconditional-defines">Pattern 11: Unconditional Defines</a></h3>
<p><strong>M4:</strong></p>
<pre><code class="language-m4">AC_DEFINE([CUSTOM_VALUE], [42])
AC_DEFINE([ENABLE_FEATURE], [1])
AC_DEFINE([PROJECT_NAME], ["MyProject"])
</code></pre>
<p><strong>Bazel:</strong></p>
<pre><code class="language-python">checks.AC_DEFINE("CUSTOM_VALUE", "42")
checks.AC_DEFINE("ENABLE_FEATURE", "1")
checks.AC_DEFINE("PROJECT_NAME", '"MyProject"')  # Note: inner quotes for string literal
</code></pre>
<hr />
<h3 id="pattern-12-conditional-defines"><a class="header" href="#pattern-12-conditional-defines">Pattern 12: Conditional Defines</a></h3>
<p><strong>M4:</strong></p>
<pre><code class="language-m4">if test "$ac_cv_func_lstat" = yes; then
  AC_DEFINE([HAVE_LSTAT], [1])
fi
</code></pre>
<p><strong>Bazel:</strong></p>
<pre><code class="language-python"># Gate the define on the check result
checks.AC_DEFINE(
    "HAVE_LSTAT",
    requires = ["ac_cv_func_lstat==1"],  # Only define if check passed
)
</code></pre>
<hr />
<h3 id="pattern-13-substitution-variables-ac_subst"><a class="header" href="#pattern-13-substitution-variables-ac_subst">Pattern 13: Substitution Variables (AC_SUBST)</a></h3>
<p><strong>M4:</strong></p>
<pre><code class="language-m4">REPLACE_FSTAT=1
AC_SUBST([REPLACE_FSTAT])
</code></pre>
<p><strong>Bazel:</strong></p>
<pre><code class="language-python">checks.AC_SUBST("REPLACE_FSTAT", "1")
</code></pre>
<p>For conditional subst values:</p>
<pre><code class="language-python">checks.AC_SUBST(
    "REPLACE_STRERROR",
    condition = "_gl_cv_func_strerror_0_works",
    if_true = "0",
    if_false = "1",
)
</code></pre>
<hr />
<h3 id="pattern-14-m4-shell-variables"><a class="header" href="#pattern-14-m4-shell-variables">Pattern 14: M4 Shell Variables</a></h3>
<p>Many M4 macros use shell variables (not <code>AC_DEFINE</code> calls). Use <code>M4_VARIABLE</code> to track these:</p>
<p><strong>M4:</strong></p>
<pre><code class="language-m4">REPLACE_FSTAT=1
HAVE_WORKING_MKTIME=0
</code></pre>
<p><strong>Bazel:</strong></p>
<pre><code class="language-python">checks.M4_VARIABLE("REPLACE_FSTAT", "1")
checks.M4_VARIABLE("HAVE_WORKING_MKTIME", "0")
</code></pre>
<hr />
<h3 id="pattern-15-language-selection"><a class="header" href="#pattern-15-language-selection">Pattern 15: Language Selection</a></h3>
<p><strong>M4:</strong></p>
<pre><code class="language-m4">AC_LANG_PUSH([C++])
AC_CHECK_HEADER([iostream])
AC_LANG_POP([C++])
</code></pre>
<p><strong>Bazel:</strong></p>
<pre><code class="language-python">checks.AC_CHECK_HEADER("iostream", define = "HAVE_IOSTREAM", language = "cpp")
</code></pre>
<hr />
<h3 id="pattern-16-dependencies-with-requires"><a class="header" href="#pattern-16-dependencies-with-requires">Pattern 16: Dependencies with <code>requires</code></a></h3>
<p>When a check depends on a previous check's result:</p>
<p><strong>M4:</strong></p>
<pre><code class="language-m4">AC_CHECK_HEADER([stdio.h])
AC_CHECK_FUNC([fopen], [], [], [[#include &lt;stdio.h&gt;]])
</code></pre>
<p><strong>Bazel:</strong></p>
<pre><code class="language-python">checks.AC_CHECK_HEADER("stdio.h", define = "HAVE_STDIO_H")
checks.AC_CHECK_FUNC(
    "fopen",
    define = "HAVE_FOPEN",
    requires = ["HAVE_STDIO_H"],  # Only check if stdio.h exists
)
</code></pre>
<p><strong>Value-based requirements:</strong></p>
<pre><code class="language-python">checks.AC_CHECK_FUNC(
    "fstat64",
    define = "HAVE_FSTAT64",
    requires = ["REPLACE_FSTAT=1"],  # Only if REPLACE_FSTAT equals "1"
)
</code></pre>
<hr />
<h3 id="pattern-17-compile-defines"><a class="header" href="#pattern-17-compile-defines">Pattern 17: Compile Defines</a></h3>
<p>When test code needs defines from previous checks:</p>
<pre><code class="language-python">checks.AC_TRY_COMPILE(
    code = """
#include &lt;sys/stat.h&gt;
int main(void) {
    struct stat s;
    return s.st_rdev;
}
""",
    define = "HAVE_ST_RDEV",
    compile_defines = ["_GNU_SOURCE", "_DARWIN_C_SOURCE"],
)
</code></pre>
<hr />
<h2 id="api-reference"><a class="header" href="#api-reference">API Reference</a></h2>
<h3 id="checks-struct--singular-macros"><a class="header" href="#checks-struct--singular-macros"><code>checks</code> Struct — Singular Macros</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Macro</th><th>Description</th></tr></thead><tbody>
<tr><td><code>AC_CHECK_HEADER(header, ...)</code></td><td>Check for a header file</td></tr>
<tr><td><code>AC_CHECK_FUNC(function, ...)</code></td><td>Check for a function</td></tr>
<tr><td><code>AC_CHECK_TYPE(type_name, ...)</code></td><td>Check for a type</td></tr>
<tr><td><code>AC_CHECK_DECL(symbol, ...)</code></td><td>Check for a declaration</td></tr>
<tr><td><code>AC_CHECK_MEMBER(aggregate.member, ...)</code></td><td>Check for a struct/union member</td></tr>
<tr><td><code>AC_CHECK_SIZEOF(type_name, ...)</code></td><td>Check size of a type</td></tr>
<tr><td><code>AC_CHECK_ALIGNOF(type_name, ...)</code></td><td>Check alignment of a type</td></tr>
<tr><td><code>AC_CHECK_LIB(library, function, ...)</code></td><td>Check for a function in a library</td></tr>
<tr><td><code>AC_TRY_COMPILE(code=..., ...)</code></td><td>Try to compile custom code</td></tr>
<tr><td><code>AC_TRY_LINK(code=..., ...)</code></td><td>Try to compile and link custom code</td></tr>
<tr><td><code>AC_DEFINE(define, value=1, ...)</code></td><td>Define a preprocessor macro</td></tr>
<tr><td><code>AC_DEFINE_UNQUOTED(define, ...)</code></td><td>Define with unquoted value</td></tr>
<tr><td><code>AC_SUBST(variable, value=1, ...)</code></td><td>Create a substitution variable</td></tr>
<tr><td><code>M4_VARIABLE(define, value=1, ...)</code></td><td>Track M4 shell variables</td></tr>
<tr><td><code>AC_PROG_CC()</code></td><td>Check for C compiler</td></tr>
<tr><td><code>AC_PROG_CXX()</code></td><td>Check for C++ compiler</td></tr>
<tr><td><code>AC_C_BIGENDIAN()</code></td><td>Check byte order</td></tr>
<tr><td><code>AC_C_INLINE()</code></td><td>Check for inline keyword</td></tr>
<tr><td><code>AC_C_RESTRICT()</code></td><td>Check for restrict keyword</td></tr>
<tr><td><code>AC_COMPUTE_INT(define, expression, ...)</code></td><td>Compute integer at compile time</td></tr>
<tr><td><code>AC_CHECK_C_COMPILER_FLAG(flag, ...)</code></td><td>Check C compiler flag</td></tr>
<tr><td><code>AC_CHECK_CXX_COMPILER_FLAG(flag, ...)</code></td><td>Check C++ compiler flag</td></tr>
</tbody></table>
</div>
<h3 id="macros-struct--plural-macros"><a class="header" href="#macros-struct--plural-macros"><code>macros</code> Struct — Plural Macros</a></h3>
<p>These return lists of checks with auto-generated define names:</p>
<div class="table-wrapper"><table><thead><tr><th>Macro</th><th>Description</th></tr></thead><tbody>
<tr><td><code>AC_CHECK_HEADERS(headers, ...)</code></td><td>Check multiple headers</td></tr>
<tr><td><code>AC_CHECK_FUNCS(functions, ...)</code></td><td>Check multiple functions</td></tr>
<tr><td><code>AC_CHECK_TYPES(types, ...)</code></td><td>Check multiple types</td></tr>
<tr><td><code>AC_CHECK_DECLS(symbols, ...)</code></td><td>Check multiple declarations</td></tr>
<tr><td><code>AC_CHECK_MEMBERS(members, ...)</code></td><td>Check multiple struct members</td></tr>
</tbody></table>
</div>
<h3 id="utils-struct--helper-functions"><a class="header" href="#utils-struct--helper-functions"><code>utils</code> Struct — Helper Functions</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Function</th><th>Description</th></tr></thead><tbody>
<tr><td><code>AC_LANG_PROGRAM(prologue, body)</code></td><td>Build program code from prologue and body</td></tr>
<tr><td><code>AC_INCLUDES_DEFAULT</code></td><td>Default includes (stdio.h, stdlib.h, etc.)</td></tr>
</tbody></table>
</div>
<h3 id="common-parameters"><a class="header" href="#common-parameters">Common Parameters</a></h3>
<p>Most macros support these parameters:</p>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>name</code></td><td>string</td><td>Cache variable name (auto-generated if omitted)</td></tr>
<tr><td><code>define</code></td><td>string/bool</td><td>Define name or <code>True</code> to use cache var name</td></tr>
<tr><td><code>includes</code></td><td>list</td><td>Include directives (e.g., <code>["#include &lt;stdio.h&gt;"]</code>)</td></tr>
<tr><td><code>language</code></td><td>string</td><td><code>"c"</code> or <code>"cpp"</code></td></tr>
<tr><td><code>requires</code></td><td>list</td><td>Dependencies that must be satisfied</td></tr>
<tr><td><code>compile_defines</code></td><td>list</td><td>Defines to add before compilation</td></tr>
<tr><td><code>condition</code></td><td>string</td><td>Condition for value selection</td></tr>
<tr><td><code>if_true</code></td><td>any</td><td>Value when condition is true</td></tr>
<tr><td><code>if_false</code></td><td>any</td><td>Value when condition is false</td></tr>
<tr><td><code>subst</code></td><td>bool/string</td><td>Also create substitution variable</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="platform-conditionals"><a class="header" href="#platform-conditionals">Platform Conditionals</a></h2>
<h3 id="prefer-actual-checks-over-selectac_define"><a class="header" href="#prefer-actual-checks-over-selectac_define">Prefer actual checks over select()+AC_DEFINE</a></h3>
<p><strong>Do not</strong> use <code>select()</code> to gate <code>AC_DEFINE</code> or <code>AC_SUBST</code> for feature macros (e.g. <code>HAVE_FOO</code>) when the M4 performs a real check. Use the actual check so the result reflects the toolchain/platform.</p>
<p>When M4 uses a check macro such as:</p>
<ul>
<li><code>gl_CHECK_FUNCS_ANDROID([func], [[#include &lt;header.h&gt;]])</code></li>
<li><code>AC_CHECK_FUNC([func])</code></li>
<li><code>AC_CHECK_HEADER([header.h])</code></li>
</ul>
<p><strong>Prefer:</strong></p>
<ol>
<li><strong>Bazel equivalent check</strong> — e.g. <code>gl_macros.GL_CHECK_FUNCS_ANDROID(["func"], includes = ["#include &lt;header.h&gt;"])</code> or <code>checks.AC_CHECK_FUNC("func", define = "HAVE_FUNC", subst = "HAVE_FUNC")</code>.</li>
<li><strong>Depend on the gnulib module</strong> that already implements the check — e.g. <code>deps = ["//gnulib/m4/timespec_getres:gl_FUNC_TIMESPEC_GETRES"]</code> instead of defining <code>HAVE_TIMESPEC_GETRES</code> via <code>select()</code>.</li>
</ol>
<p><strong>Avoid:</strong></p>
<ul>
<li><code>select({ "@platforms//os:linux": [checks.AC_DEFINE("HAVE_FOO", "1")], "//conditions:default": [] })</code> to hardcode a feature per platform.</li>
<li>Duplicating the same check in multiple targets; depend on the canonical module that performs it.</li>
</ul>
<p>This keeps config consistent with the actual build environment and avoids duplicate definitions when targets are aggregated (e.g. <code>//gnulib/tests/duplicates:gnulib</code>).</p>
<h3 id="using-select-for-platform-specific-checks"><a class="header" href="#using-select-for-platform-specific-checks">Using <code>select()</code> for Platform-Specific Checks</a></h3>
<p><strong>M4:</strong></p>
<pre><code class="language-m4">AC_REQUIRE([AC_CANONICAL_HOST])
case "$host_os" in
  mingw* | windows*)
    REPLACE_ACCESS=1
    ;;
  darwin*)
    REPLACE_FSTAT=1
    ;;
  *)
    ;;
esac
</code></pre>
<p><strong>Bazel:</strong></p>
<pre><code class="language-python">autoconf(
    name = "fstat",
    checks = select({
        "@platforms//os:windows": [
            checks.AC_SUBST("REPLACE_FSTAT", "1"),
        ],
        "@platforms//os:macos": [
            checks.AC_SUBST("REPLACE_FSTAT", "1"),
        ],
        "//conditions:default": [],
    }),
    visibility = ["//visibility:public"],
)
</code></pre>
<h3 id="common-platform-constraints"><a class="header" href="#common-platform-constraints">Common Platform Constraints</a></h3>
<div class="table-wrapper"><table><thead><tr><th>M4 Pattern</th><th>Bazel Constraint</th></tr></thead><tbody>
<tr><td><code>mingw*</code>, <code>windows*</code></td><td><code>@platforms//os:windows</code></td></tr>
<tr><td><code>darwin*</code></td><td><code>@platforms//os:macos</code></td></tr>
<tr><td><code>linux*</code></td><td><code>@platforms//os:linux</code></td></tr>
<tr><td><code>freebsd*</code></td><td><code>@platforms//os:freebsd</code></td></tr>
<tr><td><code>openbsd*</code></td><td><code>@platforms//os:openbsd</code></td></tr>
<tr><td>Default (<code>*</code>)</td><td><code>"//conditions:default"</code></td></tr>
</tbody></table>
</div>
<h3 id="combining-platform-specific-and-common-checks"><a class="header" href="#combining-platform-specific-and-common-checks">Combining Platform-Specific and Common Checks</a></h3>
<pre><code class="language-python">autoconf(
    name = "lstat",
    checks = [
        # Common checks for all platforms
        checks.AC_CHECK_FUNC("lstat", define = "HAVE_LSTAT"),
    ] + select({
        "@platforms//os:macos": [
            checks.AC_SUBST("REPLACE_LSTAT", "1"),
        ],
        "//conditions:default": [
            checks.AC_SUBST("REPLACE_LSTAT", "0"),
        ],
    }),
    visibility = ["//visibility:public"],
)
</code></pre>
<hr />
<h2 id="dependencies-and-reusable-modules"><a class="header" href="#dependencies-and-reusable-modules">Dependencies and Reusable Modules</a></h2>
<h3 id="using-pre-built-gnulibm4-targets"><a class="header" href="#using-pre-built-gnulibm4-targets">Using Pre-built <code>//gnulib/m4</code> Targets</a></h3>
<p>Many common checks are already implemented in <code>@rules_cc_autoconf//gnulib/m4/</code>. Use these to avoid duplication:</p>
<p><strong>Before (manual checks):</strong></p>
<pre><code class="language-python">autoconf(
    name = "autoconf",
    checks = [
        checks.AC_CHECK_FUNC("lstat", define = "HAVE_LSTAT"),
        checks.AC_CHECK_HEADER("sys/stat.h", define = "HAVE_SYS_STAT_H"),
    ],
)
</code></pre>
<p><strong>After (using gnulib modules):</strong></p>
<pre><code class="language-python">autoconf(
    name = "autoconf",
    checks = [
        # Only add checks not provided by gnulib modules
    ],
    deps = [
        "//gnulib/m4/lstat",      # Provides lstat checks
        "//gnulib/m4/sys_stat_h", # Provides sys/stat.h checks
    ],
)
</code></pre>
<h3 id="common-patterns-for-gnulib-target-names"><a class="header" href="#common-patterns-for-gnulib-target-names">Common Patterns for gnulib Target Names</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Check Type</th><th>Target Pattern</th><th>Example</th></tr></thead><tbody>
<tr><td>Function</td><td><code>//gnulib/m4/&lt;func&gt;</code></td><td><code>//gnulib/m4/lstat</code></td></tr>
<tr><td>Header</td><td><code>//gnulib/m4/&lt;header&gt;_h</code></td><td><code>//gnulib/m4/sys_stat_h</code></td></tr>
<tr><td>Type</td><td><code>//gnulib/m4/&lt;type&gt;</code></td><td><code>//gnulib/m4/off_t</code></td></tr>
</tbody></table>
</div>
<h3 id="declaring-dependencies-between-modules"><a class="header" href="#declaring-dependencies-between-modules">Declaring Dependencies Between Modules</a></h3>
<p>When creating reusable modules, use <code>deps</code> to express <code>AC_REQUIRE</code> relationships:</p>
<pre><code class="language-python"># gl_FUNC_LSTAT from lstat.m4
autoconf(
    name = "lstat",
    checks = [
        checks.AC_CHECK_FUNC("lstat", define = "HAVE_LSTAT"),
    ],
    deps = [
        ":gl_FUNC_LSTAT_FOLLOWS_SLASHED_SYMLINK",  # AC_REQUIRE
        "//autoconf/macros/AC_CANONICAL_HOST",
    ],
)
</code></pre>
<hr />
<h2 id="porting-strategy"><a class="header" href="#porting-strategy">Porting Strategy</a></h2>
<p>When porting a gnulib M4 module to Bazel, follow this systematic approach:</p>
<h3 id="step-1-fetch-and-analyze-the-original-m4-file"><a class="header" href="#step-1-fetch-and-analyze-the-original-m4-file">Step 1: Fetch and Analyze the Original M4 File</a></h3>
<p>First, read the original M4 file to understand its structure. The M4 file typically contains multiple <code>AC_DEFUN</code> macro definitions.</p>
<pre><code class="language-m4"># Example: c32rtomb.m4
AC_DEFUN([gl_FUNC_C32RTOMB],           # Line 10 - Main function
[
  AC_REQUIRE([gl_UCHAR_H_DEFAULTS])    # Dependency (ignore _DEFAULTS)
  AC_REQUIRE([AC_CANONICAL_HOST])       # Dependency
  AC_REQUIRE([gl_MBRTOC32_SANITYCHECK]) # Dependency
  AC_REQUIRE([gl_C32RTOMB_SANITYCHECK]) # Dependency
  AC_REQUIRE([gl_CHECK_FUNC_C32RTOMB])  # Dependency
  ...
])

AC_DEFUN([gl_CHECK_FUNC_C32RTOMB],     # Line 59 - Helper function
[
  ...
])

AC_DEFUN([gl_C32RTOMB_SANITYCHECK],    # Line 94 - Sanity check
[
  AC_REQUIRE([gl_TYPE_CHAR32_T])
  AC_REQUIRE([gl_CHECK_FUNC_C32RTOMB])
  ...
])
</code></pre>
<h3 id="step-2-build-the-dependency-graph"><a class="header" href="#step-2-build-the-dependency-graph">Step 2: Build the Dependency Graph</a></h3>
<p><strong>Critical:</strong> Extract all <code>AC_REQUIRE</code> statements to build the dependency graph, with one important exception:</p>
<blockquote>
<p><strong>Ignore <code>_DEFAULTS</code> functions.</strong> Functions like <code>gl_UCHAR_H_DEFAULTS</code>, <code>gl_WCHAR_H_DEFAULTS</code>, etc. set initial shell variable values that get overridden by the actual check functions. In Bazel, these defaults cause duplicate check errors if both the defaults and the actual check try to set the same variable.</p>
</blockquote>
<p><strong>Dependency extraction example:</strong></p>
<pre><code>gl_FUNC_C32RTOMB requires:
  - gl_UCHAR_H_DEFAULTS    ← IGNORE (ends in _DEFAULTS)
  - AC_CANONICAL_HOST      ← Include
  - gl_MBRTOC32_SANITYCHECK ← Include (from different module)
  - gl_C32RTOMB_SANITYCHECK ← Include (local target)
  - gl_CHECK_FUNC_C32RTOMB  ← Include (local target)

gl_C32RTOMB_SANITYCHECK requires:
  - gl_TYPE_CHAR32_T        ← Include (provided by uchar_h)
  - gl_CHECK_FUNC_C32RTOMB  ← Include (local target)
</code></pre>
<h3 id="step-3-create-bazel-targets-in-m4-order"><a class="header" href="#step-3-create-bazel-targets-in-m4-order">Step 3: Create Bazel Targets in M4 Order</a></h3>
<p>Create one <code>autoconf</code> target for each <code>AC_DEFUN</code>, <strong>in the same order as they appear in the M4 file</strong>. This makes it easier to compare the Bazel code with the original M4.</p>
<p><strong>Important convention:</strong> The target matching the package name (e.g., <code>c32rtomb</code> in the <code>c32rtomb</code> package) should:</p>
<ul>
<li>Have <strong>no checks</strong> (<code>checks = []</code> or omitted)</li>
<li>Have <strong>deps on all other targets</strong> in the same package</li>
<li><strong>Exclude <code>*_DEFAULTS</code> targets</strong> from deps</li>
</ul>
<p>This pattern separates the "what this module provides" (the package-named aggregator target) from "how it works" (the individual AC_DEFUN targets with checks).</p>
<pre><code class="language-python">"""https://github.com/coreutils/gnulib/blob/.../m4/c32rtomb.m4"""

load("//autoconf:autoconf.bzl", "autoconf")
load("//autoconf:checks.bzl", "checks")

# gl_FUNC_C32RTOMB - lines 10-56 (FIRST AC_DEFUN in M4)
autoconf(
    name = "gl_FUNC_C32RTOMB",
    checks = [
        checks.AC_SUBST("HAVE_C32RTOMB", condition = "gl_cv_func_c32rtomb", ...),
        checks.AC_SUBST("REPLACE_C32RTOMB", ...),
    ],
    deps = [
        "//autoconf/macros/AC_CANONICAL_HOST",
        "//gnulib/m4/mbrtoc32:gl_MBRTOC32_SANITYCHECK",
        ":gl_C32RTOMB_SANITYCHECK",
        ":gl_CHECK_FUNC_C32RTOMB",
    ],
)

# gl_CHECK_FUNC_C32RTOMB - lines 59-92 (SECOND AC_DEFUN)
autoconf(
    name = "gl_CHECK_FUNC_C32RTOMB",
    checks = [
        checks.AC_CHECK_DECL("c32rtomb", ...),
        checks.AC_TRY_LINK(name = "gl_cv_func_c32rtomb", ...),
    ],
)

# gl_C32RTOMB_SANITYCHECK - lines 94-171 (THIRD AC_DEFUN)
autoconf(
    name = "gl_C32RTOMB_SANITYCHECK",
    checks = [
        checks.AC_DEFINE("HAVE_WORKING_C32RTOMB", ...),
        checks.AC_SUBST("HAVE_WORKING_C32RTOMB", ...),
    ],
    deps = [
        "//gnulib/m4/uchar_h",
        ":gl_CHECK_FUNC_C32RTOMB",
    ],
)

# Package-level aggregator target (matches package name)
# No checks - just deps on all other targets (excluding *_DEFAULTS)
autoconf(
    name = "c32rtomb",
    visibility = ["//visibility:public"],
    deps = [
        ":gl_FUNC_C32RTOMB",
        ":gl_CHECK_FUNC_C32RTOMB",
        ":gl_C32RTOMB_SANITYCHECK",
    ],
)
</code></pre>
<h3 id="step-4-handle-shared-checks-without-ac_require"><a class="header" href="#step-4-handle-shared-checks-without-ac_require">Step 4: Handle Shared Checks Without AC_REQUIRE</a></h3>
<p>Multiple M4 files often perform the same check (e.g., <code>AC_CHECK_HEADERS_ONCE([utmp.h])</code>) without having an <code>AC_REQUIRE</code> relationship between them. In Bazel, this would cause duplicate check errors.</p>
<p><strong>Solution:</strong> Create an isolated <code>autoconf</code> target that contains <em>only</em> the conflicting check, then add it as a dependency to both consumers. Do <em>not</em> remove modules from the duplicates test as a workaround.</p>
<p><strong>Example: utmp.h header check</strong></p>
<p>The <code>utmp_h</code> module checks for <code>utmp.h</code>:</p>
<pre><code class="language-m4"># utmp_h.m4
AC_DEFUN([gl_UTMP_H], [
  AC_CHECK_HEADERS([utmp.h])
  ...
])
</code></pre>
<p>The <code>readutmp</code> module also checks for <code>utmp.h</code>:</p>
<pre><code class="language-m4"># readutmp.m4
AC_DEFUN([gl_READUTMP], [
  AC_CHECK_HEADERS_ONCE([utmp.h utmpx.h])  # Same check, no AC_REQUIRE!
  ...
])
</code></pre>
<p>There's no <code>AC_REQUIRE([gl_UTMP_H])</code> in <code>readutmp</code>, but both need the same header check. Create a separate target for just the header check:</p>
<pre><code class="language-python"># gnulib/m4/utmp_h/BUILD.bazel

# Isolated header check - can be shared by multiple modules
autoconf(
    name = "HAVE_UTMP_H",
    checks = [
        checks.AC_CHECK_HEADER("utmp.h", define = "HAVE_UTMP_H"),
    ],
    visibility = ["//visibility:public"],
)

# Main utmp_h module
autoconf(
    name = "utmp_h",
    checks = [
        # Other checks specific to utmp_h...
    ],
    deps = [
        ":HAVE_UTMP_H",  # Use the shared check
    ],
)
</code></pre>
<pre><code class="language-python"># gnulib/m4/readutmp/BUILD.bazel

autoconf(
    name = "readutmp",
    checks = [
        # Other checks specific to readutmp...
    ],
    deps = [
        "//gnulib/m4/utmp_h:HAVE_UTMP_H",  # Use the same shared check
    ],
)
</code></pre>
<p><strong>Key principle:</strong> Keep the isolated check target in the most semantically relevant package (e.g., the header check for <code>utmp.h</code> lives in the <code>utmp_h</code> package), and have other modules depend on it.</p>
<h3 id="step-5-verify-and-fix-transitive-dependencies"><a class="header" href="#step-5-verify-and-fix-transitive-dependencies">Step 5: Verify and Fix Transitive Dependencies</a></h3>
<p>The rules provide <strong>built-in duplication detection</strong>. When you build, you'll get clear error messages if a cache variable is defined in multiple places.</p>
<p>After building, you may find that transitive dependencies are incorrect. Common issues:</p>
<ol>
<li>
<p><strong>Duplicate check errors:</strong> A variable is defined both locally and in a dependency</p>
<ul>
<li>The build will fail with an error like: <code>Cache variable 'X' is defined both locally and in dependencies</code></li>
<li>Solution: Remove the local definition and let the dependency provide it</li>
<li>Or: Create a shared target (see Step 4 above)</li>
</ul>
</li>
<li>
<p><strong>Missing values:</strong> Expected substitution variables are not being set</p>
<ul>
<li>Solution: Add the missing dependency or add the check locally</li>
</ul>
</li>
<li>
<p><strong>Unexpected values:</strong> A transitive dependency is providing values you don't want</p>
<ul>
<li>Solution: Remove the unnecessary dependency or restructure the dependency chain</li>
</ul>
</li>
</ol>
<h3 id="step-6-understand-global-defaults-vs-check-results"><a class="header" href="#step-6-understand-global-defaults-vs-check-results">Step 6: Understand Global Defaults vs Check Results</a></h3>
<p><strong>Important architectural difference:</strong> Bazel uses a shared dependency graph with global defaults, while autoconf runs each <code>configure.ac</code> independently.</p>
<p>In autoconf:</p>
<ul>
<li><code>gl_UCHAR_H_DEFAULTS</code> sets <code>HAVE_C32RTOMB=1</code> as a shell variable</li>
<li>If <code>gl_FUNC_C32RTOMB</code> is later called, it may override this to <code>0</code></li>
<li>Different <code>configure.ac</code> files may or may not call <code>gl_FUNC_C32RTOMB</code></li>
</ul>
<p>In Bazel:</p>
<ul>
<li>Global defaults (like <code>HAVE_C32RTOMB="1"</code> in <code>uchar_h</code>) are shared across all modules</li>
<li>There's only ONE value for each variable in the dependency graph</li>
<li>Changing a default to make one module's test pass may break other modules</li>
</ul>
<p><strong>Key principle:</strong> Existing defaults should NOT be changed to make a new module pass. Defaults are fine as long as nothing in the dependency graph explicitly depends on those targets with conflicting values.</p>
<p><strong>Subst test disagreements:</strong> Because of this architectural difference, subst tests may sometimes disagree between Bazel and autoconf+configure. This happens when:</p>
<ul>
<li>Autoconf runs a specific check (e.g., <code>gl_FUNC_C32RTOMB</code> → <code>HAVE_C32RTOMB=0</code> on macOS)</li>
<li>Bazel uses the global default (e.g., <code>uchar_h</code> → <code>HAVE_C32RTOMB=1</code>)</li>
</ul>
<p>These cases should be evaluated on a case-by-case basis:</p>
<ul>
<li>If the golden file was generated from an autoconf run that included specific checks not in the Bazel dependency graph, the golden may need updating</li>
<li>If the Bazel dependency graph should include those checks, add the appropriate dependency</li>
<li>Sometimes the disagreement is acceptable - document it and move on</li>
</ul>
<h3 id="step-7-run-tests-and-iterate"><a class="header" href="#step-7-run-tests-and-iterate">Step 7: Run Tests and Iterate</a></h3>
<pre><code class="language-bash"># Build the module
bazel build //gnulib/m4/c32rtomb:c32rtomb

# Run compatibility tests
bazel test //gnulib/tests/compatibility/c32rtomb:all
</code></pre>
<p>Compare test output against golden files and fix any discrepancies.</p>
<h3 id="step-8-test-on-linux-if-needed"><a class="header" href="#step-8-test-on-linux-if-needed">Step 8: Test on Linux (if needed)</a></h3>
<p>When porting modules that have platform-specific behavior, you may need to test on Linux to verify correctness. The repository provides several scripts for running tests in Linux Docker containers:</p>
<h4 id="available-linux-test-scripts"><a class="header" href="#available-linux-test-scripts">Available Linux Test Scripts</a></h4>
<p><strong>1. <code>test_linux_docker.sh</code></strong> — Comprehensive testing on multiple Linux distributions</p>
<ul>
<li>Tests on Ubuntu 22.04 and Rocky Linux 9</li>
<li>Usage: <code>./test_linux_docker.sh [--ubuntu-only | --rocky-only]</code></li>
<li>Runs full test suite: <code>bazel test //autoconf/... //gnulib/...</code></li>
<li>Saves results to <code>docker_test_results/</code> directory</li>
<li>Generates summary files with test statistics</li>
</ul>
<p><strong>2. <code>test_modules.sh</code></strong> — Test specific modules</p>
<ul>
<li>Usage: <code>./test_modules.sh [--docker] module1 module2 ...</code></li>
<li>Without <code>--docker</code>: runs tests locally (macOS)</li>
<li>With <code>--docker</code>: runs tests in Docker (Linux)</li>
<li>Example: <code>./test_modules.sh --docker fsusage renameat</code></li>
</ul>
<p><strong>3. <code>docker_bazel.sh</code></strong> — Generic Bazel command runner</p>
<ul>
<li>Usage: <code>./docker_bazel.sh [--amd64] &lt;bazel_command&gt;</code></li>
<li>Builds/reuses Docker image and runs any Bazel command</li>
<li>Supports <code>--amd64</code> flag for x86_64 emulation</li>
<li>Example: <code>./docker_bazel.sh "test //gnulib/tests/compatibility/c32rtomb:all --test_output=errors"</code></li>
</ul>
<p><strong>4. <code>update_linux_golden.sh</code></strong> — Update Linux golden files</p>
<ul>
<li>Usage: <code>./update_linux_golden.sh module1 module2 ...</code></li>
<li>Builds targets in Docker, extracts <code>config.h</code> and <code>subst.h</code> outputs</li>
<li>Updates <code>golden_config_linux.h.in</code> and <code>golden_subst_linux.h.in</code> files</li>
<li>Use when Linux-specific golden files need updating</li>
</ul>
<p><strong>5. <code>scripts/run_linux_tests.sh</code></strong> — Run tests and update golden files</p>
<ul>
<li>Builds Docker image from <code>Dockerfile</code></li>
<li>Runs tests and executes <code>update.py</code> to extract results</li>
<li>Mounts <code>gnulib</code> directory so updates write directly to host</li>
</ul>
<h4 id="when-to-use-linux-testing"><a class="header" href="#when-to-use-linux-testing">When to Use Linux Testing</a></h4>
<ul>
<li><strong>Platform-specific checks</strong>: Modules with <code>select()</code> statements for Linux-specific behavior</li>
<li><strong>Golden file updates</strong>: When Linux golden files (<code>golden_config_linux.h.in</code>, <code>golden_subst_linux.h.in</code>) need updating</li>
<li><strong>Cross-platform verification</strong>: Verify that platform conditionals work correctly</li>
<li><strong>Test failures</strong>: Debug Linux-specific test failures</li>
</ul>
<h4 id="example-workflow"><a class="header" href="#example-workflow">Example Workflow</a></h4>
<pre><code class="language-bash"># Test a specific module on Linux
./test_modules.sh --docker c32rtomb

# Update Linux golden files after making changes
./update_linux_golden.sh c32rtomb

# Run full test suite on Linux
./test_linux_docker.sh --ubuntu-only
</code></pre>
<hr />
<h2 id="best-practices"><a class="header" href="#best-practices">Best Practices</a></h2>
<h3 id="1-always-read-the-original-m4-file"><a class="header" href="#1-always-read-the-original-m4-file">1. Always Read the Original M4 File</a></h3>
<p>Before migrating, understand what the M4 macro actually does:</p>
<ul>
<li>What checks does it perform?</li>
<li>What defines/subst values does it create?</li>
<li>What are its dependencies (<code>AC_REQUIRE</code>)?</li>
<li>Are there platform-specific conditionals?</li>
</ul>
<h3 id="2-use-cache-variable-names-consistently"><a class="header" href="#2-use-cache-variable-names-consistently">2. Use Cache Variable Names Consistently</a></h3>
<p>Follow autoconf naming conventions:</p>
<ul>
<li>Headers: <code>ac_cv_header_&lt;header&gt;</code></li>
<li>Functions: <code>ac_cv_func_&lt;function&gt;</code></li>
<li>Declarations: <code>ac_cv_have_decl_&lt;symbol&gt;</code></li>
<li>Types: <code>ac_cv_type_&lt;type&gt;</code></li>
</ul>
<h3 id="3-prefer-gnulibm4-targets"><a class="header" href="#3-prefer-gnulibm4-targets">3. Prefer <code>//gnulib/m4</code> Targets</a></h3>
<p>Check if a gnulib module already exists before writing manual checks. This:</p>
<ul>
<li>Avoids duplicate check errors</li>
<li>Ensures consistent behavior</li>
<li>Handles platform-specific logic</li>
</ul>
<h3 id="4-use-meaningful-comments"><a class="header" href="#4-use-meaningful-comments">4. Use Meaningful Comments</a></h3>
<p>Reference the original M4 file and line numbers:</p>
<pre><code class="language-python">"""https://github.com/coreutils/gnulib/blob/635dbdcf501d52d2e42daf6b44261af9ce2dfe38/m4/lstat.m4"""

autoconf(
    name = "lstat",
    checks = [
        # AC_CHECK_FUNCS_ONCE([lstat]) - line 17
        checks.AC_CHECK_FUNC("lstat", define = "HAVE_LSTAT"),
    ],
    deps = [
        # AC_REQUIRE([gl_FUNC_LSTAT_FOLLOWS_SLASHED_SYMLINK]) - line 19
        ":gl_FUNC_LSTAT_FOLLOWS_SLASHED_SYMLINK",
    ],
)
</code></pre>
<h3 id="5-test-your-migration"><a class="header" href="#5-test-your-migration">5. Test Your Migration</a></h3>
<p>Run diff tests against golden files to verify your migration produces correct output:</p>
<pre><code class="language-python">diff_test(
    name = "config_diff_test",
    file1 = "golden_config.h.in",
    file2 = ":config.h",
)
</code></pre>
<h3 id="6-only-split-golden-files-when-necessary"><a class="header" href="#6-only-split-golden-files-when-necessary">6. Only Split Golden Files When Necessary</a></h3>
<p>Golden files should only be split into platform-specific versions (<code>golden_config_linux.h.in</code>, <code>golden_config_macos.h.in</code>) when there are <strong>genuine differences</strong> in the expected output between platforms.</p>
<p><strong>Use a single golden file when:</strong></p>
<ul>
<li>The output is identical across all platforms</li>
<li>Any platform differences are handled in the Bazel targets (not the expected output)</li>
</ul>
<pre><code class="language-python"># GOOD: Single golden file when content is the same
gnu_gnulib_diff_test_suite(
    name = "sig_atomic_t_test",
    golden_config_h = "golden_config.h.in",
    golden_subst_h = "golden_subst.h.in",
    ...
)
</code></pre>
<p><strong>Split golden files only when:</strong></p>
<ul>
<li>The <code>gnu_autoconf</code> test produces genuinely different outputs on different platforms</li>
<li>Platform-specific defines have different values (e.g., <code>REPLACE_FSTAT</code> is <code>1</code> on macOS, <code>0</code> on Linux)</li>
</ul>
<pre><code class="language-python"># ONLY when content genuinely differs between platforms
gnu_gnulib_diff_test_suite(
    name = "fstat_test",
    golden_config_h = {
        "linux": "golden_config_linux.h.in",
        "macos": "golden_config_macos.h.in",
    },
    ...
)
</code></pre>
<p><strong>Anti-pattern:</strong> Don't split golden files just because you're unsure — first verify the content differs by running <code>gnu_autoconf</code> tests on both platforms.</p>
<hr />
<h2 id="cross-compilation-considerations"><a class="header" href="#cross-compilation-considerations">Cross-Compilation Considerations</a></h2>
<h3 id="design-philosophy-avoiding-runtime-checks"><a class="header" href="#design-philosophy-avoiding-runtime-checks">Design Philosophy: Avoiding Runtime Checks</a></h3>
<p>Bazel intentionally avoids runtime checks to ensure:</p>
<ol>
<li><strong>Consistent behavior</strong> across builds</li>
<li><strong>Cross-compilation support</strong> without target system access</li>
<li><strong>Hermetic builds</strong> that don't depend on the build machine's locale, environment, etc.</li>
</ol>
<p>When M4 macros use <code>AC_TRY_EVAL</code> or <code>AC_RUN_IFELSE</code> (running compiled code at configure time), these should be replaced with <code>select()</code> statements that provide platform-specific defaults.</p>
<h3 id="runtime-vs-compile-time-checks"><a class="header" href="#runtime-vs-compile-time-checks">Runtime vs Compile-Time Checks</a></h3>
<p>Some macros require running compiled code, which doesn't work when cross-compiling:</p>
<p><strong>NOT cross-compile safe (use <code>select()</code> instead):</strong></p>
<ul>
<li><code>AC_CHECK_SIZEOF</code> — Computes <code>sizeof()</code> by running code</li>
<li><code>AC_CHECK_ALIGNOF</code> — Computes alignment by running code</li>
<li><code>AC_COMPUTE_INT</code> — Evaluates expressions by running code</li>
<li><code>AC_C_BIGENDIAN</code> — Detects endianness at runtime</li>
<li><code>AC_TRY_EVAL</code> / <code>AC_RUN_IFELSE</code> — Runs compiled test programs</li>
<li>Locale detection macros (e.g., <code>gt_LOCALE_FR</code>) — Tests locale availability at runtime</li>
</ul>
<p><strong>Cross-compile safe:</strong></p>
<ul>
<li><code>AC_CHECK_HEADER</code> — Compile-only</li>
<li><code>AC_CHECK_FUNC</code> — Link check</li>
<li><code>AC_CHECK_DECL</code> — Compile-only</li>
<li><code>AC_CHECK_TYPE</code> — Compile-only</li>
<li><code>AC_TRY_COMPILE</code> — Compile-only</li>
<li><code>AC_TRY_LINK</code> — Link check</li>
<li><code>AC_DEFINE</code> — No check, just defines</li>
</ul>
<h3 id="strategies-for-cross-compilation"><a class="header" href="#strategies-for-cross-compilation">Strategies for Cross-Compilation</a></h3>
<ol>
<li><strong>Use <code>select()</code> for runtime checks (preferred):</strong></li>
</ol>
<p>When M4 uses runtime checks to detect platform-specific behavior, replace with <code>select()</code>:</p>
<p><strong>M4 (uses runtime locale detection):</strong></p>
<pre><code class="language-m4">AC_DEFUN([gt_LOCALE_FR], [
  # Complex runtime locale testing with AC_TRY_EVAL
  # Tests various locale names by actually running setlocale()
  case "$host_os" in
    mingw* | windows*) gt_cv_locale_fr=French_France.1252 ;;
    *) gt_cv_locale_fr=fr_FR.ISO8859-1 ;;
  esac
  AC_SUBST([LOCALE_FR])
])
</code></pre>
<p><strong>Bazel (uses select() for platform-specific defaults):</strong></p>
<pre><code class="language-python">autoconf(
    name = "gt_LOCALE_FR",
    checks = select({
        "@platforms//os:windows": [
            checks.AC_SUBST("LOCALE_FR", "French_France.1252"),
        ],
        "//conditions:default": [
            checks.AC_SUBST("LOCALE_FR", "fr_FR.ISO8859-1"),
        ],
    }),
)
</code></pre>
<ol start="2">
<li><strong>Use compile-time detection for feature checks:</strong></li>
</ol>
<pre><code class="language-python">checks.AC_TRY_COMPILE(
    code = """
#if defined(__APPLE__) &amp;&amp; defined(__MACH__)
  #error "macOS detected"
#endif
int main(void) { return 0; }
""",
    define = "_IS_MACOS",
)
</code></pre>
<ol start="3">
<li><strong>Use platform selects for known values:</strong></li>
</ol>
<pre><code class="language-python">autoconf(
    name = "endian",
    checks = select({
        "@platforms//cpu:x86_64": [
            checks.AC_DEFINE("WORDS_BIGENDIAN", "0"),
        ],
        "@platforms//cpu:arm64": [
            checks.AC_DEFINE("WORDS_BIGENDIAN", "0"),  # ARM64 is little-endian
        ],
        "//conditions:default": [],
    }),
)
</code></pre>
<hr />
<h2 id="complete-examples"><a class="header" href="#complete-examples">Complete Examples</a></h2>
<h3 id="example-1-simple-module-posix_memalign"><a class="header" href="#example-1-simple-module-posix_memalign">Example 1: Simple Module (posix_memalign)</a></h3>
<p><strong>Original M4:</strong> <code>gnulib/m4/posix_memalign.m4</code></p>
<p><strong>Bazel:</strong></p>
<pre><code class="language-python">"""https://github.com/coreutils/gnulib/blob/635dbdcf501d52d2e42daf6b44261af9ce2dfe38/m4/posix_memalign.m4"""

load("//autoconf:autoconf.bzl", "autoconf")
load("//autoconf:checks.bzl", "checks")

autoconf(
    name = "posix_memalign",
    checks = [
        checks.AC_CHECK_FUNC("posix_memalign", define = "HAVE_POSIX_MEMALIGN"),
        checks.AC_SUBST("REPLACE_POSIX_MEMALIGN", "1"),
    ],
    visibility = ["//visibility:public"],
    deps = [
        "//autoconf/macros/AC_CANONICAL_HOST",
        "//gnulib/m4/extensions",
        "//autoconf/macros/AC_CHECK_INCLUDES_DEFAULT",
    ],
)
</code></pre>
<h3 id="example-2-platform-specific-module-fstat"><a class="header" href="#example-2-platform-specific-module-fstat">Example 2: Platform-Specific Module (fstat)</a></h3>
<p><strong>Original M4:</strong> <code>gnulib/m4/fstat.m4</code></p>
<p><strong>Bazel:</strong></p>
<pre><code class="language-python">"""https://github.com/coreutils/gnulib/blob/635dbdcf501d52d2e42daf6b44261af9ce2dfe38/m4/fstat.m4"""

load("//autoconf:autoconf.bzl", "autoconf")
load("//autoconf:checks.bzl", "checks")

autoconf(
    name = "fstat",
    checks = select({
        "@platforms//os:macos": [
            # macOS: stat can return negative tv_nsec
            checks.AC_SUBST("REPLACE_FSTAT", "1"),
        ],
        "@platforms//os:windows": [
            # Windows: stat returns timezone-affected timestamps
            checks.M4_VARIABLE("REPLACE_FSTAT", "1"),
        ],
        "//conditions:default": [],
    }),
    visibility = ["//visibility:public"],
    deps = [
        "//gnulib/m4/sys_stat_h",
        "//gnulib/m4/sys_types_h",
    ],
)
</code></pre>
<h3 id="example-3-conditional-checks-strerror"><a class="header" href="#example-3-conditional-checks-strerror">Example 3: Conditional Checks (strerror)</a></h3>
<p><strong>Original M4:</strong> <code>gnulib/m4/strerror.m4</code></p>
<p><strong>Bazel:</strong></p>
<pre><code class="language-python">"""https://github.com/coreutils/gnulib/blob/635dbdcf501d52d2e42daf6b44261af9ce2dfe38/m4/strerror.m4"""

load("//autoconf:autoconf.bzl", "autoconf")
load("//autoconf:checks.bzl", "checks", "utils")

autoconf(
    name = "gl_FUNC_STRERROR_0",
    checks = [
        # Compile-time platform detection for strerror(0) behavior
        checks.AC_TRY_COMPILE(
            name = "_gl_cv_func_strerror_0_works",
            code = utils.AC_LANG_PROGRAM(
                [
                    "#if defined(__APPLE__) &amp;&amp; defined(__MACH__)",
                    "  #error \"macOS strerror needs replacement\"",
                    "#endif",
                ],
                "",
            ),
        ),
        # Set REPLACE_STRERROR_0 if check fails
        checks.AC_DEFINE(
            "REPLACE_STRERROR_0",
            condition = "_gl_cv_func_strerror_0_works",
            if_false = 1,
        ),
    ] + select({
        "@platforms//os:macos": [
            checks.AC_SUBST("REPLACE_STRERROR_0", "1"),
        ],
        "//conditions:default": [
            checks.AC_SUBST("REPLACE_STRERROR_0", "0"),
        ],
    }),
    visibility = ["//visibility:public"],
    deps = [
        "//autoconf/macros/AC_CANONICAL_HOST",
        "//gnulib/m4/errno_h",
        "//gnulib/m4/extensions",
    ],
)
</code></pre>
<h3 id="example-4-link-test-with-ac_lang_program"><a class="header" href="#example-4-link-test-with-ac_lang_program">Example 4: Link Test with AC_LANG_PROGRAM</a></h3>
<pre><code class="language-python">load("//autoconf:checks.bzl", "checks", "utils")

autoconf(
    name = "autoconf",
    checks = [
        checks.AC_TRY_LINK(
            code = utils.AC_LANG_PROGRAM(
                [
                    "/* Prologue: includes and declarations */",
                    "#include &lt;langinfo.h&gt;",
                ],
                "/* Body: code inside main() */\n"
                "char* cs = nl_langinfo(CODESET);\n"
                "return !cs;",
            ),
            define = "HAVE_LANGINFO_CODESET",
        ),
    ],
)
</code></pre>
<hr />
<h2 id="migration-checklist"><a class="header" href="#migration-checklist">Migration Checklist</a></h2>
<p>When migrating an M4 file, follow this checklist:</p>
<ul>
<li><input disabled="" type="checkbox"/>
Read and understand the original M4 file</li>
<li><input disabled="" type="checkbox"/>
Check for existing <code>//gnulib/m4</code> targets that provide needed checks</li>
<li><input disabled="" type="checkbox"/>
Identify all <code>AC_REQUIRE</code> dependencies</li>
<li><input disabled="" type="checkbox"/>
Map each M4 macro to its Bazel equivalent</li>
<li><input disabled="" type="checkbox"/>
Convert argument syntax (brackets → quotes)</li>
<li><input disabled="" type="checkbox"/>
Split plural macros into individual calls</li>
<li><input disabled="" type="checkbox"/>
Add <code>define =</code> parameters for config.h defines</li>
<li><input disabled="" type="checkbox"/>
Add <code>subst =</code> parameters for @VAR@ substitutions</li>
<li><input disabled="" type="checkbox"/>
Handle platform conditionals with <code>select()</code></li>
<li><input disabled="" type="checkbox"/>
Add comments referencing original M4 file and line numbers</li>
<li><input disabled="" type="checkbox"/>
Add dependencies to <code>deps</code> list</li>
<li><input disabled="" type="checkbox"/>
Test with diff tests against golden files</li>
<li><input disabled="" type="checkbox"/>
Verify no duplicate checks between direct checks and deps</li>
</ul>
<hr />
<h2 id="common-pitfalls"><a class="header" href="#common-pitfalls">Common Pitfalls</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Problem</th><th>Solution</th></tr></thead><tbody>
<tr><td>Forgetting to split plural macros</td><td><code>AC_CHECK_HEADERS([a b c])</code> needs 3 separate <code>AC_CHECK_HEADER</code> calls</td></tr>
<tr><td>Missing <code>define =</code> parameter</td><td>Add <code>define = "HAVE_FOO"</code> to create defines in config.h</td></tr>
<tr><td>Wrong define names</td><td>Follow autoconf conventions: <code>HAVE_&lt;NAME&gt;</code>, <code>SIZEOF_&lt;TYPE&gt;</code>, etc.</td></tr>
<tr><td>Duplicate check errors</td><td>Use <code>//gnulib/m4</code> targets instead of manual checks</td></tr>
<tr><td>Missing main() wrapper</td><td><code>AC_TRY_COMPILE</code> code must include <code>int main(void) { ... }</code> or use <code>utils.AC_LANG_PROGRAM</code></td></tr>
<tr><td>String literals in defines</td><td>Use <code>'"string"'</code> (outer single, inner double quotes)</td></tr>
<tr><td>Platform conditionals</td><td>Use <code>select()</code> for <code>case "$host_os"</code> patterns</td></tr>
<tr><td>Cross-compilation failures</td><td>Avoid <code>AC_CHECK_SIZEOF</code> and similar runtime checks</td></tr>
<tr><td>Subst test disagrees with autoconf</td><td>Evaluate case-by-case: may be due to global defaults vs specific checks (see Step 6)</td></tr>
<tr><td>Changing defaults to fix one module</td><td>Don't change existing defaults; they may break other modules</td></tr>
<tr><td>Unnecessary <code>name</code> + separate <code>AC_DEFINE</code></td><td>Use <code>define =</code> directly unless the cache variable is needed in <code>requires</code> or you need custom values</td></tr>
<tr><td>Using <code>condition</code> with <code>if_false = None</code></td><td>Use <code>requires = ["cache_var==1"]</code> to gate defines; <code>condition</code> is for value selection, not gating</td></tr>
<tr><td>Unnecessary golden file split</td><td>Only split into <code>_linux.h.in</code> / <code>_macos.h.in</code> when content genuinely differs between platforms</td></tr>
</tbody></table>
</div>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
