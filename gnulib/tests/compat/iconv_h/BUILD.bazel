load("//gnulib/tests:gnu_gnulib_diff_test_suite.bzl", "gnu_gnulib_diff_test_suite")

gnu_gnulib_diff_test_suite(
    name = "iconv_h_test",
    bazel_autoconf_target = "//gnulib/m4/iconv_h",
    config_h_in = "config.h.in",
    configure_ac = "configure.ac",
    # subst.h differs: ICONV_CONST is empty on macOS, "const" on Linux
    # config.h is identical but we pair them for consistency
    golden_config_h = select({
        "@platforms//os:macos": "golden_config_macos.h.in",
        "@platforms//os:windows": "golden_config_windows.h.in",
        "//conditions:default": "golden_config.h.in",
    }),
    golden_subst_h = select({
        "@platforms//os:macos": "golden_subst_macos.h.in",
        "//conditions:default": "golden_subst.h.in",
    }),
    m4_files = ["@gnulib//:all_m4"],
    subst_h_in = "subst.h.in",
    test_c = "test_iconv_h.c",
)
